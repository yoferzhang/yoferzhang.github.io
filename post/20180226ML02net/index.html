
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>【AI】网络结构，权重初始化，激活函数，fine-tune | YoferZhang 的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Yofer Zhang">
    

    
    <meta name="description" content="版权声明：本文为博主原创，如需转载请注明出处。

导语：

直接查看一个神经网络的结构；
如何初始化权重，改进准确度；
在Keras上建立现行模型；
激活函数的作用；
如何fine-tune一个预训练的Vgg16网络，来分类猫和狗

七行代码体验深度学习的发现Epochs一个eposh就是一遍完整数据集的过程。

运行多个epoch可以提升准确度。
运行多个epoch的时候，分开监测他们的训练结">
<meta property="og:type" content="article">
<meta property="og:title" content="【AI】网络结构，权重初始化，激活函数，fine-tune">
<meta property="og:url" content="http://yoferzhang.com/post/20180226ML02net/index.html">
<meta property="og:site_name" content="YoferZhang 的博客">
<meta property="og:description" content="版权声明：本文为博主原创，如需转载请注明出处。

导语：

直接查看一个神经网络的结构；
如何初始化权重，改进准确度；
在Keras上建立现行模型；
激活函数的作用；
如何fine-tune一个预训练的Vgg16网络，来分类猫和狗

七行代码体验深度学习的发现Epochs一个eposh就是一遍完整数据集的过程。

运行多个epoch可以提升准确度。
运行多个epoch的时候，分开监测他们的训练结">
<meta property="og:image" content="http://wx1.sinaimg.cn/mw690/a9c4d5f6gy1fotocxj6wdj20qy0dsn81.jpg">
<meta property="og:image" content="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotodlcrfqj20qq05wgs5.jpg">
<meta property="og:image" content="http://wx2.sinaimg.cn/mw690/a9c4d5f6gy1fotoe9fypsj20qw09e7dw.jpg">
<meta property="og:image" content="http://wx3.sinaimg.cn/mw690/a9c4d5f6gy1fotofc1dq8j20qq09a496.jpg">
<meta property="og:image" content="http://wx1.sinaimg.cn/mw690/a9c4d5f6gy1fotofz3ds1j20qs05ytgj.jpg">
<meta property="og:image" content="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotohem5daj20re09mqb4.jpg">
<meta property="og:image" content="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotoi5bet4j20r406ewn7.jpg">
<meta property="og:image" content="http://wx1.sinaimg.cn/mw690/a9c4d5f6gy1fotoiw9pqxj20iy0j8dhp.jpg">
<meta property="og:image" content="http://wx1.sinaimg.cn/mw690/a9c4d5f6gy1fotojnljjwj21kw0rwu0z.jpg">
<meta property="og:image" content="http://wx3.sinaimg.cn/mw690/a9c4d5f6gy1fotokbpfisj20y61937ay.jpg">
<meta property="og:image" content="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotol9w8fjj21401gsnj3.jpg">
<meta property="og:image" content="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotom42g7ej21h51404qq.jpg">
<meta property="og:image" content="http://wx3.sinaimg.cn/mw690/a9c4d5f6gy1fotomuv7ssj21h51404qq.jpg">
<meta property="og:image" content="http://wx3.sinaimg.cn/mw690/a9c4d5f6gy1fotoniyk5sj21al140npe.jpg">
<meta property="og:image" content="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotoo71aahj20ub140h7f.jpg">
<meta property="og:image" content="http://wx3.sinaimg.cn/mw690/a9c4d5f6gy1fotoowfvelj20cs04ugm0.jpg">
<meta property="og:image" content="http://wx2.sinaimg.cn/mw690/a9c4d5f6gy1fotopih3ebj20to0bm75z.jpg">
<meta property="og:image" content="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotoq56lx3j20vw02gt91.jpg">
<meta property="og:image" content="http://wx1.sinaimg.cn/mw690/a9c4d5f6gy1fotoqv7az2j20qy0cigni.jpg">
<meta property="og:updated_time" content="2018-06-05T13:06:50.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【AI】网络结构，权重初始化，激活函数，fine-tune">
<meta name="twitter:description" content="版权声明：本文为博主原创，如需转载请注明出处。

导语：

直接查看一个神经网络的结构；
如何初始化权重，改进准确度；
在Keras上建立现行模型；
激活函数的作用；
如何fine-tune一个预训练的Vgg16网络，来分类猫和狗

七行代码体验深度学习的发现Epochs一个eposh就是一遍完整数据集的过程。

运行多个epoch可以提升准确度。
运行多个epoch的时候，分开监测他们的训练结">
<meta name="twitter:image" content="http://wx1.sinaimg.cn/mw690/a9c4d5f6gy1fotocxj6wdj20qy0dsn81.jpg">
<meta name="twitter:creator" content="@LuciferZhangyq">
<link rel="publisher" href="110295955443575724222">

    
    <link rel="alternative" href="/atom.xml" title="YoferZhang 的博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/faviconr.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.jpg" alt="YoferZhang 的博客" title="YoferZhang 的博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="YoferZhang 的博客">YoferZhang 的博客</a></h1>
				<h2 class="blog-motto">数学出身，功底扎实，热爱编程，虽然编程起步晚，但是冲劲十足。</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/index">索引 | Index</a></li>
					
						<li><a href="/archives">归档 | Archives</a></li>
					
						<li><a href="/about">关于 | About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoferzhang.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/post/20180226ML02net/" title="【AI】网络结构，权重初始化，激活函数，fine-tune" itemprop="url">【AI】网络结构，权重初始化，激活函数，fine-tune</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/110295955443575724222?rel=author" title="Yofer Zhang" target="_blank" itemprop="author">Yofer Zhang</a>
		
  <p class="article-time">
    <time datetime="2018-02-26T12:21:48.000Z" itemprop="datePublished"> 发表于 2018-02-26</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#七行代码体验深度学习的发现"><span class="toc-number">1.</span> <span class="toc-text">七行代码体验深度学习的发现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Epochs"><span class="toc-number">1.1.</span> <span class="toc-text">Epochs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结果可视化"><span class="toc-number">1.2.</span> <span class="toc-text">结果可视化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#预训练权重"><span class="toc-number">2.</span> <span class="toc-text">预训练权重</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ImageNet-网络以什么开始的？"><span class="toc-number">2.1.</span> <span class="toc-text">ImageNet 网络以什么开始的？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#神经网络基础"><span class="toc-number">3.</span> <span class="toc-text">神经网络基础</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#梯度下降法"><span class="toc-number">4.</span> <span class="toc-text">梯度下降法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#标准梯度下降法"><span class="toc-number">4.1.</span> <span class="toc-text">标准梯度下降法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线性回归的例子"><span class="toc-number">4.2.</span> <span class="toc-text">线性回归的例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拓展到神经网络"><span class="toc-number">4.3.</span> <span class="toc-text">拓展到神经网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#随机梯度下降"><span class="toc-number">4.4.</span> <span class="toc-text">随机梯度下降</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#举例"><span class="toc-number">4.5.</span> <span class="toc-text">举例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cats-vs-Dogs-and-Finetuning"><span class="toc-number">5.</span> <span class="toc-text">Cats vs Dogs and Finetuning</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#添加一个Dense-Layer"><span class="toc-number">5.1.</span> <span class="toc-text">添加一个Dense Layer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#激活层"><span class="toc-number">5.2.</span> <span class="toc-text">激活层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Finetuning"><span class="toc-number">5.3.</span> <span class="toc-text">Finetuning</span></a></li></ol></li></ol>
		
		</div>
		
		<blockquote>
<p>版权声明：本文为博主原创，如需转载请注明出处。</p>
</blockquote>
<p>导语：</p>
<ul>
<li>直接查看一个神经网络的结构；</li>
<li>如何初始化权重，改进准确度；</li>
<li>在Keras上建立现行模型；</li>
<li>激活函数的作用；</li>
<li>如何fine-tune一个预训练的Vgg16网络，来分类猫和狗</li>
</ul>
<h1 id="七行代码体验深度学习的发现"><a href="#七行代码体验深度学习的发现" class="headerlink" title="七行代码体验深度学习的发现"></a>七行代码体验深度学习的发现</h1><h2 id="Epochs"><a href="#Epochs" class="headerlink" title="Epochs"></a>Epochs</h2><p>一个eposh就是一遍完整数据集的过程。</p>
<ul>
<li>运行多个epoch可以提升准确度。</li>
<li>运行多个epoch的时候，分开监测他们的训练结果。</li>
<li>如果你的精确度收拢的并不好，尝试减小“学习率”</li>
</ul>
<p>在vgg对象中，可以这样改变学习率：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgg.model.optimizer.lr = <span class="number">0.01</span></span><br></pre></td></tr></table></figure>
<h2 id="结果可视化"><a href="#结果可视化" class="headerlink" title="结果可视化"></a>结果可视化</h2><p>jupyter进行结果的可视化很方便，举一些例子：</p>
<ul>
<li>随机一些正确的标签</li>
<li>随机一些错误的标签</li>
<li>每个类中正确率最高的标签</li>
<li>每个类中正确率最低的标签</li>
<li>最不确定的标签（概率接近0.5）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. 随机一些正确的标签</span></span><br><span class="line">correct = np.where(preds==val_labels[:,<span class="number">1</span>])[<span class="number">0</span>]</span><br><span class="line">idx = permutation(correct)[:n_view]</span><br><span class="line">plots_idx(idx, probs[idx])</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<p><img src="http://wx1.sinaimg.cn/mw690/a9c4d5f6gy1fotocxj6wdj20qy0dsn81.jpg" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#2. 随机一些错误的标签</span></span><br><span class="line">incorrect = np.where(preds!=val_labels[:,<span class="number">1</span>])[<span class="number">0</span>]</span><br><span class="line">idx = permutation(incorrect)[:n_view]</span><br><span class="line">plots_idx(idx, probs[idx])</span><br></pre></td></tr></table></figure>
<p><img src="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotodlcrfqj20qq05wgs5.jpg" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3. 很大概率是猫，并且的确是猫</span></span><br><span class="line">correct_cats = np.where((preds==<span class="number">0</span>) &amp; (preds==val_labels[:,<span class="number">1</span>]))[<span class="number">0</span>]</span><br><span class="line">most_correct_cats = np.argsort(probs[correct_cats])[::<span class="number">-1</span>][:n_view]</span><br><span class="line">plots_idx(correct_cats[most_correct_cats], probs[correct_cats][most_correct_cats])</span><br></pre></td></tr></table></figure>
<p><img src="http://wx2.sinaimg.cn/mw690/a9c4d5f6gy1fotoe9fypsj20qw09e7dw.jpg" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 很大概率是狗，并且的确是狗</span></span><br><span class="line">correct_dogs = np.where((preds==<span class="number">1</span>) &amp; (preds==val_labels[:,<span class="number">1</span>]))[<span class="number">0</span>]</span><br><span class="line">most_correct_dogs = np.argsort(probs[correct_dogs])[:n_view]</span><br><span class="line">plots_idx(correct_dogs[most_correct_dogs], <span class="number">1</span>-probs[correct_dogs][most_correct_dogs])</span><br></pre></td></tr></table></figure>
<p><img src="http://wx3.sinaimg.cn/mw690/a9c4d5f6gy1fotofc1dq8j20qq09a496.jpg" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3. 很大概率是猫，但实际是狗</span></span><br><span class="line">incorrect_cats = np.where((preds==<span class="number">0</span>) &amp; (preds!=val_labels[:,<span class="number">1</span>]))[<span class="number">0</span>]</span><br><span class="line">most_incorrect_cats = np.argsort(probs[incorrect_cats])[::<span class="number">-1</span>][:n_view]</span><br><span class="line">plots_idx(incorrect_cats[most_incorrect_cats], probs[incorrect_cats][most_incorrect_cats])</span><br></pre></td></tr></table></figure>
<p><img src="http://wx1.sinaimg.cn/mw690/a9c4d5f6gy1fotofz3ds1j20qs05ytgj.jpg" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#3. 很大概率是狗，但实际是猫</span></span><br><span class="line">incorrect_dogs = np.where((preds==<span class="number">1</span>) &amp; (preds!=val_labels[:,<span class="number">1</span>]))[<span class="number">0</span>]</span><br><span class="line">most_incorrect_dogs = np.argsort(probs[incorrect_dogs])[:n_view]</span><br><span class="line">plots_idx(incorrect_dogs[most_incorrect_dogs], <span class="number">1</span>-probs[incorrect_dogs][most_incorrect_dogs])</span><br></pre></td></tr></table></figure>
<p><img src="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotohem5daj20re09mqb4.jpg" alt=""></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#5. 最不确定的标签 (概率最接近0.5).</span></span><br><span class="line">most_uncertain = np.argsort(np.abs(probs<span class="number">-0.5</span>))</span><br><span class="line">plots_idx(most_uncertain[:n_view], probs[most_uncertain])</span><br></pre></td></tr></table></figure>
<p><img src="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotoi5bet4j20r406ewn7.jpg" alt=""></p>
<p>还有一个比较常规的方法，来分析分类模型的结果，就是使用混淆矩阵(<a href="http://www.dataschool.io/simple-guide-to-confusion-matrix-terminology/" target="_blank" rel="external">confusion matrix</a>)，Scikit-learn也有一个函数可以做这件事：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cm = confusion_matrix(val_classes, preds)</span><br></pre></td></tr></table></figure>
<p>打印混淆矩阵，或者将它可视化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">plot_confusion_matrix(cm, val_batches.class_indices)</span><br></pre></td></tr></table></figure>
<p><img src="http://wx1.sinaimg.cn/mw690/a9c4d5f6gy1fotoiw9pqxj20iy0j8dhp.jpg" alt=""></p>
<blockquote>
<p>混淆矩阵（confusion matrix），又称为可能性表格或是错误矩阵。它是一种特定的矩阵用来呈现算法性能的可视化效果，通常是监督学习（非监督学习，通常用匹配矩阵：matching matrix）。其每一列代表预测值，每一行代表的是实际的类别。这个名字来源于它可以非常容易的表明多个类别是否有混淆（也就是一个class被预测成另一个class）。所有正确的预测结果都在对角线上，所以从混淆矩阵中可以很方便直观的看出哪里有错误，因为他们呈现在对角线外面。</p>
</blockquote>
<h1 id="预训练权重"><a href="#预训练权重" class="headerlink" title="预训练权重"></a>预训练权重</h1><h2 id="ImageNet-网络以什么开始的？"><a href="#ImageNet-网络以什么开始的？" class="headerlink" title="ImageNet 网络以什么开始的？"></a>ImageNet 网络以什么开始的？</h2><p>与finetuning一个被预训练过权重的网络相比，用随机的权重训练一个卷积神经网络要花费非常大的精力。预训练网络很有效，是因为它们已经有了ImageNet的特性，权重中已经encode进特性了。典型的讲，包含线、边缘、曲线以及很多有用的表示特定部分的低级滤波器。比如下面一个layer中可以发现一些条纹和圆形的东西。</p>
<p><img src="http://wx1.sinaimg.cn/mw690/a9c4d5f6gy1fotojnljjwj21kw0rwu0z.jpg" alt=""></p>
<p>图像识别过程中这些低级的滤波器都是很有用的。预训练的权重已经学习到了这些滤波器，我们只需要简单的”fine-tune”高级的layer，改变我们需要的分类映射。</p>
<blockquote>
<p>有篇论文仔细分析了上述问题：<a href="https://arxiv.org/abs/1311.290" target="_blank" rel="external"> https://arxiv.org/abs/1311.290</a></p>
</blockquote>
<h1 id="神经网络基础"><a href="#神经网络基础" class="headerlink" title="神经网络基础"></a>神经网络基础</h1><p>标准的全连接神经网络本质上是一系列矩阵的运算。</p>
<p><img src="http://wx3.sinaimg.cn/mw690/a9c4d5f6gy1fotokbpfisj20y61937ay.jpg" alt=""></p>
<p>上面是原始的表格。</p>
<p><img src="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotol9w8fjj21401gsnj3.jpg" alt=""></p>
<p>紫色圆圈是输入向量，黄色圆圈是目标向量y。下面要做一系列矩阵操作来尽可能接近目标向量y。</p>
<p><img src="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotom42g7ej21h51404qq.jpg" alt=""></p>
<p>输入向量和第一个权值矩阵的第一列相乘，结果是activation向量中第一个值。</p>
<p><img src="http://wx3.sinaimg.cn/mw690/a9c4d5f6gy1fotomuv7ssj21h51404qq.jpg" alt=""></p>
<p>输入向量和第一个权重矩阵的第二列相乘，结果是activation向量中第二个值。同理得到第三个和第四个值。</p>
<p><img src="http://wx3.sinaimg.cn/mw690/a9c4d5f6gy1fotoniyk5sj21al140npe.jpg" alt=""></p>
<p>第一个activations向量和第二个权重矩阵的第一列相乘，得到第二个activations向量的第一个值。同理得到第二个和第三个值。</p>
<p><img src="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotoo71aahj20ub140h7f.jpg" alt=""></p>
<p>观察每个权值矩阵中第一列的乘法。最后如何得到activation向量和我们的目标向量y一样的值呢？</p>
<p>类似上面，一个神经网络，它的核心就是一系列矩阵，通过矩阵乘法将输入矩阵映射到输出矩阵上。每个矩阵之间的中间矩阵就是activation，矩阵自身就是每一层。学习的过程叫做”fitting”，目标就是调整叫做权重矩阵的值，为了在给神经网络一个输入矩阵的时候，我们有能力产生一个尽可能和真实输出矩阵接近的输出矩阵。是通过传入很多已经标记过得输入矩阵来达到目的。这就是在训练集上做的事情。</p>
<p>根据上面的说法，随机生成矩阵元素的权值。然后执行所有的操作并观察结果，注意activation是如何输出的，和我们的目标矩阵y有多大的差距。使用一些最优化算法，可以使结果尽可能接近目标矩阵y。在这之前，建议以使得激活输出至少相对接近目标矩阵的方式来初始化权值。这种方法叫做权重初始化。</p>
<p>有很多的权重初始化器可以选择。这里，使用了<a href="http://andyljones.tumblr.com/post/110998971763/an-explanation-of-xavier-initialization%7C" target="_blank" rel="external">Xavier Initialization</a>(也叫做Glorot Initialization)。值得注意的是，现在很多的深度学习库将会为你处理好权重初始化，不需要你自己进行这一步。</p>
<h1 id="梯度下降法"><a href="#梯度下降法" class="headerlink" title="梯度下降法"></a>梯度下降法</h1><p>上面讲到的优化算法，最常见的优化算法，就是在深度学习中无处不在的梯度下降法(Gradient Descent)</p>
<h2 id="标准梯度下降法"><a href="#标准梯度下降法" class="headerlink" title="标准梯度下降法"></a>标准梯度下降法</h2><p>标准梯度下降法是一种迭代选择“参数”（称之为深度学习的权重），成功减少了所谓的“损失函数”，损失函数是一些简单的方法，来确定不同的预测输出，由预测”参数”和给定的输入，从用相同的输入来得到相关联的输出。一个常见的损失函数是平方误差之和，它只是预测响应和真实响应之间的差之平方和之和。这种损失函数在线性回归过程中很常见。另一个常见的损失函数是log-loss，上面已经定义过了。通常在神经网络中使用这种损失函数。</p>
<p>由于我们的损失函数本质上是衡量我们的预测与期望值相匹配的程度，我们的优化算法的目标是最小化这个值。我们的预测函数至少有两种数值，即函数作用的输入，以及决定我们对输入做什么的“参数”。因为我们不能改变输入，所以我们必须通过选择能产生接近于期望值的参数来最小化损失函数。</p>
<p>梯度下降是一种迭代的“改进”初始参数值的方法（通过一些进程初始化），以尽量减少损失函数。我们通过计算损失函数关于每个参数的偏导数，并通过在导数方向相反的一步来更新参数。当我们在所有参数中这样做时，我们（希望）以这样一种方式更新我们的参数，这些新参数确定的预测减少损失函数。在以后可能会遇到，使用这种方法可能会出现一些问题，以及我们如何处理它。这个过程中的“梯度”是描述损耗函数是如何在每个参数上变化的向量。我们前面提到的另一个值得注意的是学习率(learning rete)。这个值指示我们在更新参数时采取的步骤有多大，这就是所谓的“超参数(hyper-parameter)”。</p>
<h2 id="线性回归的例子"><a href="#线性回归的例子" class="headerlink" title="线性回归的例子"></a>线性回归的例子</h2><p>这听起来可能比实际情况复杂得多。举个例子，我们可以看到线性回归中的梯度下降（拟合一条直线）。</p>
<p>如果直线是ax + b，其中a和b是“参数”，我们的目标求得使损失函数最小化的a和b。 损失函数本质上是一个数学函数，如果猜错了（在我们的例子中是a和b），那么这个函数将会很高，如果猜对了，那么这个函数结果就会比较小。 在线性回归中，我们使用平方差之和作为损失函数。 在每次迭代中，计算这个函数关于a和b的导数。 这告诉我们损失函数如何改变这两个参数。 如果关于a的导数是正值，那么增大a将增大损失函数。 所以就减小a。 如果是负值，增大则会减小损失函数，所以增大a。 无论哪种情况，都朝着与a的导数的正方向相反的方向前进。 一遍一遍的这样做，直到满意。 </p>
<h2 id="拓展到神经网络"><a href="#拓展到神经网络" class="headerlink" title="拓展到神经网络"></a>拓展到神经网络</h2><p>这种优化技术的强大之处在于我们已经对线性模型的参数进行了随机初始化，并且通过梯度下降迭代，我们可以得到最优解。 这里的关键是，我们用同样的过程来估计像线性函数那样简单的参数，也可以用来估计像神经网络这样复杂的参数，但有一些注意事项。 在线性回归中，我们通常总是能够得到最好的解决方案。 由于具有数百万个参数的神经网络的复杂性，这几乎从未如此。 往往我们永远不会找到所有参数的最佳最小值。 这就是为什么我们不直接在神经网络上运行梯度下降，直到满足一些终止条件，就像我们使用线性回归一样。 相反，我们运行梯度下降，直到我们对结果满意。</p>
<h2 id="随机梯度下降"><a href="#随机梯度下降" class="headerlink" title="随机梯度下降"></a>随机梯度下降</h2><p>另一个关键的区别是我们到目前为止只谈到了“标准”梯度下降。 在标准梯度下降中，对所有可用的训练数据评估损失函数。 不幸的是，由于计算限制，这在神经网络中是不可能的。 因此，我们使用所谓的随机梯度下降。 这是通过随机抽样或者我们的数据的“mini-batch”来产生对这个小批量的预测，并用它们的真实值来评估损失函数。 然后我们像往常一样更新权重，然后移动到下一个小批量，重复这个过程。 这个过程的“随机”元素是通过评估不同小批量的损失函数而引入的随机元素，而不是整个训练集。 对于每个小批量，损失函数将略有不同，它也将不同于整个训练集的损失函数。 但事实证明，这并不重要！ 随机梯度下降的神奇之处在于，您可以更新随机小批量训练集上的权重，并且您的结果将与您更新整个训练集上的真实损失函数的权重相同。</p>
<h2 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h2><p>作为例子，下面展示keras如何实现梯度下降，我们将在线性回归的context中使用它。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x = random((<span class="number">30</span>,<span class="number">2</span>))</span><br><span class="line">y = np.dot(x, [<span class="number">2.</span>, <span class="number">3.</span>]) + <span class="number">1.</span></span><br><span class="line">x[:<span class="number">5</span>]</span><br></pre></td></tr></table></figure>
<p><img src="http://wx3.sinaimg.cn/mw690/a9c4d5f6gy1fotoowfvelj20cs04ugm0.jpg" alt=""></p>
<p>在这里所做的是创建y值，通过关系 y = 2 <em> x1 + 3 </em> x2 + 1与x1 ， x2线性相关。 在keras中，一个简单的线性模型被称为Dense layer。 通过我们的输入和期望的输出x和y ，Keras将初始化某种形式的随机权重。 我们会告诉它使用SGD来优化，学习率为0.1，以最小化损失函数均方误差（mse）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lm = Sequential([ Dense(<span class="number">1</span>, input_shape=(<span class="number">2</span>,)) ])</span><br><span class="line">lm.compile(optimizer=SGD(lr=<span class="number">0.1</span>), loss=<span class="string">'mse'</span>)</span><br></pre></td></tr></table></figure>
<p>通过评估我们的损失函数，可以看到初始权重有多远。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm.evaluate(x, y, verbose=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">8.6175813674926758</span></span><br></pre></td></tr></table></figure>
<p>接下来，我们将运行随机梯度下降。 拟合函数，如下所述，在sgd的每次迭代中，将使用训练集中的一个输入/输出对来评估损失函数并更新参数。 整个训练集中的一次遍历计算被称为epoch。 下面经历5个epoch。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm.fit(x, y, nb_epoch=<span class="number">5</span>, batch_size=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="http://wx2.sinaimg.cn/mw690/a9c4d5f6gy1fotopih3ebj20to0bm75z.jpg" alt=""></p>
<p>来看看我们的评估函数：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm.fit(x, y, nb_epoch=<span class="number">5</span>, batch_size=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2.3591119315824471e-05</span></span><br></pre></td></tr></table></figure>
<p>和期待的一样，小了很多</p>
<p>fitting 后我们也可以看看权重。 我们期望它们非常接近真实参数（2.0,3.0和1.0）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lm.get_weights()</span><br></pre></td></tr></table></figure>
<p><img src="http://wx4.sinaimg.cn/mw690/a9c4d5f6gy1fotoq56lx3j20vw02gt91.jpg" alt=""></p>
<p>的确和预期一致。 如果我们使用的batch size大于1，可以预期我们的权重会更快地收敛到真实权重。</p>
<h1 id="Cats-vs-Dogs-and-Finetuning"><a href="#Cats-vs-Dogs-and-Finetuning" class="headerlink" title="Cats vs Dogs and Finetuning"></a>Cats vs Dogs and Finetuning</h1><p>我们现在已经足够了解如何修改Vgg16来创建一个模型，来输出猫和狗的预测。 </p>
<h2 id="添加一个Dense-Layer"><a href="#添加一个Dense-Layer" class="headerlink" title="添加一个Dense Layer"></a>添加一个Dense Layer</h2><p>我们在上一节中使用的Dense Layer将输入向量映射到单个输出。 我们可以很容易地改变这个输出到一个任意长度的向量，注意这个输出的权重结构将只是一个矩阵。</p>
<p>Vgg16的最后一层输出1000个类别的向量，因为这是比赛要求的类别数量。 在这些类别中，其中的一些当然对应于猫和狗，但在更细微的层面（特定品种）。 我们可以手工找出哪些类别是猫，哪些是狗，只需编写一些将imagenet分类转换为猫和狗分类的代码。 但这样做效率不高，我们会错过一些关键信息。</p>
<p>一个更好的方法是简单地在imagenet层的顶部添加Dense Layer，并训练模型，以将猫和狗的输入图像的imagenet分类映射到猫和狗的标签。 为什么这比手动做呢更好？ 因为神经网络将利用imagenet分类中的所有可用信息，而不是简单地将cat分类映射到cat和dog分类。 例如，德国牧羊犬与骨头的图片可能在德国牧羊犬类别和骨头类别中具有很强的概率。 如果我们只把狗的类别映射到狗身上，然后把其他的信息丢掉，那么我们就会失去其他对分类有用的信息，比如图像中是否有骨头。</p>
<p>总体方法是：</p>
<ul>
<li>获取每个图像的真实标签。</li>
<li>获取每个图像的1,000个imagenet类别预测。</li>
<li>将这些预测作为输入提供给简单的线性模型。</li>
</ul>
<p>需要注意的一点是，我们从批处理中得到的标签需要进行one-hot编码。 one-hot编码只需要分类变量，并将其转换为矩阵，其中每列表示一个类别。 如果图像属于类别A，那么矩阵中该图像的行在A类列中有1，而在其他情况下为0。 我们采取步骤将标签转换为这些向量的一个重要原因，是因为它与dense layer的输出形状相同。 因此，为了训练目的，我们需要对它们进行one-hot。 现在可以预测。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">trn_features = model.predict(trn_data, batch_size=batch_size)</span><br><span class="line">val_features = model.predict(val_data, batch_size=batch_size)</span><br></pre></td></tr></table></figure>
<p>如果我们通过预测将我们的猫与狗的训练/验证传递给我们的模型，那么我们将得到1000个imagenet分类概率。 接下来，我们可以做出如下模型：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1000 输入，为了保留特性，2输出，狗和猫</span></span><br><span class="line">lm = Sequential([ Dense(<span class="number">2</span>, activation=<span class="string">'softmax'</span>, input_shape=(<span class="number">1000</span>,)) ])</span><br><span class="line">lm.compile(optimizer=RMSprop(lr=<span class="number">0.1</span>), loss=<span class="string">'categorical_crossentropy'</span>, metrics=[<span class="string">'accuracy'</span>])</span><br></pre></td></tr></table></figure>
<p>需要将1000个 imagenet概率，映射到输出，一个是猫，一个是狗。 初始化后，模型不知道怎么做。 但是，使用one-hot 编码标签，可以使用imagenet预测作为输入来训练此layer。 现在我们所要做的就和以前一样。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">batch_size=<span class="number">64</span></span><br><span class="line">lm.fit(trn_features, trn_labels, nb_epoch=<span class="number">3</span>, batch_size=batch_size, </span><br><span class="line">       validation_data=(val_features, val_labels))</span><br></pre></td></tr></table></figure>
<p><img src="http://wx1.sinaimg.cn/mw690/a9c4d5f6gy1fotoqv7az2j20qy0cigni.jpg" alt=""></p>
<p>这种简单地将dense layers附着到预训练的模型，以对期望的类别进行分类的方法，通常使得深度学习的业余人员获得令人惊讶的结果，诸如分类皮肤损伤。 这真的很简单， 我们真的没有什么神奇的功能，只是通过预先训练好的模型输出来训练线性模型。 通过这样做，我们已经实现了大于97％的分类准确度。</p>
<h2 id="激活层"><a href="#激活层" class="headerlink" title="激活层"></a>激活层</h2><p>之前描述一个神经网络时，解释它是一系列的矩阵乘法，称之为层，它转换一个输入向量。 在每个中间步骤中，我们将这些层的输出称为激活层。 然而，经过反思，这似乎很奇怪。 如果一个神经网络只是一个矩阵乘法的序列，那么整个过程就是一个线性过程，可以用一个矩阵表示。</p>
<p>当然不是这种情况。 之前我们关注中间向量的原因是因为在神经网络中，实际上在这些激活层中存在非线性函数，其在前一层的输出上操作。 这个新的向量然后被馈送到下一个矩阵中。 一些常用的激活函数是 tanh ，sigmoid 函数和 relu（rectified linear unit的缩写）。 Relu实际上是最常见的，虽然听起来像一些神秘的功能，但它只是函数max（0，x） 。 现在观察Vgg16中的每个图层都有激活函数，它们只是告诉keras如何转换特定线性图层的输出。</p>
<p>事实证明，这种线性变换和非线性激活的组合能够逼近任何东西。</p>
<h2 id="Finetuning"><a href="#Finetuning" class="headerlink" title="Finetuning"></a>Finetuning</h2><p>如果我们观察Vgg16的最后一层，可以看到最后一层只是一个输出1000个元素的dense layer。 因此，将一层意味着要找到猫和狗的dense layer堆叠起来，似乎有些不合理，因为在分类为猫和狗之前，首先强迫神经网络将其分类到imagenet，限制了一些可用的信息。</p>
<p>相反，我们来删除最后一层</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.pop()</span><br><span class="line"><span class="keyword">for</span> layer <span class="keyword">in</span> model.layers: layer.trainable=<span class="keyword">False</span></span><br></pre></td></tr></table></figure>
<p>然后给猫和狗添加一个新层</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">model.add(Dense(<span class="number">2</span>, activation=<span class="string">'softmax'</span>))</span><br></pre></td></tr></table></figure>
<p>注意 ：以上3个步骤都是vgg16的 finetune() 方法！</p>
<p>现在我们可以使用上一层的所有4096个激活（不管它们可能是什么！）来分类为猫和狗。 这隐含地应该为我们提供更丰富的信息来分类。</p>
<p>接下来的步骤是像以前一样简单地训练，如果你这样做，你会发现你的模型会产生比只是在上面增加另一个图层更好的结果。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/AI/">AI</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/神经网络/">神经网络</a><a href="/tags/权重/">权重</a><a href="/tags/激活函数/">激活函数</a><a href="/tags/微调/">微调</a><a href="/tags/梯度下降/">梯度下降</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoferzhang.com/post/20180226ML02net/" data-title="【AI】网络结构，权重初始化，激活函数，fine-tune | YoferZhang 的博客" data-tsina="2848249334" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/post/20180228celuosiwei/" title="《策略思维——商界、政界及日常生活中的策略竞争（大师细说博弈论）》">
  <strong>上一篇：</strong><br/>
  <span>
  《策略思维——商界、政界及日常生活中的策略竞争（大师细说博弈论）》</span>
</a>
</div>


<div class="next">
<a href="/post/20180121guaidanxingweixue/"  title="《怪诞行为学:可预测的非理性》">
 <strong>下一篇：</strong><br/> 
 <span>《怪诞行为学:可预测的非理性》
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="post/20180226ML02net/" data-title="【AI】网络结构，权重初始化，激活函数，fine-tune" data-url="http://yoferzhang.com/post/20180226ML02net/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#七行代码体验深度学习的发现"><span class="toc-number">1.</span> <span class="toc-text">七行代码体验深度学习的发现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Epochs"><span class="toc-number">1.1.</span> <span class="toc-text">Epochs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#结果可视化"><span class="toc-number">1.2.</span> <span class="toc-text">结果可视化</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#预训练权重"><span class="toc-number">2.</span> <span class="toc-text">预训练权重</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ImageNet-网络以什么开始的？"><span class="toc-number">2.1.</span> <span class="toc-text">ImageNet 网络以什么开始的？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#神经网络基础"><span class="toc-number">3.</span> <span class="toc-text">神经网络基础</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#梯度下降法"><span class="toc-number">4.</span> <span class="toc-text">梯度下降法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#标准梯度下降法"><span class="toc-number">4.1.</span> <span class="toc-text">标准梯度下降法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#线性回归的例子"><span class="toc-number">4.2.</span> <span class="toc-text">线性回归的例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#拓展到神经网络"><span class="toc-number">4.3.</span> <span class="toc-text">拓展到神经网络</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#随机梯度下降"><span class="toc-number">4.4.</span> <span class="toc-text">随机梯度下降</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#举例"><span class="toc-number">4.5.</span> <span class="toc-text">举例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Cats-vs-Dogs-and-Finetuning"><span class="toc-number">5.</span> <span class="toc-text">Cats vs Dogs and Finetuning</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#添加一个Dense-Layer"><span class="toc-number">5.1.</span> <span class="toc-text">添加一个Dense Layer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#激活层"><span class="toc-number">5.2.</span> <span class="toc-text">激活层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Finetuning"><span class="toc-number">5.3.</span> <span class="toc-text">Finetuning</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="yoferzhang" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/AI/" title="AI">AI<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/C语言/" title="C语言">C语言<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>50</sup></a></li>
		  
		
		  
			<li><a href="/categories/分类/" title="分类">分类<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/快速记忆/" title="快速记忆">快速记忆<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/渔/" title="渔">渔<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/艺术/" title="艺术">艺术<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书感悟/" title="读书感悟">读书感悟<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/随笔/" title="随笔">随笔<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://hexo.io/" target="_blank" title="Hexo">Hexo</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/yoferzhang" target="_blank" title="Github">Github</a>
            
          </li>
        
          <li>
            
            	<a href="http://ww3.sinaimg.cn/large/a9c4d5f6jw1f2cbilh1uyj2076076t97.jpg" target="_blank" title="WeChat">WeChat</a>
            
          </li>
        
          <li>
            
            	<a href="https://cn.linkedin.com/in/耀琦-张-771388117" target="_blank" title="LinkedIn">LinkedIn</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Yofer Zhang in Tencent. <br/>
			This is my blog,thank you to here.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2848249334" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/yoferzhang" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/yofer-zhang" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/LuciferZhangyq" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/luciferzhang" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/耀琦-张-771388117?trk=hp-identity-name" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/zyq522376829" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/yoferzhang" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		<a href="https://plus.google.com/110295955443575724222?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:522376829@qq.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="Yofer Zhang">Yofer Zhang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"yoferzhang"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//yoferzhang.github.io/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-83435219-1', 'yoferzhang.com');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a6dda28cb6f26de955e11a3716d6ce9b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
