
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>AVFoundation Programming Guide(官方文档翻译2)Using Assets - 使用Assets | Mathematical Method, the Way of the World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Yofer Zhang">
    

    
    <meta name="description" content="这
是
目
录
的
分
割
线
再
多
一
点
新博客：完整版 - AVFoundation Programming Guide
分章节版：– 第1章：About AVFoundation - AVFoundation概述– 第2章：Using Assets - 使用Assets– 第3章：Playback - 播放– 第4章：Editing - 编辑– 第5章：Still and Video">
<meta property="og:type" content="article">
<meta property="og:title" content="AVFoundation Programming Guide(官方文档翻译2)Using Assets - 使用Assets">
<meta property="og:url" content="http://yoferzhang.com/post/20160803AVFoundation02UsingAssets/index.html">
<meta property="og:site_name" content="Mathematical Method, the Way of the World">
<meta property="og:description" content="这
是
目
录
的
分
割
线
再
多
一
点
新博客：完整版 - AVFoundation Programming Guide
分章节版：– 第1章：About AVFoundation - AVFoundation概述– 第2章：Using Assets - 使用Assets– 第3章：Playback - 播放– 第4章：Editing - 编辑– 第5章：Still and Video">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/a9c4d5f6gw1f6f7bsp7lbj20oo04u74b.jpg">
<meta property="og:updated_time" content="2016-08-07T11:43:17.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AVFoundation Programming Guide(官方文档翻译2)Using Assets - 使用Assets">
<meta name="twitter:description" content="这
是
目
录
的
分
割
线
再
多
一
点
新博客：完整版 - AVFoundation Programming Guide
分章节版：– 第1章：About AVFoundation - AVFoundation概述– 第2章：Using Assets - 使用Assets– 第3章：Playback - 播放– 第4章：Editing - 编辑– 第5章：Still and Video">
<meta name="twitter:image" content="http://ww4.sinaimg.cn/large/a9c4d5f6gw1f6f7bsp7lbj20oo04u74b.jpg">
<meta name="twitter:creator" content="@LuciferZhangyq">
<link rel="publisher" href="110295955443575724222">

    
    <link rel="alternative" href="/atom.xml" title="Mathematical Method, the Way of the World" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/faviconr.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.jpg" alt="Mathematical Method, the Way of the World" title="Mathematical Method, the Way of the World"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Mathematical Method, the Way of the World">Mathematical Method, the Way of the World</a></h1>
				<h2 class="blog-motto">数学出身，功底扎实，热爱编程，虽然编程起步晚，但是冲劲十足。</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页 | Home</a></li>
					
						<li><a href="/index">索引 | Index</a></li>
					
						<li><a href="/archives">归档 | Archives</a></li>
					
						<li><a href="/about">关于 | About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoferzhang.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/post/20160803AVFoundation02UsingAssets/" title="AVFoundation Programming Guide(官方文档翻译2)Using Assets - 使用Assets" itemprop="url">AVFoundation Programming Guide(官方文档翻译2)Using Assets - 使用Assets</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/110295955443575724222?rel=author" title="Yofer Zhang" target="_blank" itemprop="author">Yofer Zhang</a>
		
  <p class="article-time">
    <time datetime="2016-08-03T07:06:08.000Z" itemprop="datePublished"> 发表于 2016-08-03</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Using-Assets-使用Assets"><span class="toc-number">1.</span> <span class="toc-text">Using Assets - 使用Assets</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-an-Asset-Object-创建一个Asset对象"><span class="toc-number">1.1.</span> <span class="toc-text">Creating an Asset Object - 创建一个Asset对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Options-for-Initializing-an-Asset-初始化一个Asset的选择"><span class="toc-number">1.1.1.</span> <span class="toc-text">Options for Initializing an Asset - 初始化一个Asset的选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Accessing-the-User’s-Assets-访问用户的Assets"><span class="toc-number">1.1.2.</span> <span class="toc-text">Accessing the User’s Assets - 访问用户的Assets</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preparing-an-Asset-for-Use-将-Asset-准备好使用"><span class="toc-number">1.2.</span> <span class="toc-text">Preparing an Asset for Use - 将 Asset 准备好使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-Still-Images-From-a-Video-从视频中获取静态图像"><span class="toc-number">1.3.</span> <span class="toc-text">Getting Still Images From a Video - 从视频中获取静态图像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Generating-a-Single-Image-生成一个单独的图像"><span class="toc-number">1.3.1.</span> <span class="toc-text">Generating a Single Image - 生成一个单独的图像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generating-a-Sequence-of-Images-生成一系列图像"><span class="toc-number">1.4.</span> <span class="toc-text">Generating a Sequence of Images - 生成一系列图像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Trimming-and-Transcoding-a-Movie-微调和转化为一个电影"><span class="toc-number">1.5.</span> <span class="toc-text">Trimming and Transcoding a Movie - 微调和转化为一个电影</span></a></li></ol></li></ol>
		
		</div>
		
		<blockquote>
<p>这</p>
<p>是</p>
<p>目</p>
<p>录</p>
<p>的</p>
<p>分</p>
<p>割</p>
<p>线</p>
<p>再</p>
<p>多</p>
<p>一</p>
<p>点</p>
<p>新博客：<br>完整版 - <a href="http://yoferzhang.com/post/20160724AVFoundation/">AVFoundation Programming Guide</a></p>
<p>分章节版：<br>– 第1章：<a href="http://yoferzhang.com/post/20160803AVFoundation01Introduction/">About AVFoundation - AVFoundation概述</a><br>– 第2章：<a href="http://yoferzhang.com/post/20160803AVFoundation02UsingAssets/">Using Assets - 使用Assets</a><br>– 第3章：<a href="http://yoferzhang.com/post/20160803AVFoundation03Playback/">Playback - 播放</a><br>– 第4章：<a href="http://yoferzhang.com/post/20160803AVFoundation04Editing/">Editing - 编辑</a><br>– 第5章：<a href="http://yoferzhang.com/post/20160803AVFoundation05StillAndVideoMediaCapture/">Still and Video Media Capture - 静态视频媒体捕获</a><br>– 第6章：<a href="http://yoferzhang.com/post/20160803AVFoundation06Export/">Export - 输出</a><br>– 第7章：<a href="http://yoferzhang.com/post/20160803AVFoundation07TimeAndMediaRepresentations/">Time and Media Representations 时间和媒体表现</a></p>
<p>CSDN博客：<br>完整版 - <a href="http://blog.csdn.net/zyq522376829/article/details/52144394" target="_blank" rel="external">AVFoundation Programming Guide</a></p>
<p>分章节版：<br>– 第1章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144317" target="_blank" rel="external">About AVFoundation - AVFoundation概述</a><br>– 第2章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144326" target="_blank" rel="external">Using Assets - 使用Assets</a><br>– 第3章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144333" target="_blank" rel="external">Playback - 播放</a><br>– 第4章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144342" target="_blank" rel="external">Editing - 编辑</a><br>– 第5章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144355" target="_blank" rel="external">Still and Video Media Capture - 静态视频媒体捕获</a><br>– 第6章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144366" target="_blank" rel="external">Export - 输出</a><br>– 第7章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144372" target="_blank" rel="external">Time and Media Representations 时间和媒体表现</a></p>
<p>版权声明：本文为博主原创翻译，如需转载请注明出处。</p>
<p>苹果源文档地址 - <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40010188-CH1-SW3" target="_blank" rel="external">点击这里</a></p>
</blockquote>
<h1 id="Using-Assets-使用Assets"><a href="#Using-Assets-使用Assets" class="headerlink" title="Using Assets - 使用Assets"></a>Using Assets - 使用Assets</h1><p>Assets can come from a file or from media in the user’s iPod library or Photo library. When you create an asset object all the information that you might want to retrieve for that item is not immediately available. Once you have a movie asset, you can extract still images from it, transcode it to another format, or trim the contents.</p>
<p><code>Assets</code> 可以来自文件或者媒体用户的iPod库、图片库。当你创建一个 <code>asset</code> 对象时，所有你可能想要检索该项目的信息不是立即可用的。一旦你有了一个电影 <code>asset</code> ，你可以从里面提取静态图像，转换到另一个格式，或者对内容就行修剪。</p>
<h2 id="Creating-an-Asset-Object-创建一个Asset对象"><a href="#Creating-an-Asset-Object-创建一个Asset对象" class="headerlink" title="Creating an Asset Object - 创建一个Asset对象"></a>Creating an Asset Object - 创建一个Asset对象</h2><p>To create an asset to represent any resource that you can identify using a URL, you use <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVURLAsset_Class/index.html#//apple_ref/occ/cl/AVURLAsset" target="_blank" rel="external">AVURLAsset</a>. The simplest case is creating an asset from a file:</p>
<p>为了创建一个 <code>asset</code> ，去代表任何你能用一个 <code>URL</code> 识别的资源，你可以使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVURLAsset_Class/index.html#//apple_ref/occ/cl/AVURLAsset" target="_blank" rel="external">AVURLAsset</a> .最简单的情况是从一个文件创建一个 <code>asset</code> 。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url = &lt;<span class="meta">#A URL that identifies an audiovisual asset such as a movie file#&gt;;</span></span><br><span class="line"><span class="built_in">AVURLAsset</span> *anAsset = [[<span class="built_in">AVURLAsset</span> alloc] initWithURL:url options:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<h3 id="Options-for-Initializing-an-Asset-初始化一个Asset的选择"><a href="#Options-for-Initializing-an-Asset-初始化一个Asset的选择" class="headerlink" title="Options for Initializing an Asset - 初始化一个Asset的选择"></a>Options for Initializing an Asset - 初始化一个Asset的选择</h3><p>The AVURLAsset initialization methods take as their second argument an options dictionary. The only key used in the dictionary is <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVURLAsset_Class/index.html#//apple_ref/c/data/AVURLAssetPreferPreciseDurationAndTimingKey" target="_blank" rel="external">AVURLAssetPreferPreciseDurationAndTimingKey</a>. The corresponding value is a Boolean (contained in an NSValue object) that indicates whether the asset should be prepared to indicate a precise duration and provide precise random access by time.</p>
<p><code>AVURLAsset</code> 初始化方法作为它们的第二个参数选项字典。本字典中唯一被使用的 <code>key</code> 是 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVURLAsset_Class/index.html#//apple_ref/c/data/AVURLAssetPreferPreciseDurationAndTimingKey" target="_blank" rel="external">AVURLAssetPreferPreciseDurationAndTimingKey</a>. 相应的值是一个布尔值（包含在一个 <code>NSValue</code> 对象中），这个布尔值指出是否该 <code>asset</code> 应该准备标出一个精确的时间和提供一个以时间为种子的随机存取。</p>
<p>Getting the exact duration of an asset may require significant processing overhead. Using an approximate duration is typically a cheaper operation and sufficient for playback. Thus:</p>
<ul>
<li>If you only intend to play the asset, either pass nil instead of a dictionary, or pass a dictionary that contains the AVURLAssetPreferPreciseDurationAndTimingKey key and a corresponding value of NO (contained in an NSValue object).</li>
<li>If you want to add the asset to a composition (<a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVMutableComposition_Class/index.html#//apple_ref/occ/cl/AVMutableComposition" target="_blank" rel="external">AVMutableComposition</a>), you typically need precise random access. Pass a dictionary that contains theAVURLAssetPreferPreciseDurationAndTimingKey key and a corresponding value of YES (contained in an NSValue object—recall that NSNumberinherits from NSValue):</li>
</ul>
<p>获得一个asset的确切持续时间可能需要大量的处理开销。使用一个近似的持续时间通常是一个更便宜的操作并且对于播放已经足够了。因此：</p>
<ul>
<li>如果你只打算播放这个 <code>asset</code>， 要么传递一个 <code>nil</code> 代替 <code>dictionary</code> ，或者传递一个字典，这个字典包含 <code>AVURLAssetPreferPreciseDurationAndTimingKey</code> 的 <code>key</code>和相应 <code>NO</code>(包含在一个 <code>NSValue</code> 对象) 的值。</li>
<li>如果你想要把 <code>asset</code> 添加给一个 <code>composition</code> (<a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVMutableComposition_Class/index.html#//apple_ref/occ/cl/AVMutableComposition" target="_blank" rel="external">AVMutableComposition</a>), 通常你需要精确的随机存取。传递一个字典（这个字典包含 <code>AVURLAssetPreferPreciseDurationAndTimingKey</code> key） 和一个相应的 <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/ObjCRuntimeRef/index.html#//apple_ref/doc/c_ref/YES" target="_blank" rel="external">YES</a> 的值（YES 包含在一个 <code>NSValue</code> 对象中，回忆一下继承自 <code>NSValue</code>的 <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSNumber_Class/index.html#//apple_ref/occ/cl/NSNumber" target="_blank" rel="external">NSNmuber</a>）</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url = &lt;<span class="meta">#A URL that identifies an audiovisual asset such as a movie file#&gt;;</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *options = @&#123; <span class="built_in">AVURLAssetPreferPreciseDurationAndTimingKey</span> : @YES &#125;;</span><br><span class="line"><span class="built_in">AVURLAsset</span> *anAssetToUseInAComposition = [[<span class="built_in">AVURLAsset</span> alloc] initWithURL:url options:options];</span><br></pre></td></tr></table></figure>
<h3 id="Accessing-the-User’s-Assets-访问用户的Assets"><a href="#Accessing-the-User’s-Assets-访问用户的Assets" class="headerlink" title="Accessing the User’s Assets - 访问用户的Assets"></a>Accessing the User’s Assets - 访问用户的<code>Assets</code></h3><p>To access the assets managed by the iPod library or by the Photos application, you need to get a URL of the asset you want.</p>
<ul>
<li>To access the iPod Library, you create an <a href="https://developer.apple.com/library/ios/documentation/MediaPlayer/Reference/MPMediaQuery_ClassReference/index.html#//apple_ref/occ/cl/MPMediaQuery" target="_blank" rel="external">MPMediaQuery</a> instance to find the item you want, then get its URL using <a href="https://developer.apple.com/library/ios/documentation/MediaPlayer/Reference/MPMediaItem_ClassReference/index.html#//apple_ref/c/data/MPMediaItemPropertyAssetURL" target="_blank" rel="external">MPMediaItemPropertyAssetURL</a>.For more about the Media Library, see Multimedia Programming Guide.</li>
<li>To access the assets managed by the Photos application, you use <a href="https://developer.apple.com/library/ios/documentation/AssetsLibrary/Reference/ALAssetsLibrary_Class/index.html#//apple_ref/occ/cl/ALAssetsLibrary" target="_blank" rel="external">ALAssetsLibrary</a>.</li>
</ul>
<p>The following example shows how you can get an asset to represent the first video in the Saved Photos Album.</p>
<p>为了访问由 iPod 库或者照片应用程序管理的 <code>assets</code> ，你需要得到你想要 <code>asset</code> 的一个 <code>URL</code>。</p>
<ul>
<li>为了访问 iPod 库，创建一个 <a href="https://developer.apple.com/library/ios/documentation/MediaPlayer/Reference/MPMediaQuery_ClassReference/index.html#//apple_ref/occ/cl/MPMediaQuery" target="_blank" rel="external">MPMediaQuery</a> 实例去找到你想要的项目，然后使用<a href="https://developer.apple.com/library/ios/documentation/MediaPlayer/Reference/MPMediaItem_ClassReference/index.html#//apple_ref/c/data/MPMediaItemPropertyAssetURL" target="_blank" rel="external">MPMediaItemPropertyAssetURL</a>得到它的 <code>URL</code> ，</li>
<li>为了访问有照片应用程序管理的 <code>assets</code> ，可以使用 <a href="https://developer.apple.com/library/ios/documentation/AssetsLibrary/Reference/ALAssetsLibrary_Class/index.html#//apple_ref/occ/cl/ALAssetsLibrary" target="_blank" rel="external">ALAssetsLibrary</a>。</li>
</ul>
<p>下面的例子展示了如何获得一个 <code>asset</code> 来保存照片相册中的第一个视频。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ALAssetsLibrary *library = [[ALAssetsLibrary alloc] init];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Enumerate just the photos and videos group by using ALAssetsGroupSavedPhotos.</span></span><br><span class="line">[library enumerateGroupsWithTypes:ALAssetsGroupSavedPhotos usingBlock:^(ALAssetsGroup *group, <span class="built_in">BOOL</span> *stop) &#123;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Within the group enumeration block, filter to enumerate just videos.</span></span><br><span class="line">[group setAssetsFilter:[ALAssetsFilter allVideos]];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// For this example, we're only interested in the first item.</span></span><br><span class="line">[group enumerateAssetsAtIndexes:[<span class="built_in">NSIndexSet</span> indexSetWithIndex:<span class="number">0</span>]</span><br><span class="line">                        options:<span class="number">0</span></span><br><span class="line">                     usingBlock:^(ALAsset *alAsset, <span class="built_in">NSUInteger</span> index, <span class="built_in">BOOL</span> *innerStop) &#123;</span><br><span class="line"> </span><br><span class="line">                         <span class="comment">// The end of the enumeration is signaled by asset == nil.</span></span><br><span class="line">                         <span class="keyword">if</span> (alAsset) &#123;</span><br><span class="line">                             ALAssetRepresentation *representation = [alAsset defaultRepresentation];</span><br><span class="line">                             <span class="built_in">NSURL</span> *url = [representation url];</span><br><span class="line">                             <span class="built_in">AVAsset</span> *avAsset = [<span class="built_in">AVURLAsset</span> URLAssetWithURL:url options:<span class="literal">nil</span>];</span><br><span class="line">                             <span class="comment">// Do something interesting with the AV asset.</span></span><br><span class="line">                         &#125;</span><br><span class="line">                     &#125;];</span><br><span class="line">                 &#125;</span><br><span class="line">                 failureBlock: ^(<span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">                     <span class="comment">// Typically you should handle an error more gracefully than this.</span></span><br><span class="line">                     <span class="built_in">NSLog</span>(<span class="string">@"No groups"</span>);</span><br><span class="line">                 &#125;];</span><br></pre></td></tr></table></figure>
<h2 id="Preparing-an-Asset-for-Use-将-Asset-准备好使用"><a href="#Preparing-an-Asset-for-Use-将-Asset-准备好使用" class="headerlink" title="Preparing an Asset for Use - 将 Asset 准备好使用"></a>Preparing an Asset for Use - 将 <code>Asset</code> 准备好使用</h2><p>Initializing an asset (or track) does not necessarily mean that all the information that you might want to retrieve for that item is immediately available. It may require some time to calculate even the duration of an item (an MP3 file, for example, may not contain summary information). Rather than blocking the current thread while a value is being calculated, you should use the <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intf/AVAsynchronousKeyValueLoading" target="_blank" rel="external">AVAsynchronousKeyValueLoading</a>  protocol to ask for values and get an answer back later through a completion handler you define using a block. (AVAsset and AVAssetTrack conform to the AVAsynchronousKeyValueLoading protocol.)</p>
<p>初始化一个 <code>asset</code> （或者轨道）并不意味着你可能想要检索该项的所有信息是立即可用的。这可能需要一些时间来计算一个项目的持续时间（例如一个 MP3 文件可能不包含摘要信息）。当一个值被计算的时候不应该阻塞当前线程，你应该使用<a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intf/AVAsynchronousKeyValueLoading" target="_blank" rel="external">AVAsynchronousKeyValueLoading</a> 协议去请求值，通过完成处理你定义使用的一个 <code>block</code> 后得到答复。(<code>AVAsset</code> and <code>AVAssetTrack</code> 遵循 <code>AVAsynchronousKeyValueLoading</code> 协议.)</p>
<p>You test whether a value is loaded for a property using <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intfm/AVAsynchronousKeyValueLoading/statusOfValueForKey:error:" target="_blank" rel="external">statusOfValueForKey:error:</a>. When an asset is first loaded, the value of most or all of its properties is <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/c/econst/AVKeyValueStatusUnknown" target="_blank" rel="external">AVKeyValueStatusUnknown</a>. To load a value for one or more properties, you invoke <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intfm/AVAsynchronousKeyValueLoading/loadValuesAsynchronouslyForKeys:completionHandler:" target="_blank" rel="external">loadValuesAsynchronouslyForKeys:completionHandler:</a>. In the completion handler, you take whatever action is appropriate depending on the property’s status. You should always be prepared for loading to not complete successfully, either because it failed for some reason such as a network-based URL being inaccessible, or because the load was canceled.</p>
<p>测试一个值是否是使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intfm/AVAsynchronousKeyValueLoading/statusOfValueForKey:error:" target="_blank" rel="external">statusOfValueForKey:error:</a> 加载为一个属性。当 <code>asset</code> 被首次加载时，大部分的或全部属性值是 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/c/econst/AVKeyValueStatusUnknown" target="_blank" rel="external">AVKeyValueStatusUnknown</a>。为一个或多个属性加载一个值，调用<a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intfm/AVAsynchronousKeyValueLoading/loadValuesAsynchronouslyForKeys:completionHandler:" target="_blank" rel="external">loadValuesAsynchronouslyForKeys:completionHandler:</a>。在完成处理程序中，你采取的行动是否恰当，取决于属性的状态。你应该总是准备加载不会完全成功，它可能有一些原因，比如基于网络的 <code>URL</code>是无法访问的，或者因为负载被取消。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url = &lt;<span class="meta">#A URL that identifies an audiovisual asset such as a movie file#&gt;;</span></span><br><span class="line"><span class="built_in">AVURLAsset</span> *anAsset = [[<span class="built_in">AVURLAsset</span> alloc] initWithURL:url options:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSArray</span> *keys = @[<span class="string">@"duration"</span>];</span><br><span class="line"> </span><br><span class="line">[asset loadValuesAsynchronouslyForKeys:keys completionHandler:^() &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">AVKeyValueStatus</span> tracksStatus = [asset statusOfValueForKey:<span class="string">@"duration"</span> error:&amp;error];</span><br><span class="line">    <span class="keyword">switch</span> (tracksStatus) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">AVKeyValueStatusLoaded</span>:</span><br><span class="line">            [<span class="keyword">self</span> updateUserInterfaceForDuration];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">AVKeyValueStatusFailed</span>:</span><br><span class="line">            [<span class="keyword">self</span> reportError:error forAsset:asset];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">AVKeyValueStatusCancelled</span>:</span><br><span class="line">            <span class="comment">// Do whatever is appropriate for cancelation.</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>If you want to prepare an asset for playback, you should load its tracks property. For more about playing assets, see Playback.</p>
<p>如果你想准备一个 <code>asset</code> 去播放，你应该加载它的轨道属性。更多有关播放 <code>assets</code>，请看 <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/02_Playback.html#//apple_ref/doc/uid/TP40010188-CH3-SW1" target="_blank" rel="external">Playback</a></p>
<h2 id="Getting-Still-Images-From-a-Video-从视频中获取静态图像"><a href="#Getting-Still-Images-From-a-Video-从视频中获取静态图像" class="headerlink" title="Getting Still Images From a Video - 从视频中获取静态图像"></a>Getting Still Images From a Video - 从视频中获取静态图像</h2><p>To get still images such as thumbnails from an asset for playback, you use an AVAssetImageGenerator object. You initialize an image generator with your asset. Initialization may succeed, though, even if the asset possesses no visual tracks at the time of initialization, so if necessary you should test whether the asset has any tracks with the visual characteristic using tracksWithMediaCharacteristic:.</p>
<p>为了从一个准备播放的 <code>asset</code> 中得到静态图像，比如缩略图，可以使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetImageGenerator_Class/index.html#//apple_ref/occ/cl/AVAssetImageGenerator" target="_blank" rel="external">AVAssetImageGenerator</a> 对象。用你的 <code>asset</code> 初始化一个图像发生器。不过即使 <code>asset</code> 进程在初始化的时候没有视觉跟踪，也可以成功，所以如果有必要，你应该测试一下， <code>asset</code> 是否有轨道有使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsset_Class/index.html#//apple_ref/occ/instm/AVAsset/tracksWithMediaCharacteristic:" target="_blank" rel="external">tracksWithMediaCharacteristic</a> 的视觉特征。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">AVAsset anAsset = &lt;#Get an asset#&gt;;</span><br><span class="line">if ([[anAsset tracksWithMediaType:AVMediaTypeVideo] count] &gt; 0) &#123;</span><br><span class="line">    AVAssetImageGenerator *imageGenerator =</span><br><span class="line">        [AVAssetImageGenerator assetImageGeneratorWithAsset:anAsset];</span><br><span class="line">    // Implementation continues...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You can configure several aspects of the image generator, for example, you can specify the maximum dimensions for the images it generates and the aperture mode using maximumSize and apertureMode respectively.You can then generate a single image at a given time, or a series of images. You must ensure that you keep a strong reference to the image generator until it has generated all the images.</p>
<p>你可以配置几个图像发生器的部分，例如，可以指定生成的图像采用最大值，并且光圈的模式分别使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetImageGenerator_Class/index.html#//apple_ref/occ/instm/AVAssetImageGenerator/maximumSize" target="_blank" rel="external">maximumSize</a> 和 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetImageGenerator_Class/index.html#//apple_ref/occ/instm/AVAssetImageGenerator/apertureMode" target="_blank" rel="external">apertureMode</a> 。然后可以在给定的时间生成一个单独的图像，或者一系列图像。你必须确定，在生成所有图像之前，必须对图像生成器保持一个强引用。</p>
<h3 id="Generating-a-Single-Image-生成一个单独的图像"><a href="#Generating-a-Single-Image-生成一个单独的图像" class="headerlink" title="Generating a Single Image - 生成一个单独的图像"></a>Generating a Single Image - 生成一个单独的图像</h3><p>You use copyCGImageAtTime:actualTime:error: to generate a single image at a specific time. AVFoundation may not be able to produce an image at exactly the time you request, so you can pass as the second argument a pointer to a CMTime that upon return contains the time at which the image was actually generated.</p>
<p>使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetImageGenerator_Class/index.html#//apple_ref/occ/instm/AVAssetImageGenerator/copyCGImageAtTime:actualTime:error:" target="_blank" rel="external">copyCGImageAtTime:actualTime:error:</a> 方法在指定时间生成一个图像。AVFoundation 在你要求的确切时间可能无法产生一个图像，所以你可以将一个指向 CMTime 的指针当做第二个参数穿过去，这个指针返回的时候包含图像被实际生成的时间。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">AVAsset</span> *myAsset = &lt;<span class="meta">#An asset#&gt;];</span></span><br><span class="line"><span class="built_in">AVAssetImageGenerator</span> *imageGenerator = [[<span class="built_in">AVAssetImageGenerator</span> alloc] initWithAsset:myAsset];</span><br><span class="line"> </span><br><span class="line">Float64 durationSeconds = CMTimeGetSeconds([myAsset duration]);</span><br><span class="line">CMTime midpoint = CMTimeMakeWithSeconds(durationSeconds/<span class="number">2.0</span>, <span class="number">600</span>);</span><br><span class="line"><span class="built_in">NSError</span> *error;</span><br><span class="line">CMTime actualTime;</span><br><span class="line"> </span><br><span class="line"><span class="built_in">CGImageRef</span> halfWayImage = [imageGenerator <span class="keyword">copy</span><span class="built_in">CGImageAtTime</span>:midpoint actualTime:&amp;actualTime error:&amp;error];</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (halfWayImage != <span class="literal">NULL</span>) &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">NSString</span> *actualTimeString = (<span class="built_in">NSString</span> *)CMTimeCopyDescription(<span class="literal">NULL</span>, actualTime);</span><br><span class="line">    <span class="built_in">NSString</span> *requestedTimeString = (<span class="built_in">NSString</span> *)CMTimeCopyDescription(<span class="literal">NULL</span>, midpoint);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Got halfWayImage: Asked for %@, got %@"</span>, requestedTimeString, actualTimeString);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Do something interesting with the image.</span></span><br><span class="line">    <span class="built_in">CGImageRelease</span>(halfWayImage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Generating-a-Sequence-of-Images-生成一系列图像"><a href="#Generating-a-Sequence-of-Images-生成一系列图像" class="headerlink" title="Generating a Sequence of Images - 生成一系列图像"></a>Generating a Sequence of Images - 生成一系列图像</h2><p>To generate a series of images, you send the image generator a generateCGImagesAsynchronouslyForTimes:completionHandler: message. The first argument is an array of NSValue objects, each containing a CMTime structure, specifying the asset times for which you want images to be generated. The second argument is a block that serves as a callback invoked for each image that is generated. The block arguments provide a result constant that tells you whether the image was created successfully or if the operation was canceled, and, as appropriate:</p>
<ul>
<li>The image</li>
<li>The time for which you requested the image and the actual time for which the image was generated</li>
<li>An error object that describes the reason generation failed</li>
</ul>
<p>In your implementation of the block, check the result constant to determine whether the image was created. In addition, ensure that you keep a strong reference to the image generator until it has finished creating the images.</p>
<p>生成一系列图像，可以给图像生成器发送 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetImageGenerator_Class/index.html#//apple_ref/occ/instm/AVAssetImageGenerator/generateCGImagesAsynchronouslyForTimes:completionHandler:" target="_blank" rel="external">generateCGImagesAsynchronouslyForTimes:completionHandler:</a> 消息。第一个参数是一个 <code>NSValue</code> 对象的数组，每个都包含一个 <code>CMTime</code> 结构体，指定了图像想要被生成的 <code>asset</code> 时间。<code>block</code> 参数提供了一个结果，这个结果包含了告诉你是否图像被成功生成，或者操作某些情况下被取消。结果：</p>
<ul>
<li>图像</li>
<li>你要求的图像和图像生成的实际时间</li>
<li>一个 <code>error</code> 对象，描述了生成失败的原因</li>
</ul>
<p>在 <code>block</code> 的实现中，检查结果常数，来确定图像是否被创建。此外，在完成创建图像之前，确保保持一个强引用给图像生成器。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">AVAsset</span> *myAsset = &lt;<span class="meta">#An asset#&gt;];</span></span><br><span class="line"><span class="comment">// Assume: @property (strong) AVAssetImageGenerator *imageGenerator;</span></span><br><span class="line"><span class="keyword">self</span>.imageGenerator = [<span class="built_in">AVAssetImageGenerator</span> assetImageGeneratorWithAsset:myAsset];</span><br><span class="line"> </span><br><span class="line">Float64 durationSeconds = CMTimeGetSeconds([myAsset duration]);</span><br><span class="line">CMTime firstThird = CMTimeMakeWithSeconds(durationSeconds/<span class="number">3.0</span>, <span class="number">600</span>);</span><br><span class="line">CMTime secondThird = CMTimeMakeWithSeconds(durationSeconds*<span class="number">2.0</span>/<span class="number">3.0</span>, <span class="number">600</span>);</span><br><span class="line">CMTime end = CMTimeMakeWithSeconds(durationSeconds, <span class="number">600</span>);</span><br><span class="line"><span class="built_in">NSArray</span> *times = @[<span class="built_in">NSValue</span> valueWithCMTime:kCMTimeZero],</span><br><span class="line">                  [<span class="built_in">NSValue</span> valueWithCMTime:firstThird], [<span class="built_in">NSValue</span> valueWithCMTime:secondThird],</span><br><span class="line">                  [<span class="built_in">NSValue</span> valueWithCMTime:end]];</span><br><span class="line"> </span><br><span class="line">[imageGenerator generate<span class="built_in">CGImagesAsynchronouslyForTimes</span>:times</span><br><span class="line">                completionHandler:^(CMTime requestedTime, <span class="built_in">CGImageRef</span> image, CMTime actualTime,</span><br><span class="line">                                    <span class="built_in">AVAssetImageGeneratorResult</span> result, <span class="built_in">NSError</span> *error) &#123;</span><br><span class="line"> </span><br><span class="line">                <span class="built_in">NSString</span> *requestedTimeString = (<span class="built_in">NSString</span> *)</span><br><span class="line">                    <span class="built_in">CFBridgingRelease</span>(CMTimeCopyDescription(<span class="literal">NULL</span>, requestedTime));</span><br><span class="line">                <span class="built_in">NSString</span> *actualTimeString = (<span class="built_in">NSString</span> *)</span><br><span class="line">                    <span class="built_in">CFBridgingRelease</span>(CMTimeCopyDescription(<span class="literal">NULL</span>, actualTime));</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"Requested: %@; actual %@"</span>, requestedTimeString, actualTimeString);</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (result == <span class="built_in">AVAssetImageGeneratorSucceeded</span>) &#123;</span><br><span class="line">                    <span class="comment">// Do something interesting with the image.</span></span><br><span class="line">                &#125;</span><br><span class="line"> </span><br><span class="line">                <span class="keyword">if</span> (result == <span class="built_in">AVAssetImageGeneratorFailed</span>) &#123;</span><br><span class="line">                    <span class="built_in">NSLog</span>(<span class="string">@"Failed with error: %@"</span>, [error localizedDescription]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (result == <span class="built_in">AVAssetImageGeneratorCancelled</span>) &#123;</span><br><span class="line">                    <span class="built_in">NSLog</span>(<span class="string">@"Canceled"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">  &#125;];</span><br></pre></td></tr></table></figure>
<p>You can cancel the generation of the image sequence by sending the image generator a cancelAllCGImageGeneration message.</p>
<p>你发送给图像生成器一个 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetImageGenerator_Class/index.html#//apple_ref/occ/instm/AVAssetImageGenerator/cancelAllCGImageGeneration" target="_blank" rel="external">cancelAllCGImageGeneration</a> 消息，可以取消队列中的图像生成。</p>
<h2 id="Trimming-and-Transcoding-a-Movie-微调和转化为一个电影"><a href="#Trimming-and-Transcoding-a-Movie-微调和转化为一个电影" class="headerlink" title="Trimming and Transcoding a Movie - 微调和转化为一个电影"></a>Trimming and Transcoding a Movie - 微调和转化为一个电影</h2><p>You can transcode a movie from one format to another, and trim a movie, using an AVAssetExportSession object. The workflow is shown in Figure 1-1. An export session is a controller object that manages asynchronous export of an asset. You initialize the session using the asset you want to export and the name of a export preset that indicates the export options you want to apply (see allExportPresets). You then configure the export session to specify the output URL and file type, and optionally other settings such as the metadata and whether the output should be optimized for network use.</p>
<blockquote>
<p><code>asset</code>一律使用“资产”代码，切换还要加``略麻烦</p>
</blockquote>
<p>你可以使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetExportSession_Class/index.html#//apple_ref/occ/cl/AVAssetExportSession" target="_blank" rel="external">AVAssetExportSession</a> 对象，将一个电影的编码进行转换，并且对电影进行微调。工作流程如图1-1所示。一个 <code>export session</code> 是一个控制器对象，管理一个资产的异步导出。使用想要导出的资产初始化一个 <code>session</code> 和输出设定的名称，这个输出设定表明你想申请的导出选项（<a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetExportSession_Class/index.html#//apple_ref/occ/clm/AVAssetExportSession/allExportPresets" target="_blank" rel="external">allExportPresets</a>）。然后配置导出会话去指定输出的 URL 和文件类型，以及其他可选的设定，比如元数据，是否将输出优化用于网络使用。</p>
<center><br><img src="http://ww4.sinaimg.cn/large/a9c4d5f6gw1f6f7bsp7lbj20oo04u74b.jpg" alt="Figure 1-1  The export session workflow"><br></center>

<p>You can check whether you can export a given asset using a given preset using exportPresetsCompatibleWithAsset: as illustrated in this example:</p>
<p>你可以检查你能否用给定的预设导出一个给定的资产，使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetExportSession_Class/index.html#//apple_ref/occ/clm/AVAssetExportSession/exportPresetsCompatibleWithAsset:" target="_blank" rel="external">exportPresetsCompatibleWithAsset:</a> 作为示例。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">AVAsset</span> *anAsset = &lt;<span class="meta">#Get an asset#&gt;;</span></span><br><span class="line"><span class="built_in">NSArray</span> *compatiblePresets = [<span class="built_in">AVAssetExportSession</span> exportPresetsCompatibleWithAsset:anAsset];</span><br><span class="line"><span class="keyword">if</span> ([compatiblePresets containsObject:<span class="built_in">AVAssetExportPresetLowQuality</span>]) &#123;</span><br><span class="line">    <span class="built_in">AVAssetExportSession</span> *exportSession = [[<span class="built_in">AVAssetExportSession</span> alloc]</span><br><span class="line">        initWithAsset:anAsset presetName:<span class="built_in">AVAssetExportPresetLowQuality</span>];</span><br><span class="line">    <span class="comment">// Implementation continues.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You complete the configuration of the session by providing the output URL (The URL must be a file URL.) AVAssetExportSession can infer the output file type from the URL’s path extension; typically, however, you set it directly using outputFileType. You can also specify additional properties such as the time range, a limit for the output file length, whether the exported file should be optimized for network use, and a video composition. The following example illustrates how to use the timeRange property to trim the movie:</p>
<p>完成会话的配置，是由输出的 <code>URL</code> （URL 必须是文件的 URL）控制的。AVAssetExportSession可以从 <code>URL</code> 的路径延伸推断输出文件的类型。然而通常情况下，直接使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetExportSession_Class/index.html#//apple_ref/occ/instm/AVAssetExportSession/setOutputFileType:" target="_blank" rel="external">outputFileType</a> 设定。还可以指定附加属性，如时间范围、输出文件长度的限制、导出的文件是否应该为了网络使用而优化、还有一个视频的构成。下面的示例展示了如果使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetExportSession_Class/index.html#//apple_ref/occ/instm/AVAssetExportSession/setTimeRange:" target="_blank" rel="external">timeRange</a> 属性修剪电影。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">exportSession.outputURL = &lt;<span class="meta">#A file URL#&gt;;</span></span><br><span class="line">exportSession.outputFileType = <span class="built_in">AVFileTypeQuickTimeMovie</span>;</span><br><span class="line"> </span><br><span class="line">CMTime start = CMTimeMakeWithSeconds(<span class="number">1.0</span>, <span class="number">600</span>);</span><br><span class="line">CMTime duration = CMTimeMakeWithSeconds(<span class="number">3.0</span>, <span class="number">600</span>);</span><br><span class="line">CMTimeRange range = CMTimeRangeMake(start, duration);</span><br><span class="line">exportSession.timeRange = range;</span><br></pre></td></tr></table></figure>
<p>To create the new file, you invoke exportAsynchronouslyWithCompletionHandler:. The completion handler block is called when the export operation finishes; in your implementation of the handler, you should check the session’s status value to determine whether the export was successful, failed, or was canceled:</p>
<p>调用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetExportSession_Class/index.html#//apple_ref/occ/instm/AVAssetExportSession/exportAsynchronouslyWithCompletionHandler:" target="_blank" rel="external">exportAsynchronouslyWithCompletionHandler:</a> 创建新的文件。当导出操作完成的时候完成处理的 <code>block</code> 被调用，你应该检查会话的 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetExportSession_Class/index.html#//apple_ref/occ/instp/AVAssetExportSession/status" target="_blank" rel="external">status</a> 值，去判断导出是否成功、失败或者被取消。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[exportSession exportAsynchronouslyWithCompletionHandler:^&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">switch</span> ([exportSession status]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">AVAssetExportSessionStatusFailed</span>:</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"Export failed: %@"</span>, [[exportSession error] localizedDescription]);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">AVAssetExportSessionStatusCancelled</span>:</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"Export canceled"</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>You can cancel the export by sending the session a cancelExport message.</p>
<p>The export will fail if you try to overwrite an existing file, or write a file outside of the application’s sandbox. It may also fail if:</p>
<ul>
<li>There is an incoming phone call</li>
<li>Your application is in the background and another application starts playback</li>
</ul>
<p>In these situations, you should typically inform the user that the export failed, then allow the user to restart the export.</p>
<p>你可以通过给会话发送一个 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetExportSession_Class/index.html#//apple_ref/occ/instm/AVAssetExportSession/cancelExport" target="_blank" rel="external">cancelExport</a> 消息来取消导出。</p>
<p>如果你尝试覆盖一个现有的文件或者在应用程序的沙盒外部写一个文件，都将会是导出失败。如果发生下面情况也可能失败：</p>
<ul>
<li>有一个来电</li>
<li>你的应用程序在后台并且另一个程序开始播放</li>
</ul>
<p>在这种情况下，你通常应该通知用户导出失败，然后允许用户重新启动导出。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoferzhang.com/post/20160803AVFoundation02UsingAssets/" data-title="AVFoundation Programming Guide(官方文档翻译2)Using Assets - 使用Assets | Mathematical Method, the Way of the World" data-tsina="2848249334" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/post/20160803AVFoundation03Playback/" title="AVFoundation Programming Guide(官方文档翻译3)Playback - 播放">
  <strong>上一篇：</strong><br/>
  <span>
  AVFoundation Programming Guide(官方文档翻译3)Playback - 播放</span>
</a>
</div>


<div class="next">
<a href="/post/20160803AVFoundation01Introduction/"  title="AVFoundation Programming Guide(官方文档翻译1)About AVFoundation - AVFoundation概述">
 <strong>下一篇：</strong><br/> 
 <span>AVFoundation Programming Guide(官方文档翻译1)About AVFoundation - AVFoundation概述
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="post/20160803AVFoundation02UsingAssets/" data-title="AVFoundation Programming Guide(官方文档翻译2)Using Assets - 使用Assets" data-url="http://yoferzhang.com/post/20160803AVFoundation02UsingAssets/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Using-Assets-使用Assets"><span class="toc-number">1.</span> <span class="toc-text">Using Assets - 使用Assets</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-an-Asset-Object-创建一个Asset对象"><span class="toc-number">1.1.</span> <span class="toc-text">Creating an Asset Object - 创建一个Asset对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Options-for-Initializing-an-Asset-初始化一个Asset的选择"><span class="toc-number">1.1.1.</span> <span class="toc-text">Options for Initializing an Asset - 初始化一个Asset的选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Accessing-the-User’s-Assets-访问用户的Assets"><span class="toc-number">1.1.2.</span> <span class="toc-text">Accessing the User’s Assets - 访问用户的Assets</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preparing-an-Asset-for-Use-将-Asset-准备好使用"><span class="toc-number">1.2.</span> <span class="toc-text">Preparing an Asset for Use - 将 Asset 准备好使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-Still-Images-From-a-Video-从视频中获取静态图像"><span class="toc-number">1.3.</span> <span class="toc-text">Getting Still Images From a Video - 从视频中获取静态图像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Generating-a-Single-Image-生成一个单独的图像"><span class="toc-number">1.3.1.</span> <span class="toc-text">Generating a Single Image - 生成一个单独的图像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Generating-a-Sequence-of-Images-生成一系列图像"><span class="toc-number">1.4.</span> <span class="toc-text">Generating a Sequence of Images - 生成一系列图像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Trimming-and-Transcoding-a-Movie-微调和转化为一个电影"><span class="toc-number">1.5.</span> <span class="toc-text">Trimming and Transcoding a Movie - 微调和转化为一个电影</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="yoferzhang" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/C/" title="C++">C++<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/C语言/" title="C语言">C语言<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>23</sup></a></li>
		  
		
		  
			<li><a href="/categories/建立博客/" title="建立博客">建立博客<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/快速记忆/" title="快速记忆">快速记忆<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/渔/" title="渔">渔<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书笔记/" title="读书笔记">读书笔记<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/随笔/" title="随笔">随笔<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://hexo.io/" target="_blank" title="Hexo">Hexo</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/yoferzhang" target="_blank" title="Github">Github</a>
            
          </li>
        
          <li>
            
            	<a href="http://ww3.sinaimg.cn/large/a9c4d5f6jw1f2cbilh1uyj2076076t97.jpg" target="_blank" title="WeChat">WeChat</a>
            
          </li>
        
          <li>
            
            	<a href="https://cn.linkedin.com/in/耀琦-张-771388117" target="_blank" title="LinkedIn">LinkedIn</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Yofer Zhang in Tencent. <br/>
			This is my blog,thank you to here.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2848249334" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/yoferzhang" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/yofer-zhang" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/LuciferZhangyq" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/luciferzhang" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/耀琦-张-771388117?trk=hp-identity-name" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/zyq522376829" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/yoferzhang" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		<a href="https://plus.google.com/110295955443575724222?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:522376829@qq.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Yofer Zhang">Yofer Zhang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"yoferzhang"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//yoferzhang.github.io/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a6dda28cb6f26de955e11a3716d6ce9b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
