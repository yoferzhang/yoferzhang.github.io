<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="Yofer Zhang" />



<meta name="description" content="版权声明：本文为博主原创，如需转载请注明出处。

1 有关核心动画">
<meta property="og:type" content="article">
<meta property="og:title" content="【iOS】Core Animation Programming Guide 核心动画编程指南">
<meta property="og:url" content="http://yoferzhang.com/post/20160905CoreAnimationProgrammingGuide/index.html">
<meta property="og:site_name" content="YoferZhang 的博客">
<meta property="og:description" content="版权声明：本文为博主原创，如需转载请注明出处。

1 有关核心动画">
<meta property="og:image" content="http://ww2.sinaimg.cn/mw690/a9c4d5f6gw1f7ihw01x5dj20eo0auaay.jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/a9c4d5f6gw1f7io9tnsp7j21430ezdk0.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7iogy5x0zj20yu0mcjw1.jpg">
<meta property="og:image" content="http://ww2.sinaimg.cn/mw690/a9c4d5f6gw1f7iorcrjg7j20ul0c4mzv.jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/mw690/a9c4d5f6gw1f7iowm9t9wj20po0b93zi.jpg">
<meta property="og:image" content="http://ww4.sinaimg.cn/large/a9c4d5f6gw1f7ip2b9d0nj210i14caew.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/a9c4d5f6gw1f7ip53pw8pj210i0ziwil.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7ipd2pvucj20fu0790t2.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7iph2e6nmj20hl0kfdgk.jpg">
<meta property="og:image" content="http://ww2.sinaimg.cn/mw690/a9c4d5f6gw1f7ipqm15vej20ys0l3777.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7ipsmeoppj213l0v3acu.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7iy72b827j20sz0i8wg6.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/a9c4d5f6gw1f7iybek8e7j20pe0djdkc.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7iyns91knj20j30ff0uh.jpg">
<meta property="og:image" content="http://ww2.sinaimg.cn/mw690/a9c4d5f6gw1f7jmka87j0j20re0inmxu.jpg">
<meta property="og:image" content="http://ww2.sinaimg.cn/mw690/a9c4d5f6gw1f7jn4qu1oxj20lx0bptay.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/a9c4d5f6gw1f7jtndq23oj221u0po468.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7ju4oniryj20p60kf409.jpg">
<meta property="og:updated_time" content="2017-02-09T05:23:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【iOS】Core Animation Programming Guide 核心动画编程指南">
<meta name="twitter:description" content="版权声明：本文为博主原创，如需转载请注明出处。

1 有关核心动画">
<meta name="twitter:image" content="http://ww2.sinaimg.cn/mw690/a9c4d5f6gw1f7ihw01x5dj20eo0auaay.jpg">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="YoferZhang 的博客" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.png">





    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>【iOS】Core Animation Programming Guide 核心动画编程指南 | YoferZhang 的博客</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: false,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: undefined
    }
</script>


    <script> yiliaConfig.jquery_ui = [false]; </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/Image/author.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">Yofer Zhang</a></h1>
        </hgroup>

        
        <p class="header-subtitle">数学出身，功底扎实，热爱编程，虽然编程起步晚，但是冲劲十足。</p>
        

        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:yoferzhang@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="https://github.com/yoferzhang" title="GitHub"></a>
                            
                                <a class="fa 知乎" href="https://www.zhihu.com/people/yoferzhang/" title="知乎"></a>
                            
                                <a class="fa 豆瓣" href="https://www.douban.com/people/zyq522376829/" title="豆瓣"></a>
                            
                                <a class="fa CSDN" href="http://blog.csdn.net/zyq522376829" title="CSDN"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Adagrad/">Adagrad</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AlphaGo/">AlphaGo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C语言/">C语言</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HFS/">HFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NBA/">NBA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NTFS/">NTFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/calloc/">calloc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/jacman/">jacman</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/malloc/">malloc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/markdown/">markdown</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/oc/">oc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/relloc/">relloc</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/交叉检验/">交叉检验</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/健身/">健身</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内存四区/">内存四区</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/分类/">分类</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客/">博客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/回归/">回归</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/大脑/">大脑</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习/">学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习率/">学习率</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/心得/">心得</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/快速记忆/">快速记忆</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/损失函数/">损失函数</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数字记忆/">数字记忆</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/方差/">方差</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/无偏估计/">无偏估计</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/梯度下降法/">梯度下降法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/泰勒展开式/">泰勒展开式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/深度学习/">深度学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/番茄/">番茄</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/磁盘格式/">磁盘格式</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/科比/">科比</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/笔记/">笔记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/纸牌/">纸牌</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/线性回归/">线性回归</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/结构体，内存，对齐/">结构体，内存，对齐</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/网站/">网站</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/联想/">联想</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/肌肉/">肌肉</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/腾讯/">腾讯</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/艾宾浩斯/">艾宾浩斯</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/英语/">英语</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/语法/">语法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/读书/">读书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随笔/">随笔</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/随笔，测试/">随笔，测试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/黑苹果/">黑苹果</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                      <a class="main-nav-link switch-friends-link" href="http://moxfive.xyz/">MOxFIVE</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">Amor Fati</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">Yofer Zhang</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/Image/author.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">Yofer Zhang</a></h1>
            </hgroup>
            
            <p class="header-subtitle">数学出身，功底扎实，热爱编程，虽然编程起步晚，但是冲劲十足。</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:yoferzhang@gmail.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="https://github.com/yoferzhang" title="GitHub"></a>
                            
                                <a class="fa 知乎" target="_blank" href="https://www.zhihu.com/people/yoferzhang/" title="知乎"></a>
                            
                                <a class="fa 豆瓣" target="_blank" href="https://www.douban.com/people/zyq522376829/" title="豆瓣"></a>
                            
                                <a class="fa CSDN" target="_blank" href="http://blog.csdn.net/zyq522376829" title="CSDN"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-20160905CoreAnimationProgrammingGuide" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/post/20160905CoreAnimationProgrammingGuide/" class="article-date">
      <time datetime="2016-09-05T02:18:23.000Z" itemprop="datePublished">2016-09-05</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      【iOS】Core Animation Programming Guide 核心动画编程指南
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/iOS/">iOS</a>
    </div>


        
        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <blockquote>
<p>版权声明：本文为博主原创，如需转载请注明出处。</p>
</blockquote>
<h1 id="1-有关核心动画"><a href="#1-有关核心动画" class="headerlink" title="1 有关核心动画"></a>1 有关核心动画</h1><center><br><img src="http://ww2.sinaimg.cn/mw690/a9c4d5f6gw1f7ihw01x5dj20eo0auaay.jpg" alt=""><br></center>

<a id="more"></a>
<h2 id="1-1-概览"><a href="#1-1-概览" class="headerlink" title="1.1 概览"></a>1.1 概览</h2><h3 id="1-1-1-Core-Animation-管理应用的内容"><a href="#1-1-1-Core-Animation-管理应用的内容" class="headerlink" title="1.1.1 Core Animation 管理应用的内容"></a>1.1.1 Core Animation 管理应用的内容</h3><p>核心是 layer objects，</p>
<h3 id="1-1-2-更改-layer-触发动画"><a href="#1-1-2-更改-layer-触发动画" class="headerlink" title="1.1.2 更改 layer 触发动画"></a>1.1.2 更改 layer 触发动画</h3><p>Like views, layer objects have a bounds rectangle, a position onscreen, an opacity, a transform, and many other visually-oriented properties that can be modified. 更改这些属性的时候有隐式动画，可以明确指定动画行为。</p>
<h3 id="1-1-3-layer可以组织成层级结构"><a href="#1-1-3-layer可以组织成层级结构" class="headerlink" title="1.1.3 layer可以组织成层级结构"></a>1.1.3 layer可以组织成层级结构</h3><h3 id="1-1-4-action-让你更改图层的默认行为"><a href="#1-1-4-action-让你更改图层的默认行为" class="headerlink" title="1.1.4 action 让你更改图层的默认行为"></a>1.1.4 action 让你更改图层的默认行为</h3><p>隐式layer动画是使用 action objects。可以创建自己的 action objects ，实现自定义动画，或者也能实现其他类型的行为。</p>
<h2 id="1-2-如果使用这个文档"><a href="#1-2-如果使用这个文档" class="headerlink" title="1.2 如果使用这个文档"></a>1.2 如果使用这个文档</h2><h2 id="1-3-预备工作"><a href="#1-3-预备工作" class="headerlink" title="1.3 预备工作"></a>1.3 预备工作</h2><p>先熟悉 <a href="https://developer.apple.com/library/ios/documentation/WindowsViews/Conceptual/ViewPG_iPhoneOS/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009503" target="_blank" rel="external">View Programming Guide for iOS.</a></p>
<h1 id="核心动画基础"><a href="#核心动画基础" class="headerlink" title="核心动画基础"></a>核心动画基础</h1><h2 id="layer-提供绘图和动画的基础"><a href="#layer-提供绘图和动画的基础" class="headerlink" title="layer 提供绘图和动画的基础"></a>layer 提供绘图和动画的基础</h2><p>Layer objects 对核心。layer只是管理内容和可视化属性，所以可以将layer想成 model 对象</p>
<h3 id="基于-layer-的绘图模型"><a href="#基于-layer-的绘图模型" class="headerlink" title="基于 layer 的绘图模型"></a>基于 layer 的绘图模型</h3><center><br><img src="http://ww4.sinaimg.cn/large/a9c4d5f6gw1f7io9tnsp7j21430ezdk0.jpg" alt="核心动画如何绘制内容"><br></center>

<p>对于 view 中调用 <code>drawRect:</code> 方法，非常的损耗，因为这在线程上使用CPU。核心动画通过在硬件上缓存位图来达到同样或相似的效果。</p>
<h3 id="基于-layer-的动画"><a href="#基于-layer-的动画" class="headerlink" title="基于 layer 的动画"></a>基于 layer 的动画</h3><center><br><img src="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7iogy5x0zj20yu0mcjw1.jpg" alt="可以在 layer 上执行动画的例子"><br></center>

<h2 id="layer-对象定义自己的几何"><a href="#layer-对象定义自己的几何" class="headerlink" title="layer 对象定义自己的几何"></a>layer 对象定义自己的几何</h2><p>layer 也有像view 有的一些属性，frame bounds，并且也有类似 anchor poing(锚点)这种 view 没有的属性。</p>
<h3 id="layer-使用两种类型的坐标系"><a href="#layer-使用两种类型的坐标系" class="headerlink" title="layer 使用两种类型的坐标系"></a>layer 使用两种类型的坐标系</h3><p>point-based coordinate systems 和 unit coordinate systems</p>
<p>通常使用 point-based 坐标系指定 layer 的大小和位置，</p>
<center><br><img src="http://ww2.sinaimg.cn/mw690/a9c4d5f6gw1f7iorcrjg7j20ul0c4mzv.jpg" alt="iOS 和 OS X 的默认 layer geometries"><br></center>

<p>unit coordinate system (单位坐标系)是用来表示当 layer 的大小变化的时候哪些属性可能改变。可以认为单位坐标系指定所有可能变化值的百分比。</p>
<center><br><img src="http://ww4.sinaimg.cn/mw690/a9c4d5f6gw1f7iowm9t9wj20po0b93zi.jpg" alt="The default unit coordinate systems for iOS and OS X"><br></center>

<h3 id="锚点影响几何操作"><a href="#锚点影响几何操作" class="headerlink" title="锚点影响几何操作"></a>锚点影响几何操作</h3><center><br><img src="http://ww4.sinaimg.cn/large/a9c4d5f6gw1f7ip2b9d0nj210i14caew.jpg" alt="How the anchor point affects the layer’s position property"><br></center>

<center><br><img src="http://ww1.sinaimg.cn/large/a9c4d5f6gw1f7ip53pw8pj210i0ziwil.jpg" alt="How the anchor point affects layer transformations"><br></center>

<h3 id="layer-可以在三维空间中操作"><a href="#layer-可以在三维空间中操作" class="headerlink" title="layer 可以在三维空间中操作"></a>layer 可以在三维空间中操作</h3><center><br><img src="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7ipd2pvucj20fu0790t2.jpg" alt="Converting a coordinate using matrix math"><br></center>

<center><br><img src="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7iph2e6nmj20hl0kfdgk.jpg" alt="Matrix configurations for common transformations"><br></center>

<p><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/CoreAnimation_functions/index.html#//apple_ref/doc/uid/TP40004512" target="_blank" rel="external">Core Animation Functions Reference.</a></p>
<h2 id="layer-树反映了动画状态的不同方面"><a href="#layer-树反映了动画状态的不同方面" class="headerlink" title="layer 树反映了动画状态的不同方面"></a>layer 树反映了动画状态的不同方面</h2><p>有3个 layer 对象集合：</p>
<ul>
<li>model layer tree 中的对象是模型对象，存储动画的目标值</li>
<li>presentation tree包含动画运行中的值。你应该从来都不要去修改这个 tree 中的对象。使用这些对象读取当前动画的值，或者使用这些值开始新的动画。</li>
<li>render tree 中的对象执行实际的动画，这是核心动画私有的</li>
</ul>
<center><br><img src="http://ww2.sinaimg.cn/mw690/a9c4d5f6gw1f7ipqm15vej20ys0l3777.jpg" alt="Layers associated with a window"><br></center>

<center><br><img src="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7ipsmeoppj213l0v3acu.jpg" alt="The layer trees for a window"><br></center>

<h2 id="layer-和-view-之间的关系"><a href="#layer-和-view-之间的关系" class="headerlink" title="layer 和 view 之间的关系"></a>layer 和 view 之间的关系</h2><p>layer 不是 view 的替代品，不能单独靠layer 对象创建一个可视化的界面。layer 提供了 view 的基础。layer 使得view内容的绘制和动画更加有效，并且动画有较高的帧率，就是更流畅。layer不能处理事件，不能绘制内容，不能参与到响应链等等。所以应用必须有一个或多个 view 来处理这种交互</p>
<h1 id="设置-layer-对象"><a href="#设置-layer-对象" class="headerlink" title="设置 layer 对象"></a>设置 layer 对象</h1><h2 id="激活核心动画支持"><a href="#激活核心动画支持" class="headerlink" title="激活核心动画支持"></a>激活核心动画支持</h2><h2 id="更改与视图相关的-layer-对象"><a href="#更改与视图相关的-layer-对象" class="headerlink" title="更改与视图相关的 layer 对象"></a>更改与视图相关的 layer 对象</h2><h3 id="改变-UIView-使用的-layer-class"><a href="#改变-UIView-使用的-layer-class" class="headerlink" title="改变 UIView 使用的 layer class"></a>改变 UIView 使用的 layer class</h3><p>重写 layerClass 类方法 返回想要替换的 类对象。</p>
<p>指定 view 的 layer 类</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">+ (Class) layerClass &#123;</span><br><span class="line">   <span class="keyword">return</span> [<span class="built_in">CAMetalLayer</span> class];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Changing-the-Layer-Class-Used-By-NSView"><a href="#Changing-the-Layer-Class-Used-By-NSView" class="headerlink" title="Changing the Layer Class Used By NSView"></a>Changing the Layer Class Used By NSView</h3><h3 id="不同的-layer-类提供专属行为"><a href="#不同的-layer-类提供专属行为" class="headerlink" title="不同的 layer 类提供专属行为"></a>不同的 layer 类提供专属行为</h3><p>CALayer子类及其用法</p>
<table>
<thead>
<tr>
<th>Class</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href=""></a></td>
<td></td>
</tr>
<tr>
<td><a href=""></a></td>
<td></td>
</tr>
<tr>
<td><a href=""></a></td>
<td></td>
</tr>
<tr>
<td><a href=""></a></td>
<td></td>
</tr>
<tr>
<td><a href=""></a></td>
<td></td>
</tr>
<tr>
<td><a href=""></a></td>
<td></td>
</tr>
<tr>
<td><a href=""></a></td>
<td></td>
</tr>
<tr>
<td><a href=""></a></td>
<td></td>
</tr>
<tr>
<td><a href=""></a></td>
<td></td>
</tr>
<tr>
<td><a href=""></a></td>
<td></td>
</tr>
<tr>
<td><a href=""></a></td>
</tr>
</tbody>
</table>
<h2 id="给-layer-提供内容"><a href="#给-layer-提供内容" class="headerlink" title="给 layer 提供内容"></a>给 layer 提供内容</h2><p>3种方式给layer的位图提供数据：</p>
<ul>
<li>直接给layer对象的 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instp/CALayer/contents" target="_blank" rel="external">contents</a> 属性赋值一个 image 对象。这是最好的方法</li>
<li>给layer赋值一个代理对象，并让代理绘制 layer 的内容。（适合内容周期性的变化，比如随着 view变化）</li>
<li>定义一个 layer 子类，并重写一个它的绘制方法</li>
</ul>
<h3 id="给-layer-内容设置图像"><a href="#给-layer-内容设置图像" class="headerlink" title="给 layer 内容设置图像"></a>给 layer 内容设置图像</h3><p>将image 赋值给 layer必须是 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CGImage/index.html#//apple_ref/c/tdef/CGImageRef" target="_blank" rel="external">CGImageRef</a> 类型。</p>
<h3 id="使用代理给layer提供内容"><a href="#使用代理给layer提供内容" class="headerlink" title="使用代理给layer提供内容"></a>使用代理给layer提供内容</h3><p>代理实现 <code>displayLayer:</code> 方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)displayLayer:(<span class="built_in">CALayer</span> *)theLayer &#123;</span><br><span class="line">    <span class="comment">// Check the value of some state property</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.displayYesImage) &#123;</span><br><span class="line">        <span class="comment">// Display the Yes image</span></span><br><span class="line">        theLayer.contents = [someHelperObject loadStateYesImage];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Display the No image</span></span><br><span class="line">        theLayer.contents = [someHelperObject loadStateNoImage];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代理实现 <code>drawLayer:inContext:</code> 方法</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)drawLayer:(<span class="built_in">CALayer</span> *)theLayer inContext:(<span class="built_in">CGContextRef</span>)theContext &#123;</span><br><span class="line">    <span class="built_in">CGMutablePathRef</span> thePath = <span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">CGPathMoveToPoint</span>(thePath,<span class="literal">NULL</span>,<span class="number">15.0</span>f,<span class="number">15.</span>f);</span><br><span class="line">    <span class="built_in">CGPathAddCurveToPoint</span>(thePath,</span><br><span class="line">                          <span class="literal">NULL</span>,</span><br><span class="line">                          <span class="number">15.</span>f,<span class="number">250.0</span>f,</span><br><span class="line">                          <span class="number">295.0</span>f,<span class="number">250.0</span>f,</span><br><span class="line">                          <span class="number">295.0</span>f,<span class="number">15.0</span>f);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">CGContextBeginPath</span>(theContext);</span><br><span class="line">    <span class="built_in">CGContextAddPath</span>(theContext, thePath);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">CGContextSetLineWidth</span>(theContext, <span class="number">5</span>);</span><br><span class="line">    <span class="built_in">CGContextStrokePath</span>(theContext);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Release the path</span></span><br><span class="line">    <span class="built_in">CFRelease</span>(thePath);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="通过子类给-layer-提供内容"><a href="#通过子类给-layer-提供内容" class="headerlink" title="通过子类给 layer 提供内容"></a>通过子类给 layer 提供内容</h3><ul>
<li>重写 layer 的 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instm/CALayer/display" target="_blank" rel="external">display</a> 方法，并使用它直接设置contents属性</li>
<li>重写 layer 的 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instm/CALayer/drawInContext:" target="_blank" rel="external">drawInContext:</a> 方法，并使用它来绘制图像内容</li>
</ul>
<h3 id="调整提供的内容"><a href="#调整提供的内容" class="headerlink" title="调整提供的内容"></a>调整提供的内容</h3><center><br><img src="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7iy72b827j20sz0i8wg6.jpg" alt="Position-based gravity constants for layers"><br></center>

<p>layer 的 contentsGravity 属性模式的设置是 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/c/data/kCAGravityResize" target="_blank" rel="external">kCAGravityResize</a> 常量。</p>
<center><br><img src="http://ww1.sinaimg.cn/large/a9c4d5f6gw1f7iybek8e7j20pe0djdkc.jpg" alt="Scaling-based gravity constants for layers"><br></center>

<h3 id="高分辨率图像"><a href="#高分辨率图像" class="headerlink" title="高分辨率图像"></a>高分辨率图像</h3><h2 id="调整图层的视觉风格和外观"><a href="#调整图层的视觉风格和外观" class="headerlink" title="调整图层的视觉风格和外观"></a>调整图层的视觉风格和外观</h2><h3 id="layer-有自己的背景和边界"><a href="#layer-有自己的背景和边界" class="headerlink" title="layer 有自己的背景和边界"></a>layer 有自己的背景和边界</h3><center><br><img src="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7iyns91knj20j30ff0uh.jpg" alt="Adding a border and background to a layer"><br></center>

<h3 id="layer-支持半径圆角"><a href="#layer-支持半径圆角" class="headerlink" title="layer 支持半径圆角"></a>layer 支持半径圆角</h3><center><br><img src="http://ww2.sinaimg.cn/mw690/a9c4d5f6gw1f7jmka87j0j20re0inmxu.jpg" alt=""><br></center>

<h3 id="layer-支持内建阴影"><a href="#layer-支持内建阴影" class="headerlink" title="layer 支持内建阴影"></a>layer 支持内建阴影</h3><center><br><img src="http://ww2.sinaimg.cn/mw690/a9c4d5f6gw1f7jn4qu1oxj20lx0bptay.jpg" alt=""><br></center>

<h3 id="OS-X-的view-添加过滤效果"><a href="#OS-X-的view-添加过滤效果" class="headerlink" title="OS X 的view 添加过滤效果"></a>OS X 的view 添加过滤效果</h3><p>iOS 不能给 layer 对象添加过滤器</p>
<h2 id="对于-OS-X-性能影响的-layer-重回策略"><a href="#对于-OS-X-性能影响的-layer-重回策略" class="headerlink" title="对于 OS X 性能影响的 layer 重回策略"></a>对于 OS X 性能影响的 layer 重回策略</h2><h2 id="给-layer-添加自定义属性"><a href="#给-layer-添加自定义属性" class="headerlink" title="给 layer 添加自定义属性"></a>给 layer 添加自定义属性</h2><h1 id="Animating-Layer-Content"><a href="#Animating-Layer-Content" class="headerlink" title="Animating Layer Content"></a>Animating Layer Content</h1><h2 id="修改-layer-属性，达到简单动画效果"><a href="#修改-layer-属性，达到简单动画效果" class="headerlink" title="修改 layer 属性，达到简单动画效果"></a>修改 layer 属性，达到简单动画效果</h2><p>精确的动画，需要创建一个 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CABasicAnimation_class/index.html#//apple_ref/occ/cl/CABasicAnimation" target="_blank" rel="external">CABasicAnimation</a> 对象，使用这个对象来配置参数。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CABasicAnimation</span>* fadeAnim = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"opacity"</span>];</span><br><span class="line">fadeAnim.fromValue = [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">1.0</span>];</span><br><span class="line">fadeAnim.toValue = [<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">0.0</span>];</span><br><span class="line">fadeAnim.duration = <span class="number">1.0</span>;</span><br><span class="line">[theLayer addAnimation:fadeAnim forKey:<span class="string">@"opacity"</span>];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Change the actual data value in the layer to the final value.</span></span><br><span class="line">theLayer.opacity = <span class="number">0.0</span>;</span><br></pre></td></tr></table></figure>
<h2 id="使用关键帧动画来改变-layer-的属性"><a href="#使用关键帧动画来改变-layer-的属性" class="headerlink" title="使用关键帧动画来改变 layer 的属性"></a>使用关键帧动画来改变 layer 的属性</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// create a CGPath that implements two arcs (a bounce)</span></span><br><span class="line"><span class="built_in">CGMutablePathRef</span> thePath = <span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line"><span class="built_in">CGPathMoveToPoint</span>(thePath,<span class="literal">NULL</span>,<span class="number">74.0</span>,<span class="number">74.0</span>);</span><br><span class="line"><span class="built_in">CGPathAddCurveToPoint</span>(thePath,<span class="literal">NULL</span>,<span class="number">74.0</span>,<span class="number">500.0</span>,</span><br><span class="line">                                   <span class="number">320.0</span>,<span class="number">500.0</span>,</span><br><span class="line">                                   <span class="number">320.0</span>,<span class="number">74.0</span>);</span><br><span class="line"><span class="built_in">CGPathAddCurveToPoint</span>(thePath,<span class="literal">NULL</span>,<span class="number">320.0</span>,<span class="number">500.0</span>,</span><br><span class="line">                                   <span class="number">566.0</span>,<span class="number">500.0</span>,</span><br><span class="line">                                   <span class="number">566.0</span>,<span class="number">74.0</span>);</span><br><span class="line"> </span><br><span class="line"><span class="built_in">CAKeyframeAnimation</span> * theAnimation;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Create the animation object, specifying the position property as the key path.</span></span><br><span class="line">theAnimation=[<span class="built_in">CAKeyframeAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">theAnimation.path=thePath;</span><br><span class="line">theAnimation.duration=<span class="number">5.0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Add the animation to the layer.</span></span><br><span class="line">[theLayer addAnimation:theAnimation forKey:<span class="string">@"position"</span>];</span><br></pre></td></tr></table></figure>
<h3 id="指定-keyframe-的值"><a href="#指定-keyframe-的值" class="headerlink" title="指定 keyframe 的值"></a>指定 keyframe 的值</h3><h2 id="在动画运行的时候，停止动画"><a href="#在动画运行的时候，停止动画" class="headerlink" title="在动画运行的时候，停止动画"></a>在动画运行的时候，停止动画</h2><p><code>removeAnimationForKey:</code> <code>removeAllAnimations</code> </p>
<p>只能移除显示动画，不能移除隐式动画。</p>
<h2 id="多个动画一起变化"><a href="#多个动画一起变化" class="headerlink" title="多个动画一起变化"></a>多个动画一起变化</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Animation 1</span></span><br><span class="line"><span class="built_in">CAKeyframeAnimation</span>* widthAnim = [<span class="built_in">CAKeyframeAnimation</span> animationWithKeyPath:<span class="string">@"borderWidth"</span>];</span><br><span class="line"><span class="built_in">NSArray</span>* widthValues = [<span class="built_in">NSArray</span> arrayWithObjects:@<span class="number">1.0</span>, @<span class="number">10.0</span>, @<span class="number">5.0</span>, @<span class="number">30.0</span>, @<span class="number">0.5</span>, @<span class="number">15.0</span>, @<span class="number">2.0</span>, @<span class="number">50.0</span>, @<span class="number">0.0</span>, <span class="literal">nil</span>];</span><br><span class="line">widthAnim.values = widthValues;</span><br><span class="line">widthAnim.calculationMode = k<span class="built_in">CAAnimationPaced</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Animation 2</span></span><br><span class="line"><span class="built_in">CAKeyframeAnimation</span>* colorAnim = [<span class="built_in">CAKeyframeAnimation</span> animationWithKeyPath:<span class="string">@"borderColor"</span>];</span><br><span class="line"><span class="built_in">NSArray</span>* colorValues = [<span class="built_in">NSArray</span> arrayWithObjects:(<span class="keyword">id</span>)[<span class="built_in">UIColor</span> greenColor].CGColor,</span><br><span class="line">            (<span class="keyword">id</span>)[<span class="built_in">UIColor</span> redColor].CGColor, (<span class="keyword">id</span>)[<span class="built_in">UIColor</span> blueColor].CGColor,  <span class="literal">nil</span>];</span><br><span class="line">colorAnim.values = colorValues;</span><br><span class="line">colorAnim.calculationMode = k<span class="built_in">CAAnimationPaced</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Animation group</span></span><br><span class="line"><span class="built_in">CAAnimationGroup</span>* group = [<span class="built_in">CAAnimationGroup</span> animation];</span><br><span class="line">group.animations = [<span class="built_in">NSArray</span> arrayWithObjects:colorAnim, widthAnim, <span class="literal">nil</span>];</span><br><span class="line">group.duration = <span class="number">5.0</span>;</span><br><span class="line"> </span><br><span class="line">[myLayer addAnimation:group forKey:<span class="string">@"BorderChanges"</span>];</span><br></pre></td></tr></table></figure>
<h2 id="检测动画的结束"><a href="#检测动画的结束" class="headerlink" title="检测动画的结束"></a>检测动画的结束</h2><p>There are two different ways to be notified about the state of an animation:</p>
<ul>
<li>Add a completion block to the current transaction using the <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CATransaction_class/index.html#//apple_ref/occ/clm/CATransaction/setCompletionBlock:" target="_blank" rel="external">setCompletionBlock:</a> method. When all of the animations in the transaction finish, the transaction executes your completion block.</li>
<li>Assign a delegate to your CAAnimation object and implement the <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CAAnimation_class/index.html#//apple_ref/occ/instm/NSObject/animationDidStart:" target="_blank" rel="external">animationDidStart:</a> and <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CAAnimation_class/index.html#//apple_ref/occ/instm/NSObject/animationDidStop:finished:" target="_blank" rel="external">animationDidStop:finished:</a> delegate methods.</li>
</ul>
<h2 id="基于-layer-的view-怎么做动画"><a href="#基于-layer-的view-怎么做动画" class="headerlink" title="基于 layer 的view 怎么做动画"></a>基于 layer 的view 怎么做动画</h2><h3 id="iOS-中修改-layer-的规则"><a href="#iOS-中修改-layer-的规则" class="headerlink" title="iOS 中修改 layer 的规则"></a>iOS 中修改 layer 的规则</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">UIView</span> animateWithDuration:<span class="number">1.0</span> animations:^&#123;</span><br><span class="line">   <span class="comment">// Change the opacity implicitly.</span></span><br><span class="line">   myView.layer.opacity = <span class="number">0.0</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="comment">// Change the position explicitly.</span></span><br><span class="line">   <span class="built_in">CABasicAnimation</span>* theAnim = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:<span class="string">@"position"</span>];</span><br><span class="line">   theAnim.fromValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:myView.layer.position];</span><br><span class="line">   theAnim.toValue = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:myNewPosition];</span><br><span class="line">   theAnim.duration = <span class="number">3.0</span>;</span><br><span class="line">   [myView.layer addAnimation:theAnim forKey:<span class="string">@"AnimateFrame"</span>];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<h1 id="建立-layer-层级"><a href="#建立-layer-层级" class="headerlink" title="建立 layer 层级"></a>建立 layer 层级</h1><h2 id="将-layer-放入-layer层级中"><a href="#将-layer-放入-layer层级中" class="headerlink" title="将 layer 放入 layer层级中"></a>将 layer 放入 layer层级中</h2><h3 id="添加、插入、移除-sublayer"><a href="#添加、插入、移除-sublayer" class="headerlink" title="添加、插入、移除 sublayer"></a>添加、插入、移除 sublayer</h3><center><br><img src="http://ww1.sinaimg.cn/large/a9c4d5f6gw1f7jtndq23oj221u0po468.jpg" alt=""><br></center>

<h3 id="sublayer-的位置和大小"><a href="#sublayer-的位置和大小" class="headerlink" title="sublayer 的位置和大小"></a>sublayer 的位置和大小</h3><p><a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instp/CALayer/bounds" target="_blank" rel="external">bounds</a> 、<a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instp/CALayer/position" target="_blank" rel="external">position</a></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">myLayer.bounds = <span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">myLayer.position = <span class="built_in">CGPointMake</span>(<span class="number">200</span>, <span class="number">200</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>重点：对于 layer 的宽高总是使用整数</p>
</blockquote>
<h3 id="layer-层级如何影响动画"><a href="#layer-层级如何影响动画" class="headerlink" title="layer 层级如何影响动画"></a>layer 层级如何影响动画</h3><p><a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CAMediaTiming_protocol/index.html#//apple_ref/occ/intfp/CAMediaTiming/speed" target="_blank" rel="external">speed</a> 属性，动画速度的倍数。</p>
<h2 id="调整layer层级的布局"><a href="#调整layer层级的布局" class="headerlink" title="调整layer层级的布局"></a>调整layer层级的布局</h2><p>Core Animation supports several options for adjusting the size and position of sublayers in response to changes to their superlayer. In iOS, the pervasive use of layer-backed views makes the creation of layer hierarchies less important; only manual layout updates are supported. For OS X, several other options are available that make it easier to manage your layer hierarchies</p>
<h2 id="sublayer-和-cliping"><a href="#sublayer-和-cliping" class="headerlink" title="sublayer 和 cliping"></a>sublayer 和 cliping</h2><p><a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instp/CALayer/masksToBounds" target="_blank" rel="external">masksToBounds</a> 属性设置 YES，就可以启用自动裁剪</p>
<center><br><img src="http://ww1.sinaimg.cn/mw690/a9c4d5f6gw1f7ju4oniryj20p60kf409.jpg" alt=""><br></center>

<h2 id="在layer-之间转换坐标值"><a href="#在layer-之间转换坐标值" class="headerlink" title="在layer 之间转换坐标值"></a>在layer 之间转换坐标值</h2><ul>
<li><a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instm/CALayer/convertPoint:fromLayer:" target="_blank" rel="external">convertPoint:fromLayer:</a></li>
<li><a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instm/CALayer/convertPoint:toLayer:" target="_blank" rel="external">convertPoint:toLayer:</a></li>
<li><a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instm/CALayer/convertRect:fromLayer:" target="_blank" rel="external">convertRect:fromLayer:</a></li>
<li><a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instm/CALayer/convertRect:toLayer:" target="_blank" rel="external">convertRect:toLayer:</a></li>
</ul>
<p>还有 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instm/CALayer/convertTime:fromLayer:" target="_blank" rel="external">convertTime:fromLayer</a> 和 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instm/CALayer/convertTime:toLayer:" target="_blank" rel="external">convertTime:toLayer</a></p>
<h1 id="高级动画技巧"><a href="#高级动画技巧" class="headerlink" title="高级动画技巧"></a>高级动画技巧</h1><h2 id="过渡动画支持更改-layer-可见性"><a href="#过渡动画支持更改-layer-可见性" class="headerlink" title="过渡动画支持更改 layer 可见性"></a>过渡动画支持更改 layer 可见性</h2><p>创建 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CATransition_class/index.html#//apple_ref/occ/cl/CATransition" target="_blank" rel="external">CATransition</a> 对象 ，并添加给 layer。</p>
<p>Listing 5-1 shows the code used to create an animated push transition between two views. In the example, both myView1 and myView2 are located at the same position in the same parent view but only myView1 is currently visible. The push transition causes myView1 to slide out to the left and fade until it is hidden while myView2 slides in from the right and becomes visible. Updating the hidden property of both views ensures that the visibility of both views is correct at the end of the animation.</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CATransition</span>* transition = [<span class="built_in">CATransition</span> animation];</span><br><span class="line">transition.startProgress = <span class="number">0</span>;</span><br><span class="line">transition.endProgress = <span class="number">1.0</span>;</span><br><span class="line">transition.type = k<span class="built_in">CATransitionPush</span>;</span><br><span class="line">transition.subtype = k<span class="built_in">CATransitionFromRight</span>;</span><br><span class="line">transition.duration = <span class="number">1.0</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Add the transition animation to both layers</span></span><br><span class="line">[myView1.layer addAnimation:transition forKey:<span class="string">@"transition"</span>];</span><br><span class="line">[myView2.layer addAnimation:transition forKey:<span class="string">@"transition"</span>];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Finally, change the visibility of the layers.</span></span><br><span class="line">myView1.hidden = <span class="literal">YES</span>;</span><br><span class="line">myView2.hidden = <span class="literal">NO</span>;</span><br></pre></td></tr></table></figure>
<h2 id="自定义动画的时间"><a href="#自定义动画的时间" class="headerlink" title="自定义动画的时间"></a>自定义动画的时间</h2><p><a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CAMediaTiming_protocol/index.html#//apple_ref/occ/intf/CAMediaTiming" target="_blank" rel="external">CAMediaTiming</a> 协议。<code>CAAnimation</code> 和 <code>CALayer</code> 都遵守了这个协议。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;QuartzCore/CABase.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/objc.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/NSObject.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The CAMediaTiming protocol is implemented by layers and animations, it</span><br><span class="line"> * models a hierarchical timing system, with each object describing the</span><br><span class="line"> * mapping from time values in the object's parent to local time.</span><br><span class="line"> *</span><br><span class="line"> * Absolute time is defined as mach time converted to seconds. The</span><br><span class="line"> * CACurrentMediaTime function is provided as a convenience for querying the</span><br><span class="line"> * current absolute time.</span><br><span class="line"> *</span><br><span class="line"> * The conversion from parent time to local time has two stages:</span><br><span class="line"> *</span><br><span class="line"> * 1. conversion to "active local time". This includes the point at</span><br><span class="line"> * which the object appears in the parent's timeline, and how fast it</span><br><span class="line"> * plays relative to the parent.</span><br><span class="line"> *</span><br><span class="line"> * 2. conversion from active to "basic local time". The timing model</span><br><span class="line"> * allows for objects to repeat their basic duration multiple times,</span><br><span class="line"> * and optionally to play backwards before repeating. */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">NSString</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">CAMediaTiming</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* The begin time of the object, in relation to its parent object, if</span><br><span class="line"> * applicable. Defaults to 0. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">CFTimeInterval</span> beginTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The basic duration of the object. Defaults to 0. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">CFTimeInterval</span> duration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The rate of the layer. Used to scale parent time to local time, e.g.</span><br><span class="line"> * if rate is 2, local time progresses twice as fast as parent time.</span><br><span class="line"> * Defaults to 1. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> speed;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Additional offset in active local time. i.e. to convert from parent</span><br><span class="line"> * time tp to active local time t: t = (tp - begin) * speed + offset.</span><br><span class="line"> * One use of this is to "pause" a layer by setting `speed' to zero and</span><br><span class="line"> * `offset' to a suitable value. Defaults to 0. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">CFTimeInterval</span> timeOffset;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The repeat count of the object. May be fractional. Defaults to 0. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="keyword">float</span> repeatCount;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* The repeat duration of the object. Defaults to 0. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">CFTimeInterval</span> repeatDuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* When true, the object plays backwards after playing forwards. Defaults</span><br><span class="line"> * to NO. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> <span class="built_in">BOOL</span> autoreverses;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Defines how the timed object behaves outside its active duration.</span><br><span class="line"> * Local time may be clamped to either end of the active duration, or</span><br><span class="line"> * the element may be removed from the presentation. The legal values</span><br><span class="line"> * are `backwards', `forwards', `both' and `removed'. Defaults to</span><br><span class="line"> * `removed'. */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">copy</span>) <span class="built_in">NSString</span> *fillMode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* `fillMode' options. */</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">CA_EXTERN</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> k<span class="built_in">CAFillModeForwards</span></span><br><span class="line">    __OSX_<span class="built_in">AVAILABLE_STARTING</span> (__MAC_10_5, __IPHONE_2_0);</span><br><span class="line"><span class="built_in">CA_EXTERN</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> k<span class="built_in">CAFillModeBackwards</span></span><br><span class="line">    __OSX_<span class="built_in">AVAILABLE_STARTING</span> (__MAC_10_5, __IPHONE_2_0);</span><br><span class="line"><span class="built_in">CA_EXTERN</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> k<span class="built_in">CAFillModeBoth</span></span><br><span class="line">    __OSX_<span class="built_in">AVAILABLE_STARTING</span> (__MAC_10_5, __IPHONE_2_0);</span><br><span class="line"><span class="built_in">CA_EXTERN</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> k<span class="built_in">CAFillModeRemoved</span></span><br><span class="line">    __OSX_<span class="built_in">AVAILABLE_STARTING</span> (__MAC_10_5, __IPHONE_2_0);</span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br></pre></td></tr></table></figure>
<p>得到 layer 的当前 local time</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CFTimeInterval</span> localLayerTime = [myLayer convertTime:<span class="built_in">CACurrentMediaTime</span>() fromLayer:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<h2 id="暂停和重新开始动画"><a href="#暂停和重新开始动画" class="headerlink" title="暂停和重新开始动画"></a>暂停和重新开始动画</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)pauseLayer:(<span class="built_in">CALayer</span>*)layer &#123;</span><br><span class="line">   <span class="built_in">CFTimeInterval</span> pausedTime = [layer convertTime:<span class="built_in">CACurrentMediaTime</span>() fromLayer:<span class="literal">nil</span>];</span><br><span class="line">   layer.speed = <span class="number">0.0</span>;</span><br><span class="line">   layer.timeOffset = pausedTime;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">-(<span class="keyword">void</span>)resumeLayer:(<span class="built_in">CALayer</span>*)layer &#123;</span><br><span class="line">   <span class="built_in">CFTimeInterval</span> pausedTime = [layer timeOffset];</span><br><span class="line">   layer.speed = <span class="number">1.0</span>;</span><br><span class="line">   layer.timeOffset = <span class="number">0.0</span>;</span><br><span class="line">   layer.beginTime = <span class="number">0.0</span>;</span><br><span class="line">   <span class="built_in">CFTimeInterval</span> timeSincePause = [layer convertTime:<span class="built_in">CACurrentMediaTime</span>() fromLayer:<span class="literal">nil</span>] - pausedTime;</span><br><span class="line">   layer.beginTime = timeSincePause;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="显式-Transactions-可以更改动画参数"><a href="#显式-Transactions-可以更改动画参数" class="headerlink" title="显式 Transactions 可以更改动画参数"></a>显式 Transactions 可以更改动画参数</h2><p><a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CATransaction_class/index.html#//apple_ref/occ/cl/CATransaction" target="_blank" rel="external">CATransaction</a> 类</p>
<p>创建显式的 transaction</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">CATransaction</span> begin];</span><br><span class="line">theLayer.zPosition=<span class="number">200.0</span>;</span><br><span class="line">theLayer.opacity=<span class="number">0.0</span>;</span><br><span class="line">[<span class="built_in">CATransaction</span> commit];</span><br></pre></td></tr></table></figure>
<p>修改动画的默认持续时间</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">CATransaction</span> begin];</span><br><span class="line">[<span class="built_in">CATransaction</span> setValue:[<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">10.0</span>f]</span><br><span class="line">                 forKey:k<span class="built_in">CATransactionAnimationDuration</span>];</span><br><span class="line"><span class="comment">// Perform the animations</span></span><br><span class="line">[<span class="built_in">CATransaction</span> commit];</span><br></pre></td></tr></table></figure>
<p>嵌套显式 transaction</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">CATransaction</span> begin]; <span class="comment">// Outer transaction</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// Change the animation duration to two seconds</span></span><br><span class="line">[<span class="built_in">CATransaction</span> setValue:[<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">2.0</span>f]</span><br><span class="line">                forKey:k<span class="built_in">CATransactionAnimationDuration</span>];</span><br><span class="line"><span class="comment">// Move the layer to a new position</span></span><br><span class="line">theLayer.position = <span class="built_in">CGPointMake</span>(<span class="number">0.0</span>,<span class="number">0.0</span>);</span><br><span class="line"> </span><br><span class="line">[<span class="built_in">CATransaction</span> begin]; <span class="comment">// Inner transaction</span></span><br><span class="line"><span class="comment">// Change the animation duration to five seconds</span></span><br><span class="line">[<span class="built_in">CATransaction</span> setValue:[<span class="built_in">NSNumber</span> numberWithFloat:<span class="number">5.0</span>f]</span><br><span class="line">                 forKey:k<span class="built_in">CATransactionAnimationDuration</span>];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Change the zPosition and opacity</span></span><br><span class="line">theLayer.zPosition=<span class="number">200.0</span>;</span><br><span class="line">theLayer.opacity=<span class="number">0.0</span>;</span><br><span class="line"> </span><br><span class="line">[<span class="built_in">CATransaction</span> commit]; <span class="comment">// Inner transaction</span></span><br><span class="line"> </span><br><span class="line">[<span class="built_in">CATransaction</span> commit]; <span class="comment">// Outer transaction</span></span><br></pre></td></tr></table></figure>
<h2 id="给动画添加透视"><a href="#给动画添加透视" class="headerlink" title="给动画添加透视"></a>给动画添加透视</h2><p>给 parent layer 添加透视变化</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CATransform3D</span> perspective = <span class="built_in">CATransform3DIdentity</span>;</span><br><span class="line">perspective.m34 = <span class="number">-1.0</span>/eyePosition;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Apply the transform to a parent layer.</span></span><br><span class="line">myParentLayer.sublayerTransform = perspective;</span><br></pre></td></tr></table></figure>
<h1 id="改变-layer-的默认行为"><a href="#改变-layer-的默认行为" class="headerlink" title="改变 layer 的默认行为"></a>改变 layer 的默认行为</h1><p><a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CAAction_protocol/index.html#//apple_ref/occ/intf/CAAction" target="_blank" rel="external">CAAction</a> 协议</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Action (event handler) protocol. **/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">CAAction</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Called to trigger the event named 'path' on the receiver. The object</span><br><span class="line"> * (e.g. the layer) on which the event happened is 'anObject'. The</span><br><span class="line"> * arguments dictionary may be nil, if non-nil it carries parameters</span><br><span class="line"> * associated with the event. */</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)runActionForKey:(<span class="built_in">NSString</span> *)event object:(<span class="keyword">id</span>)anObject</span><br><span class="line">    arguments:(nullable <span class="built_in">NSDictionary</span> *)dict;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h2 id="自定义操作对象采用CAAction协议"><a href="#自定义操作对象采用CAAction协议" class="headerlink" title="自定义操作对象采用CAAction协议"></a>自定义操作对象采用CAAction协议</h2><h2 id="action-对象必须被安装在-layer-上，才能有效果"><a href="#action-对象必须被安装在-layer-上，才能有效果" class="headerlink" title="action 对象必须被安装在 layer 上，才能有效果"></a>action 对象必须被安装在 layer 上，才能有效果</h2><p>核心动画寻找 action 对象的顺序：</p>
<ol>
<li>如果 layer 有一个 delegate， 并且delegate 实现了 <code>actionForLayer:forKey</code> 方法，layer调用这个方法。delegate 必须做下面几件事之一：<ul>
<li>针对 key 返回 action 对象</li>
<li>没有它没有 handle the action 就返回 nil，这种情况会接着寻找</li>
<li>搜寻到末尾的时候立即返回 <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSNull_Class/index.html#//apple_ref/occ/cl/NSNull" target="_blank" rel="external">NSNull</a> 对象</li>
</ul>
</li>
<li>在 layer 的 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instp/CALayer/actions" target="_blank" rel="external">actions</a> 字典中寻找给定的 key</li>
<li>在 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instp/CALayer/style" target="_blank" rel="external">style</a> 字典中寻找包含 key 的 actions 字典（总而言之，<code>style</code> 字典包含了一个 key 为 <code>actions</code> ，value 也是一个字典。layer 在这第二个字典中寻找给定的 key）</li>
<li>layer 调用它的 <a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/clm/CALayer/defaultActionForKey:" target="_blank" rel="external">defaultActionForKey:</a> 类方法</li>
<li>layer 执行核心动画定义的隐式 action </li>
</ol>
<p>使用 layer 代理对象提供 action</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span>&lt;<span class="built_in">CAAction</span>&gt;)actionForLayer:(<span class="built_in">CALayer</span> *)theLayer</span><br><span class="line">                        forKey:(<span class="built_in">NSString</span> *)theKey &#123;</span><br><span class="line">    <span class="built_in">CATransition</span> *theAnimation=<span class="literal">nil</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> ([theKey isEqualToString:<span class="string">@"contents"</span>]) &#123;</span><br><span class="line"> </span><br><span class="line">        theAnimation = [[<span class="built_in">CATransition</span> alloc] init];</span><br><span class="line">        theAnimation.duration = <span class="number">1.0</span>;</span><br><span class="line">        theAnimation.timingFunction = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:k<span class="built_in">CAMediaTimingFunctionEaseIn</span>];</span><br><span class="line">        theAnimation.type = k<span class="built_in">CATransitionPush</span>;</span><br><span class="line">        theAnimation.subtype = k<span class="built_in">CATransitionFromRight</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> theAnimation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用-CATransaction-类暂时禁用-action"><a href="#使用-CATransaction-类暂时禁用-action" class="headerlink" title="使用 CATransaction 类暂时禁用 action"></a>使用 CATransaction 类暂时禁用 action</h2><p>Temporarily disabling a layer’s actions</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">CATransaction</span> begin];</span><br><span class="line">[<span class="built_in">CATransaction</span> setValue:(<span class="keyword">id</span>)k<span class="built_in">CFBooleanTrue</span></span><br><span class="line">                 forKey:k<span class="built_in">CATransactionDisableActions</span>];</span><br><span class="line">[aLayer removeFromSuperlayer];</span><br><span class="line">[<span class="built_in">CATransaction</span> commit];</span><br></pre></td></tr></table></figure>
<h1 id="提升动画性能"><a href="#提升动画性能" class="headerlink" title="提升动画性能"></a>提升动画性能</h1><h2 id="为-OS-X-Views-选择最佳的重绘策略"><a href="#为-OS-X-Views-选择最佳的重绘策略" class="headerlink" title="为 OS X Views 选择最佳的重绘策略"></a>为 OS X Views 选择最佳的重绘策略</h2><h2 id="在-OS-X-中更新-layer-来优化-rendering-path"><a href="#在-OS-X-中更新-layer-来优化-rendering-path" class="headerlink" title="在 OS X 中更新 layer 来优化 rendering path"></a>在 OS X 中更新 layer 来优化 rendering path</h2><h2 id="通用技巧和窍门"><a href="#通用技巧和窍门" class="headerlink" title="通用技巧和窍门"></a>通用技巧和窍门</h2><h3 id="尽可能使用不透明的-layer"><a href="#尽可能使用不透明的-layer" class="headerlink" title="尽可能使用不透明的 layer"></a>尽可能使用不透明的 layer</h3><h3 id="对-CAShapeLayer-对象使用更简单的-path"><a href="#对-CAShapeLayer-对象使用更简单的-path" class="headerlink" title="对 CAShapeLayer 对象使用更简单的 path"></a>对 CAShapeLayer 对象使用更简单的 path</h3><h3 id="对相同-layer-明确设置-layer-内容"><a href="#对相同-layer-明确设置-layer-内容" class="headerlink" title="对相同 layer 明确设置 layer 内容"></a>对相同 layer 明确设置 layer 内容</h3><h3 id="总是将-layer-的大小设置为-整数值"><a href="#总是将-layer-的大小设置为-整数值" class="headerlink" title="总是将 layer 的大小设置为 整数值"></a>总是将 layer 的大小设置为 整数值</h3><h3 id="根据需要使用异步来渲染-layer"><a href="#根据需要使用异步来渲染-layer" class="headerlink" title="根据需要使用异步来渲染 layer"></a>根据需要使用异步来渲染 layer</h3><p><a href="https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CALayer_class/index.html#//apple_ref/occ/instp/CALayer/drawsAsynchronously" target="_blank" rel="external">drawsAsynchronously</a> 属性</p>
<h2 id="当给-layer-添加阴影的时候指定-shadow-path"><a href="#当给-layer-添加阴影的时候指定-shadow-path" class="headerlink" title="当给 layer 添加阴影的时候指定 shadow path"></a>当给 layer 添加阴影的时候指定 shadow path</h2><h1 id="Appendix-A-layer-style-property-animation"><a href="#Appendix-A-layer-style-property-animation" class="headerlink" title="Appendix A: layer style property animation"></a>Appendix A: layer style property animation</h1><p><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/LayerStyleProperties/LayerStyleProperties.html#//apple_ref/doc/uid/TP40004514-CH10-SW1" target="_blank" rel="external">Layer Style Property Animations</a></p>
<h1 id="Appendix-B-Animatable-Properties"><a href="#Appendix-B-Animatable-Properties" class="headerlink" title="Appendix B: Animatable Properties"></a>Appendix B: Animatable Properties</h1><p><a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/AnimatableProperties/AnimatableProperties.html#//apple_ref/doc/uid/TP40004514-CH11-SW1" target="_blank" rel="external">Animatable Properties</a></p>
<blockquote>
<p>新博客文章地址：<a href="http://yoferzhang.com/post/20160905CoreAnimationProgrammingGuide/">Core Animation Programming Guide 核心动画编程指南</a><br>CSDN文章地址：<a href="">Core Animation Programming Guide 核心动画编程指南</a></p>
</blockquote>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/post/20160905CoreAnimationProgrammingGuide/">【iOS】Core Animation Programming Guide 核心动画编程指南</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">Yofer Zhang</a></p>
        <p><span>发布时间:</span>2016-09-05, 10:18:23</p>
        <p><span>最后更新:</span>2017-02-09, 13:23:42</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/post/20160905CoreAnimationProgrammingGuide/" title="【iOS】Core Animation Programming Guide 核心动画编程指南">http://yoferzhang.com/post/20160905CoreAnimationProgrammingGuide/</a>
            <span class="copy-path" data-clipboard-text="原文: http://yoferzhang.com/post/20160905CoreAnimationProgrammingGuide/　　作者: Yofer Zhang" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
            <div id="article-nav-newer" class="article-nav-title">
                <a href="/post/20160909ErrorLibpngErrorUnhandledCritical/">
                    【iOS】cocos2dx在xcode8 GM版下的错误`libpng error:CgBI:unhandled critical chunk`
                </a>
            </div>
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/post/20160902ViewProgrammingGuide/">
                    【iOS】View Programming Guide for iOS 视图编程指南
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-有关核心动画"><span class="toc-number">1.</span> <span class="toc-text">1 有关核心动画</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-概览"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 概览</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-1-Core-Animation-管理应用的内容"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1.1 Core Animation 管理应用的内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-2-更改-layer-触发动画"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.1.2 更改 layer 触发动画</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-3-layer可以组织成层级结构"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.1.3 layer可以组织成层级结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-4-action-让你更改图层的默认行为"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.1.4 action 让你更改图层的默认行为</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-如果使用这个文档"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 如果使用这个文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-预备工作"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 预备工作</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#核心动画基础"><span class="toc-number">2.</span> <span class="toc-text">核心动画基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#layer-提供绘图和动画的基础"><span class="toc-number">2.1.</span> <span class="toc-text">layer 提供绘图和动画的基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基于-layer-的绘图模型"><span class="toc-number">2.1.1.</span> <span class="toc-text">基于 layer 的绘图模型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于-layer-的动画"><span class="toc-number">2.1.2.</span> <span class="toc-text">基于 layer 的动画</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#layer-对象定义自己的几何"><span class="toc-number">2.2.</span> <span class="toc-text">layer 对象定义自己的几何</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#layer-使用两种类型的坐标系"><span class="toc-number">2.2.1.</span> <span class="toc-text">layer 使用两种类型的坐标系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#锚点影响几何操作"><span class="toc-number">2.2.2.</span> <span class="toc-text">锚点影响几何操作</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#layer-可以在三维空间中操作"><span class="toc-number">2.2.3.</span> <span class="toc-text">layer 可以在三维空间中操作</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#layer-树反映了动画状态的不同方面"><span class="toc-number">2.3.</span> <span class="toc-text">layer 树反映了动画状态的不同方面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#layer-和-view-之间的关系"><span class="toc-number">2.4.</span> <span class="toc-text">layer 和 view 之间的关系</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#设置-layer-对象"><span class="toc-number">3.</span> <span class="toc-text">设置 layer 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#激活核心动画支持"><span class="toc-number">3.1.</span> <span class="toc-text">激活核心动画支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更改与视图相关的-layer-对象"><span class="toc-number">3.2.</span> <span class="toc-text">更改与视图相关的 layer 对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#改变-UIView-使用的-layer-class"><span class="toc-number">3.2.1.</span> <span class="toc-text">改变 UIView 使用的 layer class</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Changing-the-Layer-Class-Used-By-NSView"><span class="toc-number">3.2.2.</span> <span class="toc-text">Changing the Layer Class Used By NSView</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#不同的-layer-类提供专属行为"><span class="toc-number">3.2.3.</span> <span class="toc-text">不同的 layer 类提供专属行为</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#给-layer-提供内容"><span class="toc-number">3.3.</span> <span class="toc-text">给 layer 提供内容</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#给-layer-内容设置图像"><span class="toc-number">3.3.1.</span> <span class="toc-text">给 layer 内容设置图像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用代理给layer提供内容"><span class="toc-number">3.3.2.</span> <span class="toc-text">使用代理给layer提供内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#通过子类给-layer-提供内容"><span class="toc-number">3.3.3.</span> <span class="toc-text">通过子类给 layer 提供内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#调整提供的内容"><span class="toc-number">3.3.4.</span> <span class="toc-text">调整提供的内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#高分辨率图像"><span class="toc-number">3.3.5.</span> <span class="toc-text">高分辨率图像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#调整图层的视觉风格和外观"><span class="toc-number">3.4.</span> <span class="toc-text">调整图层的视觉风格和外观</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#layer-有自己的背景和边界"><span class="toc-number">3.4.1.</span> <span class="toc-text">layer 有自己的背景和边界</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#layer-支持半径圆角"><span class="toc-number">3.4.2.</span> <span class="toc-text">layer 支持半径圆角</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#layer-支持内建阴影"><span class="toc-number">3.4.3.</span> <span class="toc-text">layer 支持内建阴影</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OS-X-的view-添加过滤效果"><span class="toc-number">3.4.4.</span> <span class="toc-text">OS X 的view 添加过滤效果</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#对于-OS-X-性能影响的-layer-重回策略"><span class="toc-number">3.5.</span> <span class="toc-text">对于 OS X 性能影响的 layer 重回策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#给-layer-添加自定义属性"><span class="toc-number">3.6.</span> <span class="toc-text">给 layer 添加自定义属性</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Animating-Layer-Content"><span class="toc-number">4.</span> <span class="toc-text">Animating Layer Content</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#修改-layer-属性，达到简单动画效果"><span class="toc-number">4.1.</span> <span class="toc-text">修改 layer 属性，达到简单动画效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用关键帧动画来改变-layer-的属性"><span class="toc-number">4.2.</span> <span class="toc-text">使用关键帧动画来改变 layer 的属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#指定-keyframe-的值"><span class="toc-number">4.2.1.</span> <span class="toc-text">指定 keyframe 的值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在动画运行的时候，停止动画"><span class="toc-number">4.3.</span> <span class="toc-text">在动画运行的时候，停止动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#多个动画一起变化"><span class="toc-number">4.4.</span> <span class="toc-text">多个动画一起变化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#检测动画的结束"><span class="toc-number">4.5.</span> <span class="toc-text">检测动画的结束</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基于-layer-的view-怎么做动画"><span class="toc-number">4.6.</span> <span class="toc-text">基于 layer 的view 怎么做动画</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#iOS-中修改-layer-的规则"><span class="toc-number">4.6.1.</span> <span class="toc-text">iOS 中修改 layer 的规则</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#建立-layer-层级"><span class="toc-number">5.</span> <span class="toc-text">建立 layer 层级</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#将-layer-放入-layer层级中"><span class="toc-number">5.1.</span> <span class="toc-text">将 layer 放入 layer层级中</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#添加、插入、移除-sublayer"><span class="toc-number">5.1.1.</span> <span class="toc-text">添加、插入、移除 sublayer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sublayer-的位置和大小"><span class="toc-number">5.1.2.</span> <span class="toc-text">sublayer 的位置和大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#layer-层级如何影响动画"><span class="toc-number">5.1.3.</span> <span class="toc-text">layer 层级如何影响动画</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#调整layer层级的布局"><span class="toc-number">5.2.</span> <span class="toc-text">调整layer层级的布局</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sublayer-和-cliping"><span class="toc-number">5.3.</span> <span class="toc-text">sublayer 和 cliping</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在layer-之间转换坐标值"><span class="toc-number">5.4.</span> <span class="toc-text">在layer 之间转换坐标值</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#高级动画技巧"><span class="toc-number">6.</span> <span class="toc-text">高级动画技巧</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#过渡动画支持更改-layer-可见性"><span class="toc-number">6.1.</span> <span class="toc-text">过渡动画支持更改 layer 可见性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义动画的时间"><span class="toc-number">6.2.</span> <span class="toc-text">自定义动画的时间</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#暂停和重新开始动画"><span class="toc-number">6.3.</span> <span class="toc-text">暂停和重新开始动画</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#显式-Transactions-可以更改动画参数"><span class="toc-number">6.4.</span> <span class="toc-text">显式 Transactions 可以更改动画参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#给动画添加透视"><span class="toc-number">6.5.</span> <span class="toc-text">给动画添加透视</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#改变-layer-的默认行为"><span class="toc-number">7.</span> <span class="toc-text">改变 layer 的默认行为</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义操作对象采用CAAction协议"><span class="toc-number">7.1.</span> <span class="toc-text">自定义操作对象采用CAAction协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#action-对象必须被安装在-layer-上，才能有效果"><span class="toc-number">7.2.</span> <span class="toc-text">action 对象必须被安装在 layer 上，才能有效果</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#使用-CATransaction-类暂时禁用-action"><span class="toc-number">7.3.</span> <span class="toc-text">使用 CATransaction 类暂时禁用 action</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#提升动画性能"><span class="toc-number">8.</span> <span class="toc-text">提升动画性能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#为-OS-X-Views-选择最佳的重绘策略"><span class="toc-number">8.1.</span> <span class="toc-text">为 OS X Views 选择最佳的重绘策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#在-OS-X-中更新-layer-来优化-rendering-path"><span class="toc-number">8.2.</span> <span class="toc-text">在 OS X 中更新 layer 来优化 rendering path</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#通用技巧和窍门"><span class="toc-number">8.3.</span> <span class="toc-text">通用技巧和窍门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#尽可能使用不透明的-layer"><span class="toc-number">8.3.1.</span> <span class="toc-text">尽可能使用不透明的 layer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对-CAShapeLayer-对象使用更简单的-path"><span class="toc-number">8.3.2.</span> <span class="toc-text">对 CAShapeLayer 对象使用更简单的 path</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对相同-layer-明确设置-layer-内容"><span class="toc-number">8.3.3.</span> <span class="toc-text">对相同 layer 明确设置 layer 内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总是将-layer-的大小设置为-整数值"><span class="toc-number">8.3.4.</span> <span class="toc-text">总是将 layer 的大小设置为 整数值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#根据需要使用异步来渲染-layer"><span class="toc-number">8.3.5.</span> <span class="toc-text">根据需要使用异步来渲染 layer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#当给-layer-添加阴影的时候指定-shadow-path"><span class="toc-number">8.4.</span> <span class="toc-text">当给 layer 添加阴影的时候指定 shadow path</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Appendix-A-layer-style-property-animation"><span class="toc-number">9.</span> <span class="toc-text">Appendix A: layer style property animation</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Appendix-B-Animatable-Properties"><span class="toc-number">10.</span> <span class="toc-text">Appendix B: Animatable Properties</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"【iOS】Core Animation Programming Guide 核心动画编程指南　| YoferZhang 的博客　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
      <div class="duoshuo" id="comments">
    <div id="comment-box" ></div>
    <div class="ds-thread" id="ds-thread" data-thread-key="post/20160905CoreAnimationProgrammingGuide/" data-title="【iOS】Core Animation Programming Guide 核心动画编程指南" data-url="http://yoferzhang.com/post/20160905CoreAnimationProgrammingGuide/"></div>
    <script>
        var duoshuoQuery = {short_name:"http://yoferzhang.duoshuo.com"};
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            s.async = true; s.charset = 'UTF-8';
            (d.head || d.body).appendChild(s);
        }

        
    </script>
    
    <script> loadComment(); </script>

</div>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/post/20160909ErrorLibpngErrorUnhandledCritical/" title="上一篇: 【iOS】cocos2dx在xcode8 GM版下的错误`libpng error:CgBI:unhandled critical chunk`">
                <i class="fa fa-angle-left"></i>
            </a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/post/20160902ViewProgrammingGuide/" title="下一篇: 【iOS】View Programming Guide for iOS 视图编程指南">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/post/20170327ML04GradientDescent/">机器学习入门系列04，Gradient Descent（梯度下降法）</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20170327ML03BiasAndVariance/">机器学习入门系列03，Error的来源：偏差和方差（bias 和 variance）</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20170326ML02Regression/">机器学习入门系列02，Regression 回归：案例研究</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20170326ML01Introduction/">机器学习入门系列01，Introduction 简介</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20170306DeepLearningRegression/">【测试】只是为了测试数学公式</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20170216FitnessDiary/">【健身】健身记录；健身课表；健身心得</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20170116ViewControllerProgrammingGuide/">为什么要在viewDidLoad 中加载view，在viewWillAppear:中对view进行layout？</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20161130DataManager/">【iOS】iOS数据存储,应用沙盒,XML,Preference,NSKeyedArchiver归档,SQLite3</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20161109TableViewPG/">Table View Programming Guide for iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20161024LLDBQuickStartGuide/">【iOS】LLDB调试指南</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160926Cocos2dxViewAnimation/">【iOS】Cocos2dx封装为view方便做3D动画效果</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160918ReplayKit/">【iOS】ReplayKit库，iOS原生直播神器</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160909ErrorLibpngErrorUnhandledCritical/">【iOS】cocos2dx在xcode8 GM版下的错误`libpng error:CgBI:unhandled critical chunk`</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160905CoreAnimationProgrammingGuide/">【iOS】Core Animation Programming Guide 核心动画编程指南</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160902ViewProgrammingGuide/">【iOS】View Programming Guide for iOS 视图编程指南</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160831KVO/">【iOS】KVO编程指南,Key-Value Observing Programming Guide翻译</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160830ConcurrencyProgrammingGuide/">【iOS】iOS并发编程对比总结,NSThread,NSOperation,GCD</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160825property/">【iOS】property属性的weak,strong,copy,assign</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160824Contacts/">【iOS】私人通讯录Demo</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160823Cocoapods/">Cocoapods 安装</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160821UIKitClasses/">UIKit继承结构</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160821ControllerManager/">【iOS】iOS控制器管理,代码,xib,Storyboard,Segue</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160821ApplicationStart/">【iOS】iOS程序启动过程,原理,UIApplication,代码启动界面</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160817XcodePlug/">【iOS】Xcode插件管理工具Alcatraz,常用插件介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160816NotificationSum/">【iOS】Notification通知,通知中心,发布通知,通知代理对比</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160816ViewControllerProgrammingGuide/">【iOS】视图控制器编程指南View Controller Programming Guide for iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160814UIBase/">UIButton,UIScrollView,UITableView常见属性,使用案例 - iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160814NSFoundationTran/">集合间相互转换,浅谈相关内存管理,使用NSData处理数据,使用NSDate - iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160814NSSetSum/">NSSet 集合创建,获取,遍历,可变集合的删除 - iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160814NSDictionarySum/">NSDictionary字典创建,获取,遍历,可变字典的删除 - iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160814NSArraySum/">NSArray/NSMutableArray创建,获取,遍历,排序 - iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160813NSStringSum/">NSString的获取,判断,转换,重组,文件读写 - iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160813FoundationSum/">iOS 结构体</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160813PropertySynthesize/">iOS - @property 和 @synthesize 总结</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160813DescriptionMethod/">description 方法 和 SEL - iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160813NatureOfClass/">Class 类的本质 - iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160813CategorySum/">Category 分类、类别 总结 - iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160813ProtocolSum/">Protocol 协议总结 - iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160812BlockSum/">Block编程总结 - iOS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160812ARCSum/">Automatic Reference Counting (ARC) 总结</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160811OCMemoryManagementSum/">Objective-C内存管理[iOS]</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160811OCMemoryManagement/">Advanced Memory Management Programming Guide 高级内存管理编程指南(官方文档翻译)[iOS]</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160810AboutHTTPLiveStream/">About HTTP Live Streaming官方文档翻译 [iOS]</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160803AVFoundation07TimeAndMediaRepresentations/">AVFoundation Programming Guide(官方文档翻译7)Time and Media Representations 时间和媒体表示</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160803AVFoundation06Export/">AVFoundation Programming Guide(官方文档翻译6)Export - 输出</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160803AVFoundation05StillAndVideoMediaCapture/">AVFoundation Programming Guide(官方文档翻译5)Still and Video Media Capture - 静态视频媒体捕获。</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160803AVFoundation04Editing/">AVFoundation Programming Guide(官方文档翻译4)Editing - 编辑</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160803AVFoundation03Playback/">AVFoundation Programming Guide(官方文档翻译3)Playback - 播放</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160803AVFoundation02UsingAssets/">AVFoundation Programming Guide(官方文档翻译2)Using Assets - 使用Assets</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160803AVFoundation01Introduction/">AVFoundation Programming Guide(官方文档翻译1)About AVFoundation - AVFoundation概述</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160724AVFoundation/">AVFoundation Programming Guide(官方文档翻译)完整版中英对照</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160426Matchismo/">【iOS】Stanford iOS7 Assignment - Matchismo</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160420ObjectiveCProgrammingNote/">【iOS】Objective C Programming The Big Nerd Ranch Guide 2nd Edition - Note</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160419StructMemory/">【C语言】结构体内存对齐模式</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160417CMemory/">【C语言】C语言内存四区 - 概念与代码示例</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160417MallocCallocRelloc/">【C语言】malloc,calloc,relloc异同示例</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160416DiskFormatForHFS/">【渔】NTFS转HFS</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160415MarkdownSyntax/">【渔】Markdown语法（看这张图就够了）</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160415WebsiteRecommend/">【渔】网站推荐</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160414KobeLeave/">【随笔】2016年4月14日 Kobe Bryant完美谢幕</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160408FirstHackintosh/">【渔】联想Y430P - 成功完美黑苹果上身，同时有win8.1做备用</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160329NumberCodeTable/">【快速记忆】数字编码表</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160328SuperMemoryBackground/">【快速记忆】快速记忆背景</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160325ReadIndex/">【读书笔记】最近读书的目录</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160325ReadNotePomodoro/">【读书笔记】番茄工作法图解</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160323buildBlog01/">【建立博客】使用Github和Hexo搭建属于自己的博客</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160322essay002/">【随笔】原文名：鹅场offer已Get，下周签约，终于能静下心来总结总结</a></li><li class="post-list-item"><a class="post-list-link" href="/post/20160322readNotes001/">【读书笔记】把你的英语用起来</a></li><li class="post-list-item"><a class="post-list-link" href="/post/hexo-post/">模板</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016-2017 Yofer Zhang
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 4;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





    <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
            
            
            
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>