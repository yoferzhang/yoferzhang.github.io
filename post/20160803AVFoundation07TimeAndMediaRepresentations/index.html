
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>AVFoundation Programming Guide(官方文档翻译7)Time and Media Representations 时间和媒体表示 | YoferZhang 的博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Yofer Zhang">
    

    
    <meta name="description" content="新博客：完整版 - AVFoundation Programming Guide
分章节版：– 第1章：About AVFoundation - AVFoundation概述– 第2章：Using Assets - 使用Assets– 第3章：Playback - 播放– 第4章：Editing - 编辑– 第5章：Still and Video Media Capture - 静态视频媒体捕获">
<meta property="og:type" content="article">
<meta property="og:title" content="AVFoundation Programming Guide(官方文档翻译7)Time and Media Representations 时间和媒体表示">
<meta property="og:url" content="http://yoferzhang.com/post/20160803AVFoundation07TimeAndMediaRepresentations/index.html">
<meta property="og:site_name" content="YoferZhang 的博客">
<meta property="og:description" content="新博客：完整版 - AVFoundation Programming Guide
分章节版：– 第1章：About AVFoundation - AVFoundation概述– 第2章：Using Assets - 使用Assets– 第3章：Playback - 播放– 第4章：Editing - 编辑– 第5章：Still and Video Media Capture - 静态视频媒体捕获">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/a9c4d5f6gw1f6kx28dgzuj20lc0cojri.jpg">
<meta property="og:image" content="http://ww3.sinaimg.cn/large/a9c4d5f6gw1f6kxhx9jerj20n009f0st.jpg">
<meta property="og:updated_time" content="2017-02-09T05:30:44.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="AVFoundation Programming Guide(官方文档翻译7)Time and Media Representations 时间和媒体表示">
<meta name="twitter:description" content="新博客：完整版 - AVFoundation Programming Guide
分章节版：– 第1章：About AVFoundation - AVFoundation概述– 第2章：Using Assets - 使用Assets– 第3章：Playback - 播放– 第4章：Editing - 编辑– 第5章：Still and Video Media Capture - 静态视频媒体捕获">
<meta name="twitter:image" content="http://ww1.sinaimg.cn/large/a9c4d5f6gw1f6kx28dgzuj20lc0cojri.jpg">
<meta name="twitter:creator" content="@LuciferZhangyq">
<link rel="publisher" href="110295955443575724222">

    
    <link rel="alternative" href="/atom.xml" title="YoferZhang 的博客" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/faviconr.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.jpg" alt="YoferZhang 的博客" title="YoferZhang 的博客"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="YoferZhang 的博客">YoferZhang 的博客</a></h1>
				<h2 class="blog-motto">数学出身，功底扎实，热爱编程，虽然编程起步晚，但是冲劲十足。</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/index/">索引 | Index</a></li>
					
						<li><a href="/archives">归档 | Archives</a></li>
					
						<li><a href="/about">关于 | About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoferzhang.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/post/20160803AVFoundation07TimeAndMediaRepresentations/" title="AVFoundation Programming Guide(官方文档翻译7)Time and Media Representations 时间和媒体表示" itemprop="url">AVFoundation Programming Guide(官方文档翻译7)Time and Media Representations 时间和媒体表示</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/110295955443575724222?rel=author" title="Yofer Zhang" target="_blank" itemprop="author">Yofer Zhang</a>
		
  <p class="article-time">
    <time datetime="2016-08-03T07:07:26.000Z" itemprop="datePublished"> 发表于 2016-08-03</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Time-and-Media-Representations-时间和媒体表现"><span class="toc-number">1.</span> <span class="toc-text">Time and Media Representations - 时间和媒体表现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Representation-of-Assets-资产的表示"><span class="toc-number">1.1.</span> <span class="toc-text">Representation of Assets - 资产的表示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Representations-of-Time-时间的表示"><span class="toc-number">2.</span> <span class="toc-text">Representations of Time - 时间的表示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CMTime-Represents-a-Length-of-Time-CMTime-表示时间的长度"><span class="toc-number">2.0.1.</span> <span class="toc-text">CMTime Represents a Length of Time - CMTime 表示时间的长度</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Using-CMTime-使用-CMTime"><span class="toc-number">2.0.1.1.</span> <span class="toc-text">Using CMTime - 使用 CMTime</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Special-Values-of-CMTime-CMTime-的特殊值"><span class="toc-number">2.0.1.2.</span> <span class="toc-text">Special Values of CMTime - CMTime 的特殊值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Representing-CMTime-as-an-Object-CMTime表示为一个对象"><span class="toc-number">2.0.1.3.</span> <span class="toc-text">Representing CMTime as an Object - CMTime表示为一个对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Epochs-纪元"><span class="toc-number">2.0.1.4.</span> <span class="toc-text">Epochs - 纪元</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CMTimeRange-Represents-a-Time-Range-CMTimeRange表示一个时间范围"><span class="toc-number">2.0.2.</span> <span class="toc-text">CMTimeRange Represents a Time Range - CMTimeRange表示一个时间范围</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Working-with-Time-Ranges-与时间范围工作"><span class="toc-number">2.0.2.1.</span> <span class="toc-text">Working with Time Ranges - 与时间范围工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Special-Values-of-CMTimeRange-CMTimeRange-的特殊值"><span class="toc-number">2.0.2.2.</span> <span class="toc-text">Special Values of CMTimeRange - CMTimeRange 的特殊值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Representing-a-CMTimeRange-Structure-as-an-Object-将-CMTimeRange-结构体表示为对象"><span class="toc-number">2.0.2.3.</span> <span class="toc-text">Representing a CMTimeRange Structure as an Object - 将 CMTimeRange 结构体表示为对象</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Representations-of-Media-媒体的表示"><span class="toc-number">2.1.</span> <span class="toc-text">Representations of Media - 媒体的表示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Converting-CMSampleBuffer-to-a-UIImage-Object-将-CMSampleBuffer-转化为-UIImage-对象"><span class="toc-number">2.2.</span> <span class="toc-text">Converting CMSampleBuffer to a UIImage Object - 将 CMSampleBuffer 转化为 UIImage 对象</span></a></li></ol></li></ol>
		
		</div>
		
		<blockquote>
<p>新博客：<br>完整版 - <a href="http://yoferzhang.com/post/20160724AVFoundation/">AVFoundation Programming Guide</a></p>
<p>分章节版：<br>– 第1章：<a href="http://yoferzhang.com/post/20160803AVFoundation01Introduction/">About AVFoundation - AVFoundation概述</a><br>– 第2章：<a href="http://yoferzhang.com/post/20160803AVFoundation02UsingAssets/">Using Assets - 使用Assets</a><br>– 第3章：<a href="http://yoferzhang.com/post/20160803AVFoundation03Playback/">Playback - 播放</a><br>– 第4章：<a href="http://yoferzhang.com/post/20160803AVFoundation04Editing/">Editing - 编辑</a><br>– 第5章：<a href="http://yoferzhang.com/post/20160803AVFoundation05StillAndVideoMediaCapture/">Still and Video Media Capture - 静态视频媒体捕获</a><br>– 第6章：<a href="http://yoferzhang.com/post/20160803AVFoundation06Export/">Export - 输出</a><br>– 第7章：<a href="http://yoferzhang.com/post/20160803AVFoundation07TimeAndMediaRepresentations/">Time and Media Representations 时间和媒体表现</a></p>
<p>CSDN博客：<br>完整版 - <a href="http://blog.csdn.net/zyq522376829/article/details/52144394" target="_blank" rel="external">AVFoundation Programming Guide</a></p>
<p>分章节版：<br>– 第1章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144317" target="_blank" rel="external">About AVFoundation - AVFoundation概述</a><br>– 第2章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144326" target="_blank" rel="external">Using Assets - 使用Assets</a><br>– 第3章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144333" target="_blank" rel="external">Playback - 播放</a><br>– 第4章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144342" target="_blank" rel="external">Editing - 编辑</a><br>– 第5章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144355" target="_blank" rel="external">Still and Video Media Capture - 静态视频媒体捕获</a><br>– 第6章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144366" target="_blank" rel="external">Export - 输出</a><br>– 第7章：<a href="http://blog.csdn.net/zyq522376829/article/details/52144372" target="_blank" rel="external">Time and Media Representations 时间和媒体表现</a></p>
<p>版权声明：本文为博主原创翻译，如需转载请注明出处。</p>
<p>苹果源文档地址 - <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40010188-CH1-SW3" target="_blank" rel="external">点击这里</a></p>
</blockquote>
<h1 id="Time-and-Media-Representations-时间和媒体表现"><a href="#Time-and-Media-Representations-时间和媒体表现" class="headerlink" title="Time and Media Representations - 时间和媒体表现"></a>Time and Media Representations - 时间和媒体表现</h1><p>Time-based audiovisual data, such as a movie file or a video stream, is represented in the AV Foundation framework by AVAsset. Its structure dictates much of the framework works. Several low-level data structures that AV Foundation uses to represent time and media such as sample buffers come from the Core Media framework.</p>
<p>基于视听资料的时间，比如一个电影文件或视频流，在<code>AV Foundation</code> 框架中是由 <code>AVAsset</code> 代表的。它的结构决定了大部分的框架工程。一些低层的数据结构（<code>AV Foundation</code> 使用来表示时间和媒体，比如样本缓冲区）来自 <code>Core Media framework</code>。</p>
<a id="more"></a>
<h2 id="Representation-of-Assets-资产的表示"><a href="#Representation-of-Assets-资产的表示" class="headerlink" title="Representation of Assets - 资产的表示"></a>Representation of Assets - 资产的表示</h2><p>AVAsset is the core class in the AV Foundation framework. It provides a format-independent abstraction of time-based audiovisual data, such as a movie file or a video stream. The primary relationships are shown in Figure 6-1. In many cases, you work with one of its subclasses: You use the composition subclasses when you create new assets (see Editing), and you use AVURLAsset to create a new asset instance from media at a given URL (including assets from the MPMedia framework or the Asset Library framework—see Using Assets).</p>
<p><a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsset_Class/index.html#//apple_ref/occ/cl/AVAsset" target="_blank" rel="external">AVAsset</a> 是 <code>AV Foundation</code> 框架的核心类。它提供了一个格式 – 与基于时间的视听数据的抽象无关，比如电影文件或视频流。主要的关系如图 6-1所示。在很多情况下，你都与它的一个子类一起工作：当你创建新的资产（见 <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40010188-CH1-SW1" target="_blank" rel="external">Editing</a>）使用组件的子类，并使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVURLAsset_Class/index.html#//apple_ref/occ/cl/AVURLAsset" target="_blank" rel="external">AVURLAsset</a> 从给定 <code>URL</code> 的媒体来创建一个新的资产实例。（包括来自 <code>MPMedia</code> 框架或者 <code>Asset Library framework</code> 的资产，见<a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/01_UsingAssets.html#//apple_ref/doc/uid/TP40010188-CH7-SW1" target="_blank" rel="external">Using Assets</a>）</p>
<center><br>    <img src="http://ww1.sinaimg.cn/large/a9c4d5f6gw1f6kx28dgzuj20lc0cojri.jpg" alt="Figure 6-1  AVAsset provides an abstraction of time-based audiovisual data"><br></center>

<p>An asset contains a collection of tracks that are intended to be presented or processed together, each of a uniform media type, including (but not limited to) audio, video, text, closed captions, and subtitles. The asset object provides information about whole resource, such as its duration or title, as well as hints for presentation, such as its natural size. Assets may also have metadata, represented by instances of AVMetadataItem.</p>
<p>资产包含了一组轨道，旨在被一起呈现或一起处理，每一个统一的媒体类型，包括（但不仅限于）音频、视频、文本、隐藏式字幕，以及字幕。资产对象提供关于整个资源的信息，比如它的持续时间或标题，以及用于呈现提示的信息，例如它的自然尺寸。资产也有可能拥有元数据，通过 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVMetadataItem_Class/index.html#//apple_ref/occ/cl/AVMetadataItem" target="_blank" rel="external">AVMetadataItem</a> 的实例表示。</p>
<p>A track is represented by an instance of AVAssetTrack, as shown in Figure 6-2. In a typical simple case, one track represents the audio component and another represents the video component; in a complex composition, there may be multiple overlapping tracks of audio and video.</p>
<p>轨道由 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetTrack_Class/index.html#//apple_ref/occ/cl/AVAssetTrack" target="_blank" rel="external">AVAssetTrack</a> 的实例表示，如图 6-2所示。在一个典型简单的情况下，一个轨道代表代表音频组件，另一个代表视频组件；在复杂的组成中，可以存在音频和视频的多个重叠的轨道。</p>
<center><br>    <img src="http://ww3.sinaimg.cn/large/a9c4d5f6gw1f6kxhx9jerj20n009f0st.jpg" alt="Figure 6-2  AVAssetTrack"><br></center>

<p>A track has a number of properties, such as its type (video or audio), visual and/or audible characteristics (as appropriate), metadata, and timeline (expressed in terms of its parent asset). A track also has an array of format descriptions. The array contains CMFormatDescription objects (see CMFormatDescriptionRef), each of which describes the format of media samples referenced by the track. A track that contains uniform media (for example, all encoded using to the same settings) will provide an array with a count of 1.</p>
<p>轨道有许多属性，比如它的类型（视频或者音频），视觉和/或听觉特性（根据需要），元数据和时间轴（在其父资产表示）。一个轨道也有格式描述的数组。数组包含 <code>CMFormatDescription</code> 对象（见 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMFormatDescription/index.html#//apple_ref/c/tdef/CMFormatDescriptionRef" target="_blank" rel="external">CMFormatDescriptionRef</a>），其中每一个都描述了轨道引用的媒体样本的格式。包含了统一媒体的轨道（例如，所有使用相同设置的编码）将提供计数为 <code>1</code> 的数组。</p>
<p>A track may itself be divided into segments, represented by instances of AVAssetTrackSegment. A segment is a time mapping from the source to the asset track timeline.</p>
<p>轨道自身可以被分成几段，由 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetTrackSegment_Class/index.html#//apple_ref/occ/cl/AVAssetTrackSegment" target="_blank" rel="external">AVAssetTrackSegment</a> 的实例表示。一个片段是一个时间映射，从资源到资产轨道时间轴的映射。</p>
<h1 id="Representations-of-Time-时间的表示"><a href="#Representations-of-Time-时间的表示" class="headerlink" title="Representations of Time - 时间的表示"></a>Representations of Time - 时间的表示</h1><p>Time in AV Foundation is represented by primitive structures from the Core Media framework.</p>
<p><code>AV Foundation</code> 中的时间是由来自 <code>Core Media framework</code> 的原始结构体表示的。</p>
<h3 id="CMTime-Represents-a-Length-of-Time-CMTime-表示时间的长度"><a href="#CMTime-Represents-a-Length-of-Time-CMTime-表示时间的长度" class="headerlink" title="CMTime Represents a Length of Time - CMTime 表示时间的长度"></a>CMTime Represents a Length of Time - <code>CMTime</code> 表示时间的长度</h3><p>CMTime is a C structure that represents time as a rational number, with a numerator (an int64_t value), and a denominator (an int32_t timescale). Conceptually, the timescale specifies the fraction of a second each unit in the numerator occupies. Thus if the timescale is 4, each unit represents a quarter of a second; if the timescale is 10, each unit represents a tenth of a second, and so on. You frequently use a timescale of 600, because this is a multiple of several commonly used frame rates: 24 fps for film, 30 fps for NTSC (used for TV in North America and Japan), and 25 fps for PAL (used for TV in Europe). Using a timescale of 600, you can exactly represent any number of frames in these systems.</p>
<p><a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/c/tdef/CMTime" target="_blank" rel="external">CMTime</a> 是一个C语言的结构体，以一个有理数表示时间，有一个分子（一个 <code>int64_t</code> 值）和一个分母（一个 <code>int32_t</code> 时间刻度）。在概念上讲，时间刻度指定一秒中每个单元占据的分数。因此如果时间刻度为 <code>4</code>，每个单元代表一秒的四分之一；如果时间刻度为 <code>10</code>，每个单元代表一秒的十分之一，等等。经常使用时间刻度为 <code>600</code>，因为这是因为这是几种常用帧速率的倍数：<code>24 fps</code>的电影， <code>30 fps</code> 的<code>NTSC</code>（用在北美洲和日本的电视），<code>25 fps</code>的 <code>PAL</code>（用于欧洲电视）。使用 <code>600</code>的时间刻度，可以在这些系统中精确的表示任意数量的帧。</p>
<p>In addition to a simple time value, a CMTime structure can represent nonnumeric values: +infinity, -infinity, and indefinite. It can also indicate whether the time been rounded at some point, and it maintains an epoch number.</p>
<p>除了简单的时间值，<code>CMTime</code> 结构体可以表示非数字的值：正无穷大、负无穷大，不确定的。它也可以表示时间在哪一位约等于，并且它能保持一个纪元数字。</p>
<h4 id="Using-CMTime-使用-CMTime"><a href="#Using-CMTime-使用-CMTime" class="headerlink" title="Using CMTime - 使用 CMTime"></a>Using CMTime - 使用 <code>CMTime</code></h4><p>You create a time using CMTimeMake or one of the related functions such as CMTimeMakeWithSeconds (which allows you to create a time using a float value and specify a preferred timescale). There are several functions for time-based arithmetic and for comparing times, as illustrated in the following example:</p>
<p>使用 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/c/func/CMTimeMake" target="_blank" rel="external">CMTimeMake</a> 或一个相关功能的 来创建一个时间，例如 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/c/func/CMTimeMakeWithSeconds" target="_blank" rel="external">CMTimeMakeWithSeconds</a> （它允许你使用浮点值来创建一个时间，并指定一个首选时间刻度）。有基于时间算术的和比较时间的几个功能，如下面的示例所示：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CMTime time1 = CMTimeMake(<span class="number">200</span>, <span class="number">2</span>); <span class="comment">// 200 half-seconds</span></span><br><span class="line">CMTime time2 = CMTimeMake(<span class="number">400</span>, <span class="number">4</span>); <span class="comment">// 400 quarter-seconds</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// time1 and time2 both represent 100 seconds, but using different timescales.</span></span><br><span class="line"><span class="keyword">if</span> (CMTimeCompare(time1, time2) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"time1 and time2 are the same"</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">Float64 float64Seconds = <span class="number">200.0</span> / <span class="number">3</span>;</span><br><span class="line">CMTime time3 = CMTimeMakeWithSeconds(float64Seconds , <span class="number">3</span>); <span class="comment">// 66.66... third-seconds</span></span><br><span class="line">time3 = CMTimeMultiply(time3, <span class="number">3</span>);</span><br><span class="line"><span class="comment">// time3 now represents 200 seconds; next subtract time1 (100 seconds).</span></span><br><span class="line">time3 = CMTimeSubtract(time3, time1);</span><br><span class="line">CMTimeShow(time3);</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> (CMTIME_CO<span class="built_in">MPARE_INLINE</span>(time2, ==, time3)) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"time2 and time3 are the same"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>For a list of all the available functions, see CMTime Reference.</p>
<p>有关所有可用的功能列表，请参阅 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/doc/uid/TP40009748" target="_blank" rel="external">CMTime Reference</a></p>
<h4 id="Special-Values-of-CMTime-CMTime-的特殊值"><a href="#Special-Values-of-CMTime-CMTime-的特殊值" class="headerlink" title="Special Values of CMTime - CMTime 的特殊值"></a>Special Values of CMTime - <code>CMTime</code> 的特殊值</h4><p>Core Media provides constants for special values: kCMTimeZero, kCMTimeInvalid, kCMTimePositiveInfinity, and kCMTimeNegativeInfinity. There are many ways in which a CMTime structure can, for example, represent a time that is invalid. To test whether a CMTime is valid, or a nonnumeric value, you should use an appropriate macro, such as CMTIME_IS_INVALID, CMTIME_IS_POSITIVE_INFINITY, or CMTIME_IS_INDEFINITE.</p>
<p><code>Core Media</code> 提供了特殊值的常量：<a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/doc/c_ref/kCMTimeZero" target="_blank" rel="external">kCMTimeZero</a>，<a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/doc/c_ref/kCMTimeInvalid" target="_blank" rel="external">kCMTimeInvalid</a>，<a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/doc/c_ref/kCMTimePositiveInfinity" target="_blank" rel="external">kCMTimePositiveInfinity</a>，以及 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/doc/c_ref/kCMTimeNegativeInfinity" target="_blank" rel="external">kCMTimeNegativeInfinity</a>。有许多方法，例如，其中 <code>CMTime</code> 结构体可以表示一个无效的时间。为了测试<code>CMTime</code> 是否是无效的，或者是一个非数字值，应该使用一个适当的宏，比如 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/c/macro/CMTIME_IS_INVALID" target="_blank" rel="external">CMTIME_IS_INVALID</a>，<a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/c/macro/CMTIME_IS_POSITIVE_INFINITY" target="_blank" rel="external">CMTIME_IS_POSITIVE_INFINITY</a>，或者 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/c/macro/CMTIME_IS_INDEFINITE" target="_blank" rel="external">CMTIME_IS_INDEFINITE</a></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CMTime myTime = &lt;<span class="meta">#Get a CMTime#&gt;;</span></span><br><span class="line"><span class="keyword">if</span> (CMTIME_IS_INVALID(myTime)) &#123;</span><br><span class="line">    <span class="comment">// Perhaps treat this as an error; display a suitable alert to the user.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You should not compare the value of an arbitrary CMTime structure with kCMTimeInvalid.</p>
<p>你不应该将一个任意的 <code>CMTime</code> 结构体的值与 <code>kCMTimeInvalid</code> 比较。</p>
<h4 id="Representing-CMTime-as-an-Object-CMTime表示为一个对象"><a href="#Representing-CMTime-as-an-Object-CMTime表示为一个对象" class="headerlink" title="Representing CMTime as an Object - CMTime表示为一个对象"></a>Representing CMTime as an Object - <code>CMTime</code>表示为一个对象</h4><p>If you need to use CMTime structures in annotations or Core Foundation containers, you can convert a CMTime structure to and from a CFDictionary opaque type (see CFDictionaryRef) using the CMTimeCopyAsDictionary and CMTimeMakeFromDictionary functions, respectively. You can also get a string representation of a CMTime structure using the CMTimeCopyDescription function.</p>
<p>如果你需要在注释或者 <code>Core Foundation</code> 容器中使用 <code>CMTime</code> 结构体，可以使用 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/c/func/CMTimeCopyAsDictionary" target="_blank" rel="external">CMTimeCopyAsDictionary</a> 将 <code>CMTime</code> 结构体转换，使用 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/c/func/CMTimeMakeFromDictionary" target="_blank" rel="external">CMTimeMakeFromDictionary</a> 从一个 <code>CFDictionary</code> 不透明的类型（见 <a href="https://developer.apple.com/library/ios/documentation/CoreFoundation/Reference/CFDictionaryRef/index.html#//apple_ref/c/tdef/CFDictionaryRef" target="_blank" rel="external">CFDictionaryRef</a>）。使用 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTime/index.html#//apple_ref/c/func/CMTimeCopyDescription" target="_blank" rel="external">CMTimeCopyDescription</a> 函数可以得到一个 <code>CMTime</code> 结构体的字符串表示。</p>
<h4 id="Epochs-纪元"><a href="#Epochs-纪元" class="headerlink" title="Epochs - 纪元"></a>Epochs - 纪元</h4><p>The epoch number of a CMTime structure is usually set to 0, but you can use it to distinguish unrelated timelines. For example, the epoch could be incremented through each cycle using a presentation loop, to differentiate between time N in loop 0 and time N in loop 1.</p>
<p><code>CMTime</code> 结构体的纪元数量通常设置为 <code>0</code>，但是你可以用它来区分不相关的时间轴。例如，纪元可以通过使用演示循环每个周期递增，区分循环<code>0</code>中的时间 <code>N</code>与循环<code>1</code>中的时间 <code>N</code>。</p>
<h3 id="CMTimeRange-Represents-a-Time-Range-CMTimeRange表示一个时间范围"><a href="#CMTimeRange-Represents-a-Time-Range-CMTimeRange表示一个时间范围" class="headerlink" title="CMTimeRange Represents a Time Range - CMTimeRange表示一个时间范围"></a>CMTimeRange Represents a Time Range - <code>CMTimeRange</code>表示一个时间范围</h3><p>CMTimeRange is a C structure that has a start time and duration, both expressed as CMTime structures. A time range does not include the time that is the start time plus the duration.</p>
<p>You create a time range using CMTimeRangeMake or CMTimeRangeFromTimeToTime. There are constraints on the value of the CMTime epochs:</p>
<ul>
<li>CMTimeRange structures cannot span different epochs.</li>
<li>The epoch in a CMTime structure that represents a timestamp may be nonzero, but you can only - perform range operations (such as CMTimeRangeGetUnion) on ranges whose start fields have the - same epoch.</li>
<li>The epoch in a CMTime structure that represents a duration should always be 0, and the value must be nonnegative.</li>
</ul>
<p><a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/tdef/CMTimeRange" target="_blank" rel="external">CMTimeRange</a> 是一个 C语言结构体，有开始时间和持续时间，即表示为 <code>CMTime</code> 结构体。时间范围不包括开始时间加上持续时间。</p>
<p>使用 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/func/CMTimeRangeMake" target="_blank" rel="external">CMTimeRangeMake</a> 或者 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/func/CMTimeRangeFromTimeToTime" target="_blank" rel="external">CMTimeRangeFromTimeToTime</a> 创建一个时间范围。有关 <code>CMTime</code> 纪元的值，有一些约束：</p>
<ul>
<li><code>CMTimeRange</code> 结构体不能跨越不同的纪元。</li>
<li><code>CMTime</code> 结构体中的纪元，表示一个时间戳可能是非零，但你只能在其开始字段具有相同纪元的范围内执行范围操作（比如 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/func/CMTimeRangeGetUnion" target="_blank" rel="external">CMTimeRangeGetUnion</a>）。</li>
<li>在 <code>CMTime</code> 结构体中的纪元，表示持续时间应该总是为 <code>0</code>，并且值必须是非负数。</li>
</ul>
<h4 id="Working-with-Time-Ranges-与时间范围工作"><a href="#Working-with-Time-Ranges-与时间范围工作" class="headerlink" title="Working with Time Ranges - 与时间范围工作"></a>Working with Time Ranges - 与时间范围工作</h4><p>Core Media provides functions you can use to determine whether a time range contains a given time or other time range, to determine whether two time ranges are equal, and to calculate unions and intersections of time ranges, such as CMTimeRangeContainsTime, CMTimeRangeEqual, CMTimeRangeContainsTimeRange, and CMTimeRangeGetUnion.</p>
<p><code>Core Media</code> 提供了一些功能，可用于确定一个时间范围是否包含一个特定的时间或其他时间范围，确定两个时间范围是否相等，并计算时间范围的接口和相交范围，比如 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/func/CMTimeRangeContainsTime" target="_blank" rel="external">CMTimeRangeContainsTime</a>，<a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/func/CMTimeRangeEqual" target="_blank" rel="external">CMTimeRangeEqual</a>，<a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/func/CMTimeRangeContainsTimeRange" target="_blank" rel="external">CMTimeRangeContainsTimeRange</a>，以及 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/func/CMTimeRangeGetUnion" target="_blank" rel="external">CMTimeRangeGetUnion</a>。</p>
<p>Given that a time range does not include the time that is the start time plus the duration, the following expression always evaluates to false:</p>
<p>由于时间范围不包括开始时间加上持续时间，下面的表达式的结果总是为 <code>false</code>：</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CMTimeRangeContainsTime(range, CMTimeRangeGetEnd(range))</span><br></pre></td></tr></table></figure>
<p>For a list of all the available functions, see CMTimeRange Reference.</p>
<p>有关所有可用功能的列表，请参阅 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/doc/uid/TP40009749" target="_blank" rel="external">CMTimeRange Reference</a>。</p>
<h4 id="Special-Values-of-CMTimeRange-CMTimeRange-的特殊值"><a href="#Special-Values-of-CMTimeRange-CMTimeRange-的特殊值" class="headerlink" title="Special Values of CMTimeRange - CMTimeRange 的特殊值"></a>Special Values of CMTimeRange - <code>CMTimeRange</code> 的特殊值</h4><p>Core Media provides constants for a zero-length range and an invalid range, kCMTimeRangeZero and kCMTimeRangeInvalid, respectively. There are many ways, though in which a CMTimeRange structure can be invalid, or zero—or indefinite (if one of the CMTime structures is indefinite. If you need to test whether a CMTimeRange structure is valid, zero, or indefinite, you should use an appropriate macro: CMTIMERANGE_IS_VALID, CMTIMERANGE_IS_INVALID, CMTIMERANGE_IS_EMPTY, or CMTIMERANGE_IS_EMPTY.</p>
<p><code>Core Media</code> 分别提供一个长度为0的范围和一个无效范围，就是<a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/data/kCMTimeRangeZero" target="_blank" rel="external">kCMTimeRangeZero</a> 和 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/data/kCMTimeRangeInvalid" target="_blank" rel="external">kCMTimeRangeInvalid</a>。有很多种方法，尽管 <code>CMTimeRange</code> 结构可以是无效的，或为零，或是不确定的（如果<code>CMTime</code> 结构是不确定的）。如果你需要测试 <code>`CMTimeRange</code> 结构体是否是有效的，零，或者不确定，你应该使用适当的宏：<a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/macro/CMTIMERANGE_IS_VALID" target="_blank" rel="external">CMTIMERANGE_IS_VALID</a>，<a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/macro/CMTIMERANGE_IS_INVALID" target="_blank" rel="external">CMTIMERANGE_IS_INVALID</a>，<a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/macro/CMTIMERANGE_IS_EMPTY" target="_blank" rel="external">CMTIMERANGE_IS_EMPTY</a>，或者 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/macro/CMTIMERANGE_IS_INDEFINITE" target="_blank" rel="external">CMTIMERANGE_IS_INDEFINITE</a>。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CMTimeRange myTimeRange = &lt;<span class="meta">#Get a CMTimeRange#&gt;;</span></span><br><span class="line"><span class="keyword">if</span> (CMTIMERANGE_IS_E<span class="built_in">MPTY</span>(myTimeRange)) &#123;</span><br><span class="line">    <span class="comment">// The time range is zero.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You should not compare the value of an arbitrary CMTimeRange structure with kCMTimeRangeInvalid.</p>
<p>你不应该将任意的 <code>CMTimeRange</code> 结构体的值与 <code>kCMTimeRangeInvalid</code>进行比较。</p>
<h4 id="Representing-a-CMTimeRange-Structure-as-an-Object-将-CMTimeRange-结构体表示为对象"><a href="#Representing-a-CMTimeRange-Structure-as-an-Object-将-CMTimeRange-结构体表示为对象" class="headerlink" title="Representing a CMTimeRange Structure as an Object - 将 CMTimeRange 结构体表示为对象"></a>Representing a CMTimeRange Structure as an Object - 将 <code>CMTimeRange</code> 结构体表示为对象</h4><p>If you need to use CMTimeRange structures in annotations or Core Foundation containers, you can convert a CMTimeRange structure to and from a CFDictionary opaque type (see CFDictionaryRef) using CMTimeRangeCopyAsDictionary and CMTimeRangeMakeFromDictionary, respectively. You can also get a string representation of a CMTime structure using the CMTimeRangeCopyDescription function.</p>
<p>如果你需要在注释或 <code>Core Foundation</code> 容器中使用 <code>CMTimeRange</code> 结构，可以使用 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/func/CMTimeRangeCopyAsDictionary" target="_blank" rel="external">CMTimeRangeCopyAsDictionary</a> 转换一个 <code>CMTimeRange</code> ，使用 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/func/CMTimeRangeMakeFromDictionary" target="_blank" rel="external">CMTimeRangeMakeFromDictionary</a> 从一个 <code>CFDictionary</code> 不透明类型 （见 <a href="https://developer.apple.com/library/ios/documentation/CoreFoundation/Reference/CFDictionaryRef/index.html#//apple_ref/c/tdef/CFDictionaryRef" target="_blank" rel="external">CFDictionaryRef</a>）。也可以 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMTimeRange/index.html#//apple_ref/c/func/CMTimeRangeCopyDescription" target="_blank" rel="external">CMTimeRangeCopyDescription</a> 功能得到 <code>CMTime</code> 结构的一个字符串表示。</p>
<h2 id="Representations-of-Media-媒体的表示"><a href="#Representations-of-Media-媒体的表示" class="headerlink" title="Representations of Media - 媒体的表示"></a>Representations of Media - 媒体的表示</h2><p>Video data and its associated metadata are represented in AV Foundation by opaque objects from the Core Media framework. Core Media represents video data using CMSampleBuffer (see CMSampleBufferRef). CMSampleBuffer is a Core Foundation-style opaque type; an instance contains the sample buffer for a frame of video data as a Core Video pixel buffer (see CVPixelBufferRef). You access the pixel buffer from a sample buffer using CMSampleBufferGetImageBuffer:</p>
<p>视频数据和其相关的元数据都是被 <code>AV Foundation</code> 中来自 <code>Core Media framework</code>的不透明对象表示。<code>Core Media</code> 表示视频数据 使用 <code>CMSampleBuffer</code>（见 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMSampleBuffer/index.html#//apple_ref/c/tdef/CMSampleBufferRef" target="_blank" rel="external">CMSampleBufferRef</a>）。<code>CMSampleBuffer</code> 是 <code>Core Foundation</code> 风格的不透明类型；实例包含了用于作为<code>Core Video</code> 像素缓冲（见<a href="https://developer.apple.com/library/ios/documentation/QuartzCore/Reference/CVPixelBufferRef/index.html#//apple_ref/c/tdef/CVPixelBufferRef" target="_blank" rel="external">CVPixelBufferRef</a>）的视频数据的单帧样品缓冲区。使用 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMSampleBuffer/index.html#//apple_ref/c/func/CMSampleBufferGetImageBuffer" target="_blank" rel="external">CMSampleBufferGetImageBuffer</a> 从一个样本缓冲区访问像素缓冲。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CVPixelBufferRef pixelBuffer = CMSampleBufferGetImageBuffer(&lt;<span class="meta">#A CMSampleBuffer#&gt;);</span></span><br></pre></td></tr></table></figure>
<p>From the pixel buffer, you can access the actual video data. For an example, see Converting CMSampleBuffer to a UIImage Object.</p>
<p>In addition to the video data, you can retrieve a number of other aspects of the video frame:</p>
<ul>
<li>Timing information. You get accurate timestamps for both the original presentation time and - the decode time using CMSampleBufferGetPresentationTimeStamp and - CMSampleBufferGetDecodeTimeStamp respectively.</li>
<li>Format information. The format information is encapsulated in a CMFormatDescription object (- see CMFormatDescriptionRef). From the format description, you can get for example the pixel - type and video dimensions using CMVideoFormatDescriptionGetCodecType and - CMVideoFormatDescriptionGetDimensions respectively.</li>
<li>Metadata. Metadata are stored in a dictionary as an attachment. You use CMGetAttachment to retrieve the dictionary:</li>
</ul>
<p>从像素缓冲区，可以访问实际的视频数据。有个例子，请参阅 <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/06_MediaRepresentations.html#//apple_ref/doc/uid/TP40010188-CH2-SW4" target="_blank" rel="external">Converting CMSampleBuffer to a UIImage Object</a>。</p>
<p>除了视频数据之外，可以从数据帧中检索多个其他方面的信息：</p>
<ul>
<li>定时信息。分别使用 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMSampleBuffer/index.html#//apple_ref/c/func/CMSampleBufferGetPresentationTimeStamp" target="_blank" rel="external">CMSampleBufferGetPresentationTimeStamp</a> 和 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMSampleBuffer/index.html#//apple_ref/c/func/CMSampleBufferGetDecodeTimeStamp" target="_blank" rel="external">CMSampleBufferGetDecodeTimeStamp</a>为原来的呈现时间和解码时间，获取准确的时间戳。</li>
<li>格式信息。格式信息被封装在 <code>CMFormatDescription</code> 对象(见 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMFormatDescription/index.html#//apple_ref/c/tdef/CMFormatDescriptionRef" target="_blank" rel="external">CMFormatDescriptionRef</a>）。从格式的描述，分别使用 <code>CMVideoFormatDescriptionGetCodecType</code> 和 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMFormatDescription/index.html#//apple_ref/c/func/CMVideoFormatDescriptionGetDimensions" target="_blank" rel="external">CMVideoFormatDescriptionGetDimensions</a> 可以得到例如像素类型和视频尺寸。</li>
<li>元数据。元数据作为附件被存储在字典中。使用 <a href="https://developer.apple.com/library/ios/documentation/CoreMedia/Reference/CMAttachment/index.html#//apple_ref/c/func/CMGetAttachment" target="_blank" rel="external">CMGetAttachment</a> 去检索词典：</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CMSampleBufferRef sampleBuffer = &lt;<span class="meta">#Get a sample buffer#&gt;;</span></span><br><span class="line"><span class="built_in">CFDictionaryRef</span> metadataDictionary =</span><br><span class="line">    CMGetAttachment(sampleBuffer, <span class="built_in">CFSTR</span>(<span class="string">"MetadataDictionary"</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="keyword">if</span> (metadataDictionary) &#123;</span><br><span class="line">    <span class="comment">// Do something with the metadata.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Converting-CMSampleBuffer-to-a-UIImage-Object-将-CMSampleBuffer-转化为-UIImage-对象"><a href="#Converting-CMSampleBuffer-to-a-UIImage-Object-将-CMSampleBuffer-转化为-UIImage-对象" class="headerlink" title="Converting CMSampleBuffer to a UIImage Object - 将 CMSampleBuffer 转化为 UIImage 对象"></a>Converting CMSampleBuffer to a UIImage Object - 将 <code>CMSampleBuffer</code> 转化为 <code>UIImage</code> 对象</h2><p>The following code shows how you can convert a CMSampleBuffer to a UIImage object. You should consider your requirements carefully before using it. Performing the conversion is a comparatively expensive operation. It is appropriate to, for example, create a still image from a frame of video data taken every second or so. You should not use this as a means to manipulate every frame of video coming from a capture device in real time.</p>
<p>下面的代码展示了如何将一个 <code>CMSampleBuffer</code> 转化为一个 <code>UIImage</code> 对象。在使用它之前，应该仔细考虑你的要求。执行转换是一个相对昂贵的操作。例如，比较合适的是 从每一秒左右的视频数据的一帧创建一个静态图像。你不应该使用这个作为一种手段 去操作来自实时捕获设备的视频的每一帧。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Create a UIImage from sample buffer data</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *) imageFromSampleBuffer:(CMSampleBufferRef) sampleBuffer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Get a CMSampleBuffer's Core Video image buffer for the media data</span></span><br><span class="line">    CVImageBufferRef imageBuffer = CMSampleBufferGetImageBuffer(sampleBuffer);</span><br><span class="line">    <span class="comment">// Lock the base address of the pixel buffer</span></span><br><span class="line">    CVPixelBufferLockBaseAddress(imageBuffer, <span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Get the number of bytes per row for the pixel buffer</span></span><br><span class="line">    <span class="keyword">void</span> *baseAddress = CVPixelBufferGetBaseAddress(imageBuffer);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Get the number of bytes per row for the pixel buffer</span></span><br><span class="line">    size_t bytesPerRow = CVPixelBufferGetBytesPerRow(imageBuffer);</span><br><span class="line">    <span class="comment">// Get the pixel buffer width and height</span></span><br><span class="line">    size_t width = CVPixelBufferGetWidth(imageBuffer);</span><br><span class="line">    size_t height = CVPixelBufferGetHeight(imageBuffer);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Create a device-dependent RGB color space</span></span><br><span class="line">    <span class="built_in">CGColorSpaceRef</span> colorSpace = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Create a bitmap graphics context with the sample buffer data</span></span><br><span class="line">    <span class="built_in">CGContextRef</span> context = <span class="built_in">CGBitmapContextCreate</span>(baseAddress, width, height, <span class="number">8</span>,</span><br><span class="line">      bytesPerRow, colorSpace, k<span class="built_in">CGBitmapByteOrder32Little</span> | k<span class="built_in">CGImageAlphaPremultipliedFirst</span>);</span><br><span class="line">    <span class="comment">// Create a Quartz image from the pixel data in the bitmap graphics context</span></span><br><span class="line">    <span class="built_in">CGImageRef</span> quartzImage = <span class="built_in">CGBitmapContextCreateImage</span>(context);</span><br><span class="line">    <span class="comment">// Unlock the pixel buffer</span></span><br><span class="line">    CVPixelBufferUnlockBaseAddress(imageBuffer,<span class="number">0</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Free up the context and color space</span></span><br><span class="line">    <span class="built_in">CGContextRelease</span>(context);</span><br><span class="line">    <span class="built_in">CGColorSpaceRelease</span>(colorSpace);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Create an image object from the Quartz image</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWith<span class="built_in">CGImage</span>:quartzImage];</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Release the Quartz image</span></span><br><span class="line">    <span class="built_in">CGImageRelease</span>(quartzImage);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> (image);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后记：2016年8月7日，16：38，翻译至此结束：本文翻译的版本是官方文档2015-06-30版，也就是现在的最新版，翻译成果中还有许多需要校对的地方，希望查阅的小伙伴遇到问题能反馈给我。我也会在接下来的几天写 demo的同时，再次进行校对。感谢导师和leader，给我机会完成这项工作。</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoferzhang.com/post/20160803AVFoundation07TimeAndMediaRepresentations/" data-title="AVFoundation Programming Guide(官方文档翻译7)Time and Media Representations 时间和媒体表示 | YoferZhang 的博客" data-tsina="2848249334" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/post/20160810AboutHTTPLiveStream/" title="【iOS】About HTTP Live Streaming官方文档翻译">
  <strong>上一篇：</strong><br/>
  <span>
  【iOS】About HTTP Live Streaming官方文档翻译</span>
</a>
</div>


<div class="next">
<a href="/post/20160803AVFoundation06Export/"  title="AVFoundation Programming Guide(官方文档翻译6)Export - 输出">
 <strong>下一篇：</strong><br/> 
 <span>AVFoundation Programming Guide(官方文档翻译6)Export - 输出
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="post/20160803AVFoundation07TimeAndMediaRepresentations/" data-title="AVFoundation Programming Guide(官方文档翻译7)Time and Media Representations 时间和媒体表示" data-url="http://yoferzhang.com/post/20160803AVFoundation07TimeAndMediaRepresentations/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Time-and-Media-Representations-时间和媒体表现"><span class="toc-number">1.</span> <span class="toc-text">Time and Media Representations - 时间和媒体表现</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Representation-of-Assets-资产的表示"><span class="toc-number">1.1.</span> <span class="toc-text">Representation of Assets - 资产的表示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Representations-of-Time-时间的表示"><span class="toc-number">2.</span> <span class="toc-text">Representations of Time - 时间的表示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CMTime-Represents-a-Length-of-Time-CMTime-表示时间的长度"><span class="toc-number">2.0.1.</span> <span class="toc-text">CMTime Represents a Length of Time - CMTime 表示时间的长度</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Using-CMTime-使用-CMTime"><span class="toc-number">2.0.1.1.</span> <span class="toc-text">Using CMTime - 使用 CMTime</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Special-Values-of-CMTime-CMTime-的特殊值"><span class="toc-number">2.0.1.2.</span> <span class="toc-text">Special Values of CMTime - CMTime 的特殊值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Representing-CMTime-as-an-Object-CMTime表示为一个对象"><span class="toc-number">2.0.1.3.</span> <span class="toc-text">Representing CMTime as an Object - CMTime表示为一个对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Epochs-纪元"><span class="toc-number">2.0.1.4.</span> <span class="toc-text">Epochs - 纪元</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CMTimeRange-Represents-a-Time-Range-CMTimeRange表示一个时间范围"><span class="toc-number">2.0.2.</span> <span class="toc-text">CMTimeRange Represents a Time Range - CMTimeRange表示一个时间范围</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Working-with-Time-Ranges-与时间范围工作"><span class="toc-number">2.0.2.1.</span> <span class="toc-text">Working with Time Ranges - 与时间范围工作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Special-Values-of-CMTimeRange-CMTimeRange-的特殊值"><span class="toc-number">2.0.2.2.</span> <span class="toc-text">Special Values of CMTimeRange - CMTimeRange 的特殊值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Representing-a-CMTimeRange-Structure-as-an-Object-将-CMTimeRange-结构体表示为对象"><span class="toc-number">2.0.2.3.</span> <span class="toc-text">Representing a CMTimeRange Structure as an Object - 将 CMTimeRange 结构体表示为对象</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Representations-of-Media-媒体的表示"><span class="toc-number">2.1.</span> <span class="toc-text">Representations of Media - 媒体的表示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Converting-CMSampleBuffer-to-a-UIImage-Object-将-CMSampleBuffer-转化为-UIImage-对象"><span class="toc-number">2.2.</span> <span class="toc-text">Converting CMSampleBuffer to a UIImage Object - 将 CMSampleBuffer 转化为 UIImage 对象</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="yoferzhang" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/AI/" title="AI">AI<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/C语言/" title="C语言">C语言<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>51</sup></a></li>
		  
		
		  
			<li><a href="/categories/渔/" title="渔">渔<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/艺术/" title="艺术">艺术<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书感悟/" title="读书感悟">读书感悟<sup>17</sup></a></li>
		  
		
		  
			<li><a href="/categories/随笔/" title="随笔">随笔<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://hexo.io/" target="_blank" title="Hexo">Hexo</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/yoferzhang" target="_blank" title="Github">Github</a>
            
          </li>
        
          <li>
            
            	<a href="http://ww3.sinaimg.cn/large/a9c4d5f6jw1f2cbilh1uyj2076076t97.jpg" target="_blank" title="WeChat">WeChat</a>
            
          </li>
        
          <li>
            
            	<a href="https://cn.linkedin.com/in/耀琦-张-771388117" target="_blank" title="LinkedIn">LinkedIn</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Yofer Zhang in Tencent. <br/>
			This is my blog,thank you to here.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2848249334" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/yoferzhang" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/yofer-zhang" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/LuciferZhangyq" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/luciferzhang" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/耀琦-张-771388117?trk=hp-identity-name" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/zyq522376829" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/yoferzhang" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		<a href="https://plus.google.com/110295955443575724222?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:522376829@qq.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2018 
		
		<a href="/about" target="_blank" title="Yofer Zhang">Yofer Zhang</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"yoferzhang"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//yoferzhang.github.io/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->

<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-83435219-1', 'yoferzhang.com');  
ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a6dda28cb6f26de955e11a3716d6ce9b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
