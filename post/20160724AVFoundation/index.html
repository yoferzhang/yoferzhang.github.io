
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>【iOS】AVFoundation Programming Guide 官方文档-中文翻译-中英对照 | Mathematical Method, the Way of the World</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Yofer">
    

    
    <meta name="description" content="版权声明：本文为博主原创翻译，如需转载请注明出处。
苹果源文档地址 - 点击这里

About AVFoundation - AVFoundation概述AVFoundation is one of several frameworks that you can use to play and create time-based audiovisual media. It provides an">
<meta property="og:type" content="article">
<meta property="og:title" content="【iOS】AVFoundation Programming Guide 官方文档-中文翻译-中英对照">
<meta property="og:url" content="http://yoferzhang.com/post/20160724AVFoundation/index.html">
<meta property="og:site_name" content="Mathematical Method, the Way of the World">
<meta property="og:description" content="版权声明：本文为博主原创翻译，如需转载请注明出处。
苹果源文档地址 - 点击这里

About AVFoundation - AVFoundation概述AVFoundation is one of several frameworks that you can use to play and create time-based audiovisual media. It provides an">
<meta property="og:image" content="http://ww3.sinaimg.cn/large/a9c4d5f6gw1f650lssb7bj20l80d5jsa.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/a9c4d5f6gw1f651hbl7ohj20l80dg0ts.jpg">
<meta property="og:updated_time" content="2016-07-25T11:29:29.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="【iOS】AVFoundation Programming Guide 官方文档-中文翻译-中英对照">
<meta name="twitter:description" content="版权声明：本文为博主原创翻译，如需转载请注明出处。
苹果源文档地址 - 点击这里

About AVFoundation - AVFoundation概述AVFoundation is one of several frameworks that you can use to play and create time-based audiovisual media. It provides an">
<meta name="twitter:image" content="http://ww3.sinaimg.cn/large/a9c4d5f6gw1f650lssb7bj20l80d5jsa.jpg">
<meta name="twitter:creator" content="@LuciferZhangyq">
<link rel="publisher" href="110295955443575724222">

    
    <link rel="alternative" href="/atom.xml" title="Mathematical Method, the Way of the World" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/faviconr.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.jpg" alt="Mathematical Method, the Way of the World" title="Mathematical Method, the Way of the World"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="Mathematical Method, the Way of the World">Mathematical Method, the Way of the World</a></h1>
				<h2 class="blog-motto">数学出身，功底扎实，热爱编程，虽然编程起步晚，但是冲劲十足。</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页 | Home</a></li>
					
						<li><a href="/index">索引 | Index</a></li>
					
						<li><a href="/archives">归档 | Archives</a></li>
					
						<li><a href="/about">关于 | About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:yoferzhang.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/post/20160724AVFoundation/" title="【iOS】AVFoundation Programming Guide 官方文档-中文翻译-中英对照" itemprop="url">【iOS】AVFoundation Programming Guide 官方文档-中文翻译-中英对照</a>
  </h1>
  <p class="article-author">By
       
		<a href="https://plus.google.com/110295955443575724222?rel=author" title="Yofer" target="_blank" itemprop="author">Yofer</a>
		
  <p class="article-time">
    <time datetime="2016-07-24T02:57:30.000Z" itemprop="datePublished"> 发表于 2016-07-24</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#About-AVFoundation-AVFoundation概述"><span class="toc-number">1.</span> <span class="toc-text">About AVFoundation - AVFoundation概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#At-a-Glance-摘要"><span class="toc-number">1.1.</span> <span class="toc-text">At a Glance - 摘要</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Representing-and-Using-Media-with-AVFoundation-用AVFoundation-表示和使用媒体"><span class="toc-number">1.1.1.</span> <span class="toc-text">Representing and Using Media with AVFoundation - 用AVFoundation 表示和使用媒体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Playback-播放"><span class="toc-number">1.1.2.</span> <span class="toc-text">Playback - 播放</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reading-Writing-and-Reencoding-Assets-读取，写入和重新编码Assets"><span class="toc-number">1.1.3.</span> <span class="toc-text">Reading, Writing, and Reencoding Assets - 读取，写入和重新编码Assets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Thumbnails-缩略图"><span class="toc-number">1.1.4.</span> <span class="toc-text">Thumbnails - 缩略图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Editing-编辑"><span class="toc-number">1.1.5.</span> <span class="toc-text">Editing - 编辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Still-and-Video-Media-Capture-静态和视频媒体捕获"><span class="toc-number">1.1.6.</span> <span class="toc-text">Still and Video Media Capture - 静态和视频媒体捕获</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Concurrent-Programming-with-AVFoundation-AVFoundation并发编程"><span class="toc-number">1.1.7.</span> <span class="toc-text">Concurrent Programming with AVFoundation - AVFoundation并发编程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Prerequisites-预备知识"><span class="toc-number">1.2.</span> <span class="toc-text">Prerequisites - 预备知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#See-Also-参考"><span class="toc-number">1.3.</span> <span class="toc-text">See Also - 参考</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Using-Assets-使用Assets"><span class="toc-number">2.</span> <span class="toc-text">Using Assets - 使用Assets</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-an-Asset-Object-创建一个Asset对象"><span class="toc-number">2.1.</span> <span class="toc-text">Creating an Asset Object - 创建一个Asset对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Options-for-Initializing-an-Asset-初始化一个Asset的选择"><span class="toc-number">2.1.1.</span> <span class="toc-text">Options for Initializing an Asset - 初始化一个Asset的选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Accessing-the-User’s-Assets-访问用户的Assets"><span class="toc-number">2.1.2.</span> <span class="toc-text">Accessing the User’s Assets - 访问用户的Assets</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preparing-an-Asset-for-Use-将-Asset-准备好使用"><span class="toc-number">2.2.</span> <span class="toc-text">Preparing an Asset for Use - 将 Asset 准备好使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-Still-Images-From-a-Video-从视频中获取静态图像"><span class="toc-number">2.3.</span> <span class="toc-text">Getting Still Images From a Video - 从视频中获取静态图像</span></a></li></ol></li></ol>
		
		</div>
		
		<blockquote>
<p>版权声明：本文为博主原创翻译，如需转载请注明出处。</p>
<p>苹果源文档地址 - <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40010188-CH1-SW3" target="_blank" rel="external">点击这里</a></p>
</blockquote>
<h1 id="About-AVFoundation-AVFoundation概述"><a href="#About-AVFoundation-AVFoundation概述" class="headerlink" title="About AVFoundation - AVFoundation概述"></a>About AVFoundation - AVFoundation概述</h1><p>AVFoundation is one of several frameworks that you can use to play and create time-based audiovisual media. It provides an Objective-C interface you use to work on a detailed level with time-based audiovisual data. For example, you can use it to examine, create, edit, or reencode media files. You can also get input streams from devices and manipulate video during realtime capture and playback. Figure I-1 shows the architecture on iOS.</p>
<p><code>AVFoundation</code> 是可以用它来播放和创建基于时间的视听媒体的几个框架之一。它提供了基于时间的视听数据的详细级别上的Objective-C接口。例如，你可以用它来检查，创建，编辑或重新编码媒体文件。您也可以从设备得到输入流和在实时捕捉回放过程中操控视频。图I-1显示了iOS上的架构。</p>
<center><br>    <img src="http://ww3.sinaimg.cn/large/a9c4d5f6gw1f650lssb7bj20l80d5jsa.jpg" alt="Figure I-1  AVFoundation stack on iOS"><br></center>

<center><br>    <img src="http://ww1.sinaimg.cn/large/a9c4d5f6gw1f651hbl7ohj20l80dg0ts.jpg" alt="Figure I-2  AVFoundation stack on OS X"><br></center>

<p>You should typically use the highest-level abstraction available that allows you to perform the tasks you want.</p>
<ul>
<li><p>If you simply want to play movies, use the AVKit framework.</p>
</li>
<li><p>On iOS, to record video when you need only minimal control over format, use the UIKit framework(<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIImagePickerController_Class/index.html#//apple_ref/occ/cl/UIImagePickerController" target="_blank" rel="external">UIImagePickerController</a>)</p>
</li>
</ul>
<p>Note, however, that some of the primitive data structures that you use in AV Foundation—including time-related data structures and opaque objects to carry and describe media data—are declared in the Core Media framework.</p>
<p>通常，您应该使用可用的最高级别的抽象接口，执行所需的任务。</p>
<ul>
<li><p>如果你只是想播放电影，使用 <code>AVKit</code> 框架。</p>
</li>
<li><p>在iOS上，当你在格式上只需要最少的控制，使用UIKit框架录制视频。(<a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIImagePickerController_Class/index.html#//apple_ref/occ/cl/UIImagePickerController" target="_blank" rel="external">UIImagePickerController</a>).</p>
</li>
</ul>
<p>但是请注意，某些在<code>AV Foundation</code> 中使用的原始数据结构，包括时间相关的数据结构和不透明数据对象的传递和描述媒体数据是在<code>Core Media framework</code>声明的。</p>
<h2 id="At-a-Glance-摘要"><a href="#At-a-Glance-摘要" class="headerlink" title="At a Glance - 摘要"></a>At a Glance - 摘要</h2><p>There are two facets to the AVFoundation framework—APIs related to video and APIs related just to audio. The older audio-related classes provide easy ways to deal with audio. They are described in the <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/MultimediaPG/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009767" target="_blank" rel="external">Multimedia Programming Guide</a>, not in this document.</p>
<ul>
<li><p>To play sound files, you can use <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAudioPlayerClassReference/index.html#//apple_ref/occ/cl/AVAudioPlayer" target="_blank" rel="external">AVAudioPlayer</a>.</p>
</li>
<li><p>To record audio, you can use <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAudioRecorder_ClassReference/index.html#//apple_ref/occ/cl/AVAudioRecorder" target="_blank" rel="external">AVAudioRecorder</a>.</p>
</li>
</ul>
<p>You can also configure the audio behavior of your application using <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAudioSession_ClassReference/index.html#//apple_ref/occ/cl/AVAudioSession" target="_blank" rel="external">AVAudioSession</a>; this is described in <a href="https://developer.apple.com/library/ios/documentation/Audio/Conceptual/AudioSessionProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40007875" target="_blank" rel="external">Audio Session Programming Guide</a>.</p>
<p>AVFoundation框架包含视频相关的APIs和音频相关的APIs。旧的音频相关类提供了简便的方法来处理音频。他们在<a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/MultimediaPG/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009767" target="_blank" rel="external">Multimedia Programming Guide</a>,中介绍，不在这个文档中。</p>
<ul>
<li><p>要播放声音文件，您可以使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAudioPlayerClassReference/index.html#//apple_ref/occ/cl/AVAudioPlayer" target="_blank" rel="external">AVAudioPlayer</a>。</p>
</li>
<li><p>要录制音频，您可以使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAudioRecorder_ClassReference/index.html#//apple_ref/occ/cl/AVAudioRecorder" target="_blank" rel="external">AVAudioRecorder</a>。</p>
</li>
</ul>
<p>您还可以使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAudioSession_ClassReference/index.html#//apple_ref/occ/cl/AVAudioSession" target="_blank" rel="external">AVAudioSession</a> 来配置应用程序的音频行为;这是在 <a href="https://developer.apple.com/library/ios/documentation/Audio/Conceptual/AudioSessionProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40007875" target="_blank" rel="external">Audio Session Programming Guide</a> 文档中介绍的。</p>
<h3 id="Representing-and-Using-Media-with-AVFoundation-用AVFoundation-表示和使用媒体"><a href="#Representing-and-Using-Media-with-AVFoundation-用AVFoundation-表示和使用媒体" class="headerlink" title="Representing and Using Media with AVFoundation - 用AVFoundation 表示和使用媒体"></a>Representing and Using Media with AVFoundation - 用AVFoundation 表示和使用媒体</h3><p>The primary class that the AV Foundation framework uses to represent media is <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsset_Class/index.html#//apple_ref/occ/cl/AVAsset" target="_blank" rel="external">AVAsset</a>. The design of the framework is largely guided by this representation. Understanding its structure will help you to understand how the framework works. An AVAssetinstance is an aggregated representation of a collection of one or more pieces of media data (audio and video tracks). It provides information about the collection as a whole, such as its title, duration, natural presentation size, and so on. AVAsset is not tied to particular data format. AVAsset is the superclass of other classes used to create asset instances from media at a URL (see <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/01_UsingAssets.html#//apple_ref/doc/uid/TP40010188-CH7-SW1" target="_blank" rel="external">Using Assets</a>) and to create new compositions (see <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40010188-CH1-SW1" target="_blank" rel="external">Editing</a>).</p>
<p><code>AV Foundation</code>框架用来表示媒体的主要类是 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsset_Class/index.html#//apple_ref/occ/cl/AVAsset" target="_blank" rel="external">AVAsset</a>。框架的设计主要是由这种表示引导。了解它的结构将有助于您了解该框架是如何工作的。一个 <code>AVAsset</code> 实例的媒体数据的一个或更多个（音频和视频轨道）的集合的聚集表示。它规定将有关集合的信息作为一个整体，如它的名称，时间，自然呈现大小等的信息。 <code>AVAsset</code> 是不依赖于特定的数据格式。 <code>AVAsset</code>是常常从URL中的媒体创建资产实例的这种类父类（请参阅 <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/01_UsingAssets.html#//apple_ref/doc/uid/TP40010188-CH7-SW1" target="_blank" rel="external">Using Assets</a>），并创造新的成分（见 <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40010188-CH1-SW1" target="_blank" rel="external">Editing</a>）。</p>
<p>Each of the individual pieces of media data in the asset is of a uniform type and called a track. In a typical simple case, one track represents the audio component, and another represents the video component; in a complex composition, however, there may be multiple overlapping tracks of audio and video. Assets may also have metadata.</p>
<p><code>Asset</code>中媒体数据的各个部分，每一个都是一个统一的类型，把这个类型称为“轨道”。在一个典型简单的情况下，一个轨道代表这个音频组件，另一个代表视频组件。然而复杂的组合中，有可能是多个重叠的音频和视频轨道。Assets也可能有元数据。</p>
<p>A vital concept in AV Foundation is that initializing an asset or a track does not necessarily mean that it is ready for use. It may require some time to calculate even the duration of an item (an MP3 file, for example, may not contain summary information). Rather than blocking the current thread while a value is being calculated, you ask for values and get an answer back asynchronously through a callback that you define using a block.</p>
<p>在 <code>AV Foundation</code> 中一个非常重要的概念是：初始化一个 <code>asset</code> 或者一个轨道并不一定意味着它已经准备好可以被使用。这可能需要一些时间来计算一个项目的持续时间（例如一个MP3文件，其中可能不包含摘要信息）。而不是当一个值被计算的时候阻塞当前线程，你访问这个值，并且通过调用你定义的一个 <code>block</code> 来得到异步返回。</p>
<p>Relevant Chapters: <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/01_UsingAssets.html#//apple_ref/doc/uid/TP40010188-CH7-SW1" target="_blank" rel="external">Using Assets</a>, <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/06_MediaRepresentations.html#//apple_ref/doc/uid/TP40010188-CH2-SW1" target="_blank" rel="external">Time and Media Representations</a></p>
<p>相关章节：<a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/01_UsingAssets.html#//apple_ref/doc/uid/TP40010188-CH7-SW1" target="_blank" rel="external">Using Assets</a>, <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/06_MediaRepresentations.html#//apple_ref/doc/uid/TP40010188-CH2-SW1" target="_blank" rel="external">Time and Media Representations</a></p>
<h3 id="Playback-播放"><a href="#Playback-播放" class="headerlink" title="Playback - 播放"></a>Playback - 播放</h3><p>AVFoundation allows you to manage the playback of asset in sophisticated ways. To support this, it separates the presentation state of an asset from the asset itself. This allows you to, for example, play two different segments of the same asset at the same time rendered at different resolutions. The presentation state for an asset is managed by a player item object; the presentation state for each track within an asset is managed by a player item track object. Using the player item and player item tracks you can, for example, set the size at which the visual portion of the item is presented by the player, set the audio mix parameters and video composition settings to be applied during playback, or disable components of the asset during playback.</p>
<p><code>AVFoundation</code>允许你用一种复杂的方式来管理<code>asset</code>的播放。为了支持这一点，它将一个<code>asset</code>的呈现状态从<code>asset</code>自身中分离出来。例如允许你在不同的分辨率下同时播放同一个<code>asset</code>中的两个不同的片段。一个<code>asset</code>的呈现状态是由<code>player item</code>对象管理的。<code>Asset</code>中的每个轨道的呈现状态是由<code>player item track</code>对象管理的。例如使用<code>player item</code>和<code>player item tracks</code>，你可以设置被播放器呈现的项目中可视的那一部分，设置音频的混合参数以及被应用于播放期间的视频组合设定，或者播放期间的禁用组件。</p>
<p>You play player items using a player object, and direct the output of a player to the Core Animation layer. You can use a player queue to schedule playback of a collection of player items in sequence.</p>
<p>你可以使用一个 <code>player</code> 对象来播放播放器项目，并且直接输出一个播放器给核心动画层。你可以使用一个 <code>player queue</code>（player对象的队列）去给队列中<code>player items</code>集合中的播放项目安排序列。</p>
<p>Relevant Chapter: <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/02_Playback.html#//apple_ref/doc/uid/TP40010188-CH3-SW1" target="_blank" rel="external">Playback</a></p>
<p>相关章节：<a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/02_Playback.html#//apple_ref/doc/uid/TP40010188-CH3-SW1" target="_blank" rel="external">Playback</a></p>
<h3 id="Reading-Writing-and-Reencoding-Assets-读取，写入和重新编码Assets"><a href="#Reading-Writing-and-Reencoding-Assets-读取，写入和重新编码Assets" class="headerlink" title="Reading, Writing, and Reencoding Assets - 读取，写入和重新编码Assets"></a>Reading, Writing, and Reencoding Assets - 读取，写入和重新编码Assets</h3><p>AVFoundation allows you to create new representations of an asset in several ways. You can simply reencode an existing asset, or—in iOS 4.1 and later—you can perform operations on the contents of an asset and save the result as a new asset.</p>
<p><code>AVFoundation</code> 允许你用几种方式创建新的 <code>asset</code> 的表现形式。你可以简单将已经存在的 <code>asset</code> 重新编码，或者在iOS4.1以及之后的版本中，你可以在一个 <code>asset</code> 的目录中执行一些操作并且将结果保存为一个新的 <code>asset</code> 。</p>
<p>You use an export session to reencode an existing asset into a format defined by one of a small number of commonly-used presets. If you need more control over the transformation, in iOS 4.1 and later you can use an asset reader and asset writer object in tandem to convert an asset from one representation to another. Using these objects you can, for example, choose which of the tracks you want to be represented in the output file, specify your own output format, or modify the asset during the conversion process.</p>
<p>你可以使用 <code>export session</code> 将一个现有的<code>asset</code>重新编码为一个小数字，这个小数字是常用的预先设定好的一些小数字中的一个。如果在转换中你需要更多的控制，在iOS4.1已经以后的版本中，你可以使用 <code>asset reader</code> 和 <code>asset writer</code> 对象串联的一个一个的转换。例如你可以使用这些对象选择在输出的文件中想要表示的轨道，指定你自己的输出格式，或者在转换过程中修改这个<code>asset</code>。</p>
<p>To produce a visual representation of the waveform, you use an asset reader to read the audio track of an asset.</p>
<p>为了产生波形的可视化表示，你可以使用<code>asset reader</code>去读取<code>asset</code>中的音频轨道。</p>
<p>Relevant Chapter: <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/01_UsingAssets.html#//apple_ref/doc/uid/TP40010188-CH7-SW1" target="_blank" rel="external">Using Assets</a></p>
<p>相关章节：<a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/01_UsingAssets.html#//apple_ref/doc/uid/TP40010188-CH7-SW1" target="_blank" rel="external">Using Assets</a></p>
<h3 id="Thumbnails-缩略图"><a href="#Thumbnails-缩略图" class="headerlink" title="Thumbnails - 缩略图"></a>Thumbnails - 缩略图</h3><p>To create thumbnail images of video presentations, you initialize an instance of <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetImageGenerator_Class/index.html#//apple_ref/occ/cl/AVAssetImageGenerator" target="_blank" rel="external">AVAssetImageGenerator</a> using the asset from which you want to generate thumbnails. AVAssetImageGenerator uses the default enabled video tracks to generate images.</p>
<p>创建视频演示图像的缩略图，使用想要生成缩略图的<code>asset</code>初始化一个 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAssetImageGenerator_Class/index.html#//apple_ref/occ/cl/AVAssetImageGenerator" target="_blank" rel="external">AVAssetImageGenerator</a> 的实例。<code>AVAssetImageGenerator</code> 使用默认启用视频轨道来生成图像。</p>
<p>Relevant Chapter: <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/01_UsingAssets.html#//apple_ref/doc/uid/TP40010188-CH7-SW1" target="_blank" rel="external">Using Assets</a></p>
<p>相关章节：<a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/01_UsingAssets.html#//apple_ref/doc/uid/TP40010188-CH7-SW1" target="_blank" rel="external">Using Assets</a></p>
<h3 id="Editing-编辑"><a href="#Editing-编辑" class="headerlink" title="Editing - 编辑"></a>Editing - 编辑</h3><p>AVFoundation uses compositions to create new assets from existing pieces of media (typically, one or more video and audio tracks). You use a mutable composition to add and remove tracks, and adjust their temporal orderings. You can also set the relative volumes and ramping of audio tracks; and set the opacity, and opacity ramps, of video tracks. A composition is an assemblage of pieces of media held in memory. When you export a composition using an export session, it’s collapsed to a file.</p>
<p><code>AVFoundation</code> 使用 <code>compositions</code> 去从现有的媒体片段（通常是一个或多个视频和音频轨道）创建新的 <code>assets</code> 。你可以使用一个可变成分去添加和删除轨道，并调整它们的时间排序。你也可以设置相对音量和增加音频轨道；并且设置不透明度，浑浊坡道，视频跟踪。一种组合物，是一种在内存中存储的介质的组合。当年你使用 <code>export session</code> 导出一个成份，它会坍塌到一个文件中。</p>
<p>You can also create an asset from media such as sample buffers or still images using an asset writer.</p>
<p>你也可以从媒体上创建一个<code>asset</code>，比如使用<code>asset writer</code>.的示例缓冲区或静态图像。</p>
<p>Relevant Chapter: <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/03_Editing.html#//apple_ref/doc/uid/TP40010188-CH8-SW1" target="_blank" rel="external">Editing</a></p>
<p>相关章节：<a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/03_Editing.html#//apple_ref/doc/uid/TP40010188-CH8-SW1" target="_blank" rel="external">Editing</a></p>
<h3 id="Still-and-Video-Media-Capture-静态和视频媒体捕获"><a href="#Still-and-Video-Media-Capture-静态和视频媒体捕获" class="headerlink" title="Still and Video Media Capture - 静态和视频媒体捕获"></a>Still and Video Media Capture - 静态和视频媒体捕获</h3><p>Recording input from cameras and microphones is managed by a capture session. A capture session coordinates the flow of data from input devices to outputs such as a movie file. You can configure multiple inputs and outputs for a single session, even when the session is running. You send messages to the session to start and stop data flow.</p>
<p>从相机和麦克风记录输入是由一个 <code>capture session</code> 管理的。一个 <code>capture session</code> 协调从输入设备到输出的数据流，比如一个电影文件。你可以为一个单一的 <code>session</code> 配置多个输入和输出，甚至 <code>session</code> 正在运行的时候也可以。你将消息发送到 <code>session</code> 去启动和停止数据流。</p>
<p>In addition, you can use an instance of a preview layer to show the user what a camera is recording.</p>
<p>此外，你可以使用 <code>preview layer</code> 的一个实例来向用户显示一个相机是正在录制的。</p>
<p>Relevant Chapter: <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/04_MediaCapture.html#//apple_ref/doc/uid/TP40010188-CH5-SW2" target="_blank" rel="external">Still and Video Media Capture</a></p>
<p>相关章节：<a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/04_MediaCapture.html#//apple_ref/doc/uid/TP40010188-CH5-SW2" target="_blank" rel="external">Still and Video Media Capture</a></p>
<h3 id="Concurrent-Programming-with-AVFoundation-AVFoundation并发编程"><a href="#Concurrent-Programming-with-AVFoundation-AVFoundation并发编程" class="headerlink" title="Concurrent Programming with AVFoundation - AVFoundation并发编程"></a>Concurrent Programming with AVFoundation - AVFoundation并发编程</h3><p>Callbacks from AVFoundation—invocations of blocks, key-value observers, and notification handlers—are not guaranteed to be made on any particular thread or queue. Instead, AVFoundation invokes these handlers on threads or queues on which it performs its internal tasks.</p>
<p>从 <code>AVFoundation</code> 回调，比如块的调用、键值观察者以及通知处理程序，都不能保证在任何特定的线程或队列进行。相反，<code>AVFoundation</code> 在线程或者执行其内部任务的队列上调用这些处理程序。</p>
<p>There are two general guidelines as far as notifications and threading:</p>
<ul>
<li>UI related notifications occur on the main thread.</li>
<li>Classes or methods that require you create and/or specify a queue will return notifications on that queue.</li>
</ul>
<p>Beyond those two guidelines (and there are exceptions, which are noted in the reference documentation) you should not assume that a notification will be returned on any specific thread.</p>
<p>下面是两个有关通知和线程的准则</p>
<ul>
<li>在主线程上发生的与用户界面相关的通知。</li>
<li>需要创建并且/或者 指定一个队列的类或者方法将返回该队列的通知。</li>
</ul>
<p>除了这两个准则（当然是有一些例外，在参考文档中会被指出），你不应该假设一个通知将在任何特定的线程返回。</p>
<p>If you’re writing a multithreaded application, you can use the NSThread method <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSThread_Class/index.html#//apple_ref/occ/instm/NSThread/isMainThread" target="_blank" rel="external">isMainThread</a> or <code>[[NSThread currentThread] isEqual:&lt;#A stored thread reference#&gt;]</code> to test whether the invocation thread is a thread you expect to perform your work on. You can redirect messages to appropriate threads using methods such as <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/index.html#//apple_ref/occ/instm/NSObject/performSelectorOnMainThread:withObject:waitUntilDone:" target="_blank" rel="external">performSelectorOnMainThread:withObject:waitUntilDone:</a> and <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/index.html#//apple_ref/occ/instm/NSObject/performSelector:onThread:withObject:waitUntilDone:modes:" target="_blank" rel="external">performSelector:onThread:withObject:waitUntilDone:modes:</a>. You could also use <a href="https://developer.apple.com/library/ios/documentation/Performance/Reference/GCD_libdispatch_Ref/index.html#//apple_ref/c/func/dispatch_async" target="_blank" rel="external">dispatch_async</a> to “bounce” to your blocks on an appropriate queue, either the main queue for UI tasks or a queue you have up for concurrent operations. For more about concurrent operations, see <a href="https://developer.apple.com/library/ios/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008091" target="_blank" rel="external">Concurrency Programming Guide</a>; for more about blocks, see <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/Blocks/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40007502" target="_blank" rel="external">Blocks Programming Topics</a>. The <a href="https://developer.apple.com/library/ios/samplecode/AVCam/Introduction/Intro.html#//apple_ref/doc/uid/DTS40010112" target="_blank" rel="external">AVCam-iOS: Using AVFoundation to Capture Images and Movies</a> sample code is considered the primary example for all AVFoundation functionality and can be consulted for examples of thread and queue usage with AVFoundation.</p>
<p>如果你在写一个多线程的应用程序，你可以使用 <code>NSThread</code>  方法 <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSThread_Class/index.html#//apple_ref/occ/instm/NSThread/isMainThread" target="_blank" rel="external">isMainThread</a> 或者 <code>[[NSThread currentThread] isEqual:&lt;#A stored thread reference#&gt;]</code> 去测试是否调用了你期望执行你任务的线程。你可以使用方法重定向 消息给适合的线程，比如 <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/index.html#//apple_ref/occ/instm/NSObject/performSelectorOnMainThread:withObject:waitUntilDone:" target="_blank" rel="external">performSelectorOnMainThread:withObject:waitUntilDone:</a> 以及  <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSObject_Class/index.html#//apple_ref/occ/instm/NSObject/performSelector:onThread:withObject:waitUntilDone:modes:" target="_blank" rel="external">performSelector:onThread:withObject:waitUntilDone:modes:</a>.你也可以使用 <a href="https://developer.apple.com/library/ios/documentation/Performance/Reference/GCD_libdispatch_Ref/index.html#//apple_ref/c/func/dispatch_async" target="_blank" rel="external">dispatch_async</a>弹回到适当队列的 <code>blocks</code> 中，无论是在主界面的任务队列还是有了并发操作的队列。更多关于并行操作，请查看 <a href="https://developer.apple.com/library/ios/documentation/General/Conceptual/ConcurrencyProgrammingGuide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40008091" target="_blank" rel="external">Concurrency Programming Guide</a>；更多关于块，请查看 <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/Blocks/Articles/00_Introduction.html#//apple_ref/doc/uid/TP40007502" target="_blank" rel="external">Blocks Programming Topics</a>.  <a href="https://developer.apple.com/library/ios/samplecode/AVCam/Introduction/Intro.html#//apple_ref/doc/uid/DTS40010112" target="_blank" rel="external">AVCam-iOS: Using AVFoundation to Capture Images and Movies</a> 示例代码是所有 <code>AVFoundation</code>  功能最主要的例子，可以对线程和队列使用 <code>AVFoundation</code> 实例参考。</p>
<h2 id="Prerequisites-预备知识"><a href="#Prerequisites-预备知识" class="headerlink" title="Prerequisites - 预备知识"></a>Prerequisites - 预备知识</h2><p>AVFoundation is an advanced Cocoa framework. To use it effectively, you must have:</p>
<ul>
<li>A solid understanding of fundamental Cocoa development tools and techniques</li>
<li>A basic grasp of blocks</li>
<li>A basic understanding of key-value coding and key-value observing</li>
<li>For playback, a basic understanding of Core Animation (see <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514" target="_blank" rel="external">Core Animation Programming Guide</a> or, for basic playback, the <a href="https://developer.apple.com/library/ios/documentation/AVKit/Reference/AVKitFramework/index.html#//apple_ref/doc/uid/TP40013178" target="_blank" rel="external">AVKit Framework Reference</a>.</li>
</ul>
<p><code>AVFoundation</code> 是一种先进的 <code>Cocoa</code> 框架，为了有效的使用，你必须掌握下面的知识：</p>
<ul>
<li>扎实的了解基本的 <code>Cocoa</code> 开发工具和框架</li>
<li>对块有基本的了解</li>
<li>了解基本的键值编码(<code>key-value coding</code>)和键值观察（<code>key-value observing</code>）</li>
<li>对于播放，对核心动画的基本理解 (see <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/CoreAnimation_guide/Introduction/Introduction.html#//apple_ref/doc/uid/TP40004514" target="_blank" rel="external">Core Animation Programming Guide</a> )或者,对于基本播放, 请看 <a href="https://developer.apple.com/library/ios/documentation/AVKit/Reference/AVKitFramework/index.html#//apple_ref/doc/uid/TP40013178" target="_blank" rel="external">AVKit Framework Reference</a>.</li>
</ul>
<h2 id="See-Also-参考"><a href="#See-Also-参考" class="headerlink" title="See Also - 参考"></a>See Also - 参考</h2><p>There are several AVFoundation examples including two that are key to understanding and implementation Camera capture functionality:</p>
<ul>
<li><a href="https://developer.apple.com/library/ios/samplecode/AVCam/Introduction/Intro.html#//apple_ref/doc/uid/DTS40010112" target="_blank" rel="external">AVCam-iOS: Using AVFoundation to Capture Images and Movies</a> is the canonical sample code for implementing any program that uses the camera functionality. It is a complete sample, well documented, and covers the majority of the functionality showing the best practices.</li>
<li><a href="https://developer.apple.com/library/ios/samplecode/AVCamManual/Introduction/Intro.html#//apple_ref/doc/uid/TP40014578" target="_blank" rel="external">AVCamManual: Extending AVCam to Use Manual Capture API</a> is the companion application to AVCam. It implements Camera functionality using the manual camera controls. It is also a complete example, well documented, and should be considered the canonical example for creating camera applications that take advantage of manual controls.</li>
<li><a href="https://developer.apple.com/library/ios/samplecode/RosyWriter/Introduction/Intro.html#//apple_ref/doc/uid/DTS40011110" target="_blank" rel="external">RosyWriter</a> is an example that demonstrates real time frame processing and in particular how to apply filters to video content. This is a very common developer requirement and this example covers that functionality.</li>
<li>AVLocationPlayer: Using AVFoundation Metadata Reading APIs demonstrates using the metadata APIs.</li>
</ul>
<p>有几个 <code>AVFoundation</code> 的例子，包括两个理解和实现摄像头捕捉功能的关键点：</p>
<ul>
<li><a href="https://developer.apple.com/library/ios/samplecode/AVCam/Introduction/Intro.html#//apple_ref/doc/uid/DTS40010112" target="_blank" rel="external">AVCam-iOS: Using AVFoundation to Capture Images and Movies</a> 是实现任何想使用摄像头功能的程序的典型示例代码。它是一个完整的样本，以及记录，并涵盖了大部分主要的功能。</li>
<li><a href="https://developer.apple.com/library/ios/samplecode/AVCamManual/Introduction/Intro.html#//apple_ref/doc/uid/TP40014578" target="_blank" rel="external">AVCamManual: Extending AVCam to Use Manual Capture API</a> 是AVCam相对应的应用程序。它使用手动相机控制实现相机功能。它也是一个完成的例子，以及记录，并且应该被视为利用手动控制创建相机应用程序的典型例子。</li>
<li><a href="https://developer.apple.com/library/ios/samplecode/RosyWriter/Introduction/Intro.html#//apple_ref/doc/uid/DTS40011110" target="_blank" rel="external">RosyWriter</a> 是一个演示实时帧处理的例子，特别是如果过滤器应用到视频内容。这是一个非常普遍的开发人员的需求，这个例子涵盖了这个功能。</li>
<li><code>AVLocationPlayer</code>: 使用 <code>AVFoundation Metadata Reading APIs</code> 演示使用 <code>the metadata APIs</code>.</li>
</ul>
<h1 id="Using-Assets-使用Assets"><a href="#Using-Assets-使用Assets" class="headerlink" title="Using Assets - 使用Assets"></a>Using Assets - 使用Assets</h1><p>Assets can come from a file or from media in the user’s iPod library or Photo library. When you create an asset object all the information that you might want to retrieve for that item is not immediately available. Once you have a movie asset, you can extract still images from it, transcode it to another format, or trim the contents.</p>
<p><code>Assets</code> 可以来自文件或者媒体用户的iPod库、图片库。当你创建一个 <code>asset</code> 对象时，所有你可能想要检索该项目的信息不是立即可用的。一旦你有了一个电影 <code>asset</code> ，你可以从里面提取静态图像，转换到另一个格式，或者对内容就行修剪。</p>
<h2 id="Creating-an-Asset-Object-创建一个Asset对象"><a href="#Creating-an-Asset-Object-创建一个Asset对象" class="headerlink" title="Creating an Asset Object - 创建一个Asset对象"></a>Creating an Asset Object - 创建一个Asset对象</h2><p>To create an asset to represent any resource that you can identify using a URL, you use <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVURLAsset_Class/index.html#//apple_ref/occ/cl/AVURLAsset" target="_blank" rel="external">AVURLAsset</a>. The simplest case is creating an asset from a file:</p>
<p>为了创建一个 <code>asset</code> ，去代表任何你能用一个 <code>URL</code> 识别的资源，你可以使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVURLAsset_Class/index.html#//apple_ref/occ/cl/AVURLAsset" target="_blank" rel="external">AVURLAsset</a> .最简单的情况是从一个文件创建一个 <code>asset</code> 。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url = &lt;<span class="meta">#A URL that identifies an audiovisual asset such as a movie file#&gt;;</span></span><br><span class="line"><span class="built_in">AVURLAsset</span> *anAsset = [[<span class="built_in">AVURLAsset</span> alloc] initWithURL:url options:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<h3 id="Options-for-Initializing-an-Asset-初始化一个Asset的选择"><a href="#Options-for-Initializing-an-Asset-初始化一个Asset的选择" class="headerlink" title="Options for Initializing an Asset - 初始化一个Asset的选择"></a>Options for Initializing an Asset - 初始化一个Asset的选择</h3><p>The AVURLAsset initialization methods take as their second argument an options dictionary. The only key used in the dictionary is <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVURLAsset_Class/index.html#//apple_ref/c/data/AVURLAssetPreferPreciseDurationAndTimingKey" target="_blank" rel="external">AVURLAssetPreferPreciseDurationAndTimingKey</a>. The corresponding value is a Boolean (contained in an NSValue object) that indicates whether the asset should be prepared to indicate a precise duration and provide precise random access by time.</p>
<p><code>AVURLAsset</code> 初始化方法作为它们的第二个参数选项字典。本字典中唯一被使用的 <code>key</code> 是 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVURLAsset_Class/index.html#//apple_ref/c/data/AVURLAssetPreferPreciseDurationAndTimingKey" target="_blank" rel="external">AVURLAssetPreferPreciseDurationAndTimingKey</a>. 相应的值是一个布尔值（包含在一个 <code>NSValue</code> 对象中），这个布尔值指出是否该 <code>asset</code> 应该准备标出一个精确的时间和提供一个以时间为种子的随机存取。</p>
<p>Getting the exact duration of an asset may require significant processing overhead. Using an approximate duration is typically a cheaper operation and sufficient for playback. Thus:</p>
<ul>
<li>If you only intend to play the asset, either pass nil instead of a dictionary, or pass a dictionary that contains the AVURLAssetPreferPreciseDurationAndTimingKey key and a corresponding value of NO (contained in an NSValue object).</li>
<li>If you want to add the asset to a composition (<a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVMutableComposition_Class/index.html#//apple_ref/occ/cl/AVMutableComposition" target="_blank" rel="external">AVMutableComposition</a>), you typically need precise random access. Pass a dictionary that contains theAVURLAssetPreferPreciseDurationAndTimingKey key and a corresponding value of YES (contained in an NSValue object—recall that NSNumberinherits from NSValue):</li>
</ul>
<p>获得一个asset的确切持续时间可能需要大量的处理开销。使用一个近似的持续时间通常是一个更便宜的操作并且对于播放已经足够了。因此：</p>
<ul>
<li>如果你只打算播放这个 <code>asset</code>， 要么传递一个 <code>nil</code> 代替 <code>dictionary</code> ，或者传递一个字典，这个字典包含 <code>AVURLAssetPreferPreciseDurationAndTimingKey</code> 的 <code>key</code>和相应 <code>NO</code>(包含在一个 <code>NSValue</code> 对象) 的值。</li>
<li>如果你想要把 <code>asset</code> 添加给一个 <code>composition</code> (<a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVMutableComposition_Class/index.html#//apple_ref/occ/cl/AVMutableComposition" target="_blank" rel="external">AVMutableComposition</a>), 通常你需要精确的随机存取。传递一个字典（这个字典包含 <code>AVURLAssetPreferPreciseDurationAndTimingKey</code> key） 和一个相应的 <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/ObjCRuntimeRef/index.html#//apple_ref/doc/c_ref/YES" target="_blank" rel="external">YES</a> 的值（YES 包含在一个 <code>NSValue</code> 对象中，回忆一下继承自 <code>NSValue</code>的 <a href="https://developer.apple.com/library/ios/documentation/Cocoa/Reference/Foundation/Classes/NSNumber_Class/index.html#//apple_ref/occ/cl/NSNumber" target="_blank" rel="external">NSNmuber</a>）</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url = &lt;<span class="meta">#A URL that identifies an audiovisual asset such as a movie file#&gt;;</span></span><br><span class="line"><span class="built_in">NSDictionary</span> *options = @&#123; <span class="built_in">AVURLAssetPreferPreciseDurationAndTimingKey</span> : @YES &#125;;</span><br><span class="line"><span class="built_in">AVURLAsset</span> *anAssetToUseInAComposition = [[<span class="built_in">AVURLAsset</span> alloc] initWithURL:url options:options];</span><br></pre></td></tr></table></figure>
<h3 id="Accessing-the-User’s-Assets-访问用户的Assets"><a href="#Accessing-the-User’s-Assets-访问用户的Assets" class="headerlink" title="Accessing the User’s Assets - 访问用户的Assets"></a>Accessing the User’s Assets - 访问用户的<code>Assets</code></h3><p>To access the assets managed by the iPod library or by the Photos application, you need to get a URL of the asset you want.</p>
<ul>
<li>To access the iPod Library, you create an <a href="https://developer.apple.com/library/ios/documentation/MediaPlayer/Reference/MPMediaQuery_ClassReference/index.html#//apple_ref/occ/cl/MPMediaQuery" target="_blank" rel="external">MPMediaQuery</a> instance to find the item you want, then get its URL using <a href="https://developer.apple.com/library/ios/documentation/MediaPlayer/Reference/MPMediaItem_ClassReference/index.html#//apple_ref/c/data/MPMediaItemPropertyAssetURL" target="_blank" rel="external">MPMediaItemPropertyAssetURL</a>.For more about the Media Library, see Multimedia Programming Guide.</li>
<li>To access the assets managed by the Photos application, you use <a href="https://developer.apple.com/library/ios/documentation/AssetsLibrary/Reference/ALAssetsLibrary_Class/index.html#//apple_ref/occ/cl/ALAssetsLibrary" target="_blank" rel="external">ALAssetsLibrary</a>.</li>
</ul>
<p>The following example shows how you can get an asset to represent the first video in the Saved Photos Album.</p>
<p>为了访问由 iPod 库或者照片应用程序管理的 <code>assets</code> ，你需要得到你想要 <code>asset</code> 的一个 <code>URL</code>。</p>
<ul>
<li>为了访问 iPod 库，创建一个 <a href="https://developer.apple.com/library/ios/documentation/MediaPlayer/Reference/MPMediaQuery_ClassReference/index.html#//apple_ref/occ/cl/MPMediaQuery" target="_blank" rel="external">MPMediaQuery</a> 实例去找到你想要的项目，然后使用<a href="https://developer.apple.com/library/ios/documentation/MediaPlayer/Reference/MPMediaItem_ClassReference/index.html#//apple_ref/c/data/MPMediaItemPropertyAssetURL" target="_blank" rel="external">MPMediaItemPropertyAssetURL</a>得到它的 <code>URL</code> ，</li>
<li>为了访问有照片应用程序管理的 <code>assets</code> ，可以使用 <a href="https://developer.apple.com/library/ios/documentation/AssetsLibrary/Reference/ALAssetsLibrary_Class/index.html#//apple_ref/occ/cl/ALAssetsLibrary" target="_blank" rel="external">ALAssetsLibrary</a>。</li>
</ul>
<p>下面的例子展示了如何获得一个 <code>asset</code> 来保存照片相册中的第一个视频。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">ALAssetsLibrary *library = [[ALAssetsLibrary alloc] init];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Enumerate just the photos and videos group by using ALAssetsGroupSavedPhotos.</span></span><br><span class="line">[library enumerateGroupsWithTypes:ALAssetsGroupSavedPhotos usingBlock:^(ALAssetsGroup *group, <span class="built_in">BOOL</span> *stop) &#123;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Within the group enumeration block, filter to enumerate just videos.</span></span><br><span class="line">[group setAssetsFilter:[ALAssetsFilter allVideos]];</span><br><span class="line"> </span><br><span class="line"><span class="comment">// For this example, we're only interested in the first item.</span></span><br><span class="line">[group enumerateAssetsAtIndexes:[<span class="built_in">NSIndexSet</span> indexSetWithIndex:<span class="number">0</span>]</span><br><span class="line">                        options:<span class="number">0</span></span><br><span class="line">                     usingBlock:^(ALAsset *alAsset, <span class="built_in">NSUInteger</span> index, <span class="built_in">BOOL</span> *innerStop) &#123;</span><br><span class="line"> </span><br><span class="line">                         <span class="comment">// The end of the enumeration is signaled by asset == nil.</span></span><br><span class="line">                         <span class="keyword">if</span> (alAsset) &#123;</span><br><span class="line">                             ALAssetRepresentation *representation = [alAsset defaultRepresentation];</span><br><span class="line">                             <span class="built_in">NSURL</span> *url = [representation url];</span><br><span class="line">                             <span class="built_in">AVAsset</span> *avAsset = [<span class="built_in">AVURLAsset</span> URLAssetWithURL:url options:<span class="literal">nil</span>];</span><br><span class="line">                             <span class="comment">// Do something interesting with the AV asset.</span></span><br><span class="line">                         &#125;</span><br><span class="line">                     &#125;];</span><br><span class="line">                 &#125;</span><br><span class="line">                 failureBlock: ^(<span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">                     <span class="comment">// Typically you should handle an error more gracefully than this.</span></span><br><span class="line">                     <span class="built_in">NSLog</span>(<span class="string">@"No groups"</span>);</span><br><span class="line">                 &#125;];</span><br></pre></td></tr></table></figure>
<h2 id="Preparing-an-Asset-for-Use-将-Asset-准备好使用"><a href="#Preparing-an-Asset-for-Use-将-Asset-准备好使用" class="headerlink" title="Preparing an Asset for Use - 将 Asset 准备好使用"></a>Preparing an Asset for Use - 将 <code>Asset</code> 准备好使用</h2><p>Initializing an asset (or track) does not necessarily mean that all the information that you might want to retrieve for that item is immediately available. It may require some time to calculate even the duration of an item (an MP3 file, for example, may not contain summary information). Rather than blocking the current thread while a value is being calculated, you should use the <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intf/AVAsynchronousKeyValueLoading" target="_blank" rel="external">AVAsynchronousKeyValueLoading</a>  protocol to ask for values and get an answer back later through a completion handler you define using a block. (AVAsset and AVAssetTrack conform to the AVAsynchronousKeyValueLoading protocol.)</p>
<p>初始化一个 <code>asset</code> （或者轨道）并不意味着你可能想要检索该项的所有信息是立即可用的。这可能需要一些时间来计算一个项目的持续时间（例如一个 MP3 文件可能不包含摘要信息）。当一个值被计算的时候不应该阻塞当前线程，你应该使用<a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intf/AVAsynchronousKeyValueLoading" target="_blank" rel="external">AVAsynchronousKeyValueLoading</a> 协议去请求值，通过完成处理你定义使用的一个 <code>block</code> 后得到答复。(<code>AVAsset</code> and <code>AVAssetTrack</code> 遵循 <code>AVAsynchronousKeyValueLoading</code> 协议.)</p>
<p>You test whether a value is loaded for a property using <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intfm/AVAsynchronousKeyValueLoading/statusOfValueForKey:error:" target="_blank" rel="external">statusOfValueForKey:error:</a>. When an asset is first loaded, the value of most or all of its properties is <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/c/econst/AVKeyValueStatusUnknown" target="_blank" rel="external">AVKeyValueStatusUnknown</a>. To load a value for one or more properties, you invoke <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intfm/AVAsynchronousKeyValueLoading/loadValuesAsynchronouslyForKeys:completionHandler:" target="_blank" rel="external">loadValuesAsynchronouslyForKeys:completionHandler:</a>. In the completion handler, you take whatever action is appropriate depending on the property’s status. You should always be prepared for loading to not complete successfully, either because it failed for some reason such as a network-based URL being inaccessible, or because the load was canceled.</p>
<p>测试一个值是否是使用 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intfm/AVAsynchronousKeyValueLoading/statusOfValueForKey:error:" target="_blank" rel="external">statusOfValueForKey:error:</a> 加载为一个属性。当 <code>asset</code> 被首次加载时，大部分的或全部属性值是 <a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/c/econst/AVKeyValueStatusUnknown" target="_blank" rel="external">AVKeyValueStatusUnknown</a>。为一个或多个属性加载一个值，调用<a href="https://developer.apple.com/library/ios/documentation/AVFoundation/Reference/AVAsynchronousKeyValueLoading_Protocol/index.html#//apple_ref/occ/intfm/AVAsynchronousKeyValueLoading/loadValuesAsynchronouslyForKeys:completionHandler:" target="_blank" rel="external">loadValuesAsynchronouslyForKeys:completionHandler:</a>。在完成处理程序中，你采取的行动是否恰当，取决于属性的状态。你应该总是准备加载不会完全成功，它可能有一些原因，比如基于网络的 <code>URL</code>是无法访问的，或者因为负载被取消。</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url = &lt;<span class="meta">#A URL that identifies an audiovisual asset such as a movie file#&gt;;</span></span><br><span class="line"><span class="built_in">AVURLAsset</span> *anAsset = [[<span class="built_in">AVURLAsset</span> alloc] initWithURL:url options:<span class="literal">nil</span>];</span><br><span class="line"><span class="built_in">NSArray</span> *keys = @[<span class="string">@"duration"</span>];</span><br><span class="line"> </span><br><span class="line">[asset loadValuesAsynchronouslyForKeys:keys completionHandler:^() &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">NSError</span> *error = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">AVKeyValueStatus</span> tracksStatus = [asset statusOfValueForKey:<span class="string">@"duration"</span> error:&amp;error];</span><br><span class="line">    <span class="keyword">switch</span> (tracksStatus) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">AVKeyValueStatusLoaded</span>:</span><br><span class="line">            [<span class="keyword">self</span> updateUserInterfaceForDuration];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">AVKeyValueStatusFailed</span>:</span><br><span class="line">            [<span class="keyword">self</span> reportError:error forAsset:asset];</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="built_in">AVKeyValueStatusCancelled</span>:</span><br><span class="line">            <span class="comment">// Do whatever is appropriate for cancelation.</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></figure>
<p>If you want to prepare an asset for playback, you should load its tracks property. For more about playing assets, see Playback.</p>
<p>如果你想准备一个 <code>asset</code> 去播放，你应该加载它的轨道属性。更多有关播放 <code>assets</code>，请看 <a href="https://developer.apple.com/library/ios/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/02_Playback.html#//apple_ref/doc/uid/TP40010188-CH3-SW1" target="_blank" rel="external">Playback</a></p>
<h2 id="Getting-Still-Images-From-a-Video-从视频中获取静态图像"><a href="#Getting-Still-Images-From-a-Video-从视频中获取静态图像" class="headerlink" title="Getting Still Images From a Video - 从视频中获取静态图像"></a>Getting Still Images From a Video - 从视频中获取静态图像</h2><p>To get still images such as thumbnails from an asset for playback, you use an AVAssetImageGenerator object. You initialize an image generator with your asset. Initialization may succeed, though, even if the asset possesses no visual tracks at the time of initialization, so if necessary you should test whether the asset has any tracks with the visual characteristic using tracksWithMediaCharacteristic:.</p>
<p>为了从一个准备播放的 <code>asset</code> 中得到静态图像，比如缩略图，可以使用</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/iOS/">iOS</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoferzhang.com/post/20160724AVFoundation/" data-title="【iOS】AVFoundation Programming Guide 官方文档-中文翻译-中英对照 | Mathematical Method, the Way of the World" data-tsina="2848249334" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/post/20160426Matchismo/"  title="【iOS】Stanford iOS7 Assignment - Matchismo">
 <strong>下一篇：</strong><br/> 
 <span>【iOS】Stanford iOS7 Assignment - Matchismo
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="post/20160724AVFoundation/" data-title="【iOS】AVFoundation Programming Guide 官方文档-中文翻译-中英对照" data-url="http://yoferzhang.com/post/20160724AVFoundation/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#About-AVFoundation-AVFoundation概述"><span class="toc-number">1.</span> <span class="toc-text">About AVFoundation - AVFoundation概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#At-a-Glance-摘要"><span class="toc-number">1.1.</span> <span class="toc-text">At a Glance - 摘要</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Representing-and-Using-Media-with-AVFoundation-用AVFoundation-表示和使用媒体"><span class="toc-number">1.1.1.</span> <span class="toc-text">Representing and Using Media with AVFoundation - 用AVFoundation 表示和使用媒体</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Playback-播放"><span class="toc-number">1.1.2.</span> <span class="toc-text">Playback - 播放</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reading-Writing-and-Reencoding-Assets-读取，写入和重新编码Assets"><span class="toc-number">1.1.3.</span> <span class="toc-text">Reading, Writing, and Reencoding Assets - 读取，写入和重新编码Assets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Thumbnails-缩略图"><span class="toc-number">1.1.4.</span> <span class="toc-text">Thumbnails - 缩略图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Editing-编辑"><span class="toc-number">1.1.5.</span> <span class="toc-text">Editing - 编辑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Still-and-Video-Media-Capture-静态和视频媒体捕获"><span class="toc-number">1.1.6.</span> <span class="toc-text">Still and Video Media Capture - 静态和视频媒体捕获</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Concurrent-Programming-with-AVFoundation-AVFoundation并发编程"><span class="toc-number">1.1.7.</span> <span class="toc-text">Concurrent Programming with AVFoundation - AVFoundation并发编程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Prerequisites-预备知识"><span class="toc-number">1.2.</span> <span class="toc-text">Prerequisites - 预备知识</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#See-Also-参考"><span class="toc-number">1.3.</span> <span class="toc-text">See Also - 参考</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Using-Assets-使用Assets"><span class="toc-number">2.</span> <span class="toc-text">Using Assets - 使用Assets</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Creating-an-Asset-Object-创建一个Asset对象"><span class="toc-number">2.1.</span> <span class="toc-text">Creating an Asset Object - 创建一个Asset对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Options-for-Initializing-an-Asset-初始化一个Asset的选择"><span class="toc-number">2.1.1.</span> <span class="toc-text">Options for Initializing an Asset - 初始化一个Asset的选择</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Accessing-the-User’s-Assets-访问用户的Assets"><span class="toc-number">2.1.2.</span> <span class="toc-text">Accessing the User’s Assets - 访问用户的Assets</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Preparing-an-Asset-for-Use-将-Asset-准备好使用"><span class="toc-number">2.2.</span> <span class="toc-text">Preparing an Asset for Use - 将 Asset 准备好使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Getting-Still-Images-From-a-Video-从视频中获取静态图像"><span class="toc-number">2.3.</span> <span class="toc-text">Getting Still Images From a Video - 从视频中获取静态图像</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="yoferzhang" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/C/" title="C++">C++<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/C语言/" title="C语言">C语言<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/iOS/" title="iOS">iOS<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/建立博客/" title="建立博客">建立博客<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/快速记忆/" title="快速记忆">快速记忆<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/渔/" title="渔">渔<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/读书笔记/" title="读书笔记">读书笔记<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/随笔/" title="随笔">随笔<sup>3</sup></a></li>
		  
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="https://hexo.io/" target="_blank" title="Hexo">Hexo</a>
            
          </li>
        
          <li>
            
            	<a href="https://github.com/yoferzhang" target="_blank" title="Github">Github</a>
            
          </li>
        
          <li>
            
            	<a href="http://ww3.sinaimg.cn/large/a9c4d5f6jw1f2cbilh1uyj2076076t97.jpg" target="_blank" title="WeChat">WeChat</a>
            
          </li>
        
          <li>
            
            	<a href="https://cn.linkedin.com/in/耀琦-张-771388117" target="_blank" title="LinkedIn">LinkedIn</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Yofer Zhang in Tencent. <br/>
			This is my blog,thank you to here.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/2848249334" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/yoferzhang" target="_blank" class="icon-github" title="github"></a>
		
		
		<a href="http://stackoverflow.com/users/yofer-zhang" target="_blank" class="icon-stack-overflow" title="stackoverflow"></a>
		
		
		<a href="https://twitter.com/LuciferZhangyq" target="_blank" class="icon-twitter" title="twitter"></a>
		
		
		<a href="https://www.facebook.com/luciferzhang" target="_blank" class="icon-facebook" title="facebook"></a>
		
		
		<a href="https://www.linkedin.com/in/耀琦-张-771388117?trk=hp-identity-name" target="_blank" class="icon-linkedin" title="linkedin"></a>
		
		
		<a href="https://www.douban.com/people/zyq522376829" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/yoferzhang" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		<a href="https://plus.google.com/110295955443575724222?rel=author" target="_blank" class="icon-google_plus" title="Google+"></a>
		
		
		<a href="mailto:522376829@qq.com" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="Yofer">Yofer</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"yoferzhang"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//yoferzhang.github.io/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?a6dda28cb6f26de955e11a3716d6ce9b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
